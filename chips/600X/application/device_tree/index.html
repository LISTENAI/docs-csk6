<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.2">
<title data-react-helmet="true">设备树 | 聆思文档中心</title><meta data-react-helmet="true" property="og:url" content="https://github.com/LISTENAI/docs-csk6/chips/600X/application/device_tree"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="设备树 | 聆思文档中心"><meta data-react-helmet="true" name="description" content="概述"><meta data-react-helmet="true" property="og:description" content="概述"><link data-react-helmet="true" rel="shortcut icon" href="/docs-csk6/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://github.com/LISTENAI/docs-csk6/chips/600X/application/device_tree"><link data-react-helmet="true" rel="alternate" href="https://github.com/LISTENAI/docs-csk6/chips/600X/application/device_tree" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://github.com/LISTENAI/docs-csk6/chips/600X/application/device_tree" hreflang="x-default"><link rel="stylesheet" href="/docs-csk6/assets/css/styles.888b750d.css">
<link rel="preload" href="/docs-csk6/assets/js/runtime~main.ce611ca3.js" as="script">
<link rel="preload" href="/docs-csk6/assets/js/main.b1c19881.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_vO2r">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" titleclassname="navbar__title" href="/docs-csk6/"><img src="/docs-csk6/img/logo_light.svg" alt="LSOpen Logo" class="themedImage_K3WP themedImage--light_Fy0T navbar__logo"><img src="/docs-csk6/img/logo_dark.svg" alt="LSOpen Logo" class="themedImage_K3WP themedImage--dark_V9oi navbar__logo"></a><a class="navbar__item navbar__link" href="/docs-csk6/chips/4002/Chip_information_4002">芯片</a><a class="navbar__item navbar__link" href="/docs-csk6/tools/LStudio">工具</a><a class="navbar__item navbar__link" href="/docs-csk6/AIsolution/ESR/Quick_start/Scheme_introduction">AI语音应用方案</a><a class="navbar__item navbar__link" href="/docs-csk6/Industrysolution/Scanning_pen/Scheme_introduction">行业Turnkey解决方案</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs-csk6/FAQ/faq">FAQ</a><a class="navbar__item navbar__link" href="/docs-csk6/school/school">视频课程</a><a class="navbar__item navbar__link" href="/docs-csk6/workorder/workorder">工单</a><div class="react-toggle displayOnlyInLargeViewport_a-w0 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_8pH0"><img src="/docs-csk6/img/light.svg" alt="" class="themedImage_K3WP themedImage--light_Fy0T"><img src="/docs-csk6/img/unlight.svg" alt="" class="themedImage_K3WP themedImage--dark_V9oi"></span></div><div class="react-toggle-track-x"><span class="toggle_8pH0"><img src="/docs-csk6/img/undark.svg" alt="" class="themedImage_K3WP themedImage--light_Fy0T"><img src="/docs-csk6/img/dark.svg" alt="" class="themedImage_K3WP themedImage--dark_V9oi"></span></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="navbar__search searchBarContainer_I7kZ"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_Zg7X searchBarLoadingRing_J5Ez"><div></div><div></div><div></div><div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" titleclassname="navbar__title" href="/docs-csk6/"><img src="/docs-csk6/img/logo_light.svg" alt="LSOpen Logo" class="themedImage_K3WP themedImage--light_Fy0T navbar__logo"><img src="/docs-csk6/img/logo_dark.svg" alt="LSOpen Logo" class="themedImage_K3WP themedImage--dark_V9oi navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/chips/4002/Chip_information_4002">芯片</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/tools/LStudio">工具</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/AIsolution/ESR/Quick_start/Scheme_introduction">AI语音应用方案</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/Industrysolution/Scanning_pen/Scheme_introduction">行业Turnkey解决方案</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/FAQ/faq">FAQ</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/school/school">视频课程</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/workorder/workorder">工单</a></li></ul></div></div></div></nav><nav class="navbar subnavbar--fixed-top sub-navbar"><div class="navbar__inner subnavbar__inner"><div class="navbar__items"><a class="subnavbar__item subnavbar__link" dirname="/chips" href="/docs-csk6/chips/4002/Chip_information_4002">CSK4002</a><a aria-current="page" class="subnavbar__item subnavbar__link subnavbar__link--active" dirname="/chips" href="/docs-csk6/chips/600X/overview/chips">CSK600X</a><a class="subnavbar__item subnavbar__link" dirname="/chips" href="/docs-csk6/chips/micropython/index">MicroPython</a></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_Ol8-"><main class="docMainContainer_dRYS docMainContainerEnhanced_EGxD"><div class="container padding-top--md padding-bottom--lg center-container"><div class="row"><div class="col docItemCol_+xOG"><div class="docItemContainer_c+5G"><article><div class="markdown"><header><h1 class="h1Heading_5RMM">设备树</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="概述"></a>概述<a class="hash-link" href="#概述" title="Direct link to heading">#</a></h2><p>设备树(Device Tree)一种描述硬件资源的数据结构，在嵌入式Linux、Zephyr等操作系统中，设备树的使用让内核和硬件资源描述相对独立。</p><p>通过本章节我们将了解到：</p><ul><li>1.什么是设备树</li><li>2.如何看懂设备树文件</li><li>2.设备树包含、描述了什么内容</li><li>3.设备树与应用代码的关系</li><li>4.如何在开发中使用设备树</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="什么是设备树"></a>什么是设备树<a class="hash-link" href="#什么是设备树" title="Direct link to heading">#</a></h2><p>顾名思义，设备树(Device Tree)是用来描述 设备信息 的 &quot;树&quot; ，这棵 &quot;树&quot; 的主干就是系统总线，而我们熟悉的各种芯片上的关键外设驱动如I2C控制器、GPIO控制器、SPI控制器等都是这棵树上的分支，每个分支上还挂着不同的设备：</p><p><img src="/docs-csk6/assets/images/devicetree_like-c54a64e508b4c6c7dbd7320e4ffbb833.png"></p><p>描述设备树的是后缀为dts(Device Tree Source)的文件，内容为树状结构，树上的每一个Node(节点)代表硬件描述里的一个Device(设备)，一个 Node 会包含多个 Properties(属性)，Properties描述了与这个设备相关的信息，如寄存器地址、硬件配置信息等。</p><p><img src="/docs-csk6/assets/images/devicetree_code1-1f9e330b9e3560fbb1b522004f3683e3.png"></p><p>在上述片段中，我们可看到在 gpio_key 这一节点下，还有 button_0 这一子节点，代表着硬件板型上的一个用户按键，而这个子节点下面的 lable(标签) 和 gpios(使用的IO口) 这两个属性这描述了这个用户按键的关键信息。</p><p>如果我们想在目前这个板子上增加一个用户按键，无非是在gpio_key这个节点下，再 &quot;长出&quot; 一个 button_1 的子节点，并在这个节点的属性中描述这个新增的按键的关键信息。如：</p><p><img src="/docs-csk6/assets/images/devicetree_code2-a9b4763a8407266d78bced55eb31cbfe.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="zephyr中的设备树"></a>Zephyr中的设备树<a class="hash-link" href="#zephyr中的设备树" title="Direct link to heading">#</a></h2><p>zephyr类似于Linux通过设备树来管理硬件，与Linux不同的是，zephyr不直接使用DTB(设备树编译后的二进制文件)，因为运行zephyrOS的硬件大部分是资源受限的嵌入式系统，很多MCU的资源都不够支撑运行一个DTB框架，所以zephyr工程直接将设备树通过脚本处理成c语言头文件，给应用程序调用的设备树API都是一些宏定义或宏函数。</p><p>zephyr工程直接将设备树通过脚本处理成C头文件<code>devicetree.h</code>，设备树输入文件有两种类型:<code>source</code>(.dts)文件和<code>binding</code>(.yaml)文件。<code>source</code>文件包含了设备树的配置信息，<code>binding</code>文件描述设备树的规则包括据数据类型等。所有包括设备驱动程序、应用程序、测试、内核等开发都可以通过include<code>devicetree.h</code>来使用设备树。
以下是该过程的简化视图:
<img src="/docs-csk6/assets/images/devicedree_build2-79787cc42bb9514eac4f62c5c960b7aa.png"></p><p>我们直接来看csk6 sdk <code>csk6002_9s_nano.dts</code> 设备树源文件，部分配置内容如下：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">/* dts语法版本version 1 */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">dts</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">v1</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;csk/csk6.dtsi&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;dt-bindings/pwm/pwm.h&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">/* 引用了csk6 soc的dtsi基础配置 */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&quot;csk6002_9s_nano_pinctrl.dtsi&quot;</span><span class="token macro property"> </span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">/* 设备树根节点 */</span><span class="token plain">   </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        model </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;csk6002 9s nano&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token comment" style="color:rgb(106, 153, 85)">/* board板型名称 */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        compatible </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;csk,csk6002_9s_nano&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">/* 定义设备树某个硬件设备的别名，方便通过aliases访问节点的信息 */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        aliases </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                led0 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">board_led_2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                sw0 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">user_button_0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                pwm</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">led0 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">green_pwm_led</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                i2c</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">i2c0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">/* chosen节点 */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        chosen </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                zephyr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">console </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">uart0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                zephyr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">shell</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">uart </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">uart0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                zephyr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">sram </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">sram0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                zephyr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">itcm </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">itcm0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                zephyr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">flash </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">flash0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                zephyr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">flash_controller </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">flash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token comment" style="color:rgb(106, 153, 85)">/* other chosen settings  for your hardware */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">/* led的设备树配置 */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        leds </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                compatible </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;gpio-leds&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                board_led_2</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> board_led_2 </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                        gpios </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">gpioa </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token comment" style="color:rgb(106, 153, 85)">/* gpio引脚配置 */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                        label </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;User BOARD_LED_2&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token comment" style="color:rgb(106, 153, 85)">/* label名称 */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">/* pwm led的设备树配置 */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        pwmleds </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            compatible </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;pwm-leds&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            green_pwm_led</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> green_pwm_led </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                pwms </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">pwm5 </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain"> PWM_POLARITY_NORMAL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token comment" style="color:rgb(106, 153, 85)">/* gpio引脚配置 */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                label </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;User BOARD_LED_2 - PWM0&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token comment" style="color:rgb(106, 153, 85)">/* label名称 */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">/* 按键的设备树配置 */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        gpio_keys </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                compatible </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;gpio-keys&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                user_button_0</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> button_0 </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                        label </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;User SW0&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token comment" style="color:rgb(106, 153, 85)">/* label名称 */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                        gpios </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">gpiob </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token comment" style="color:rgb(106, 153, 85)">/* gpio引脚配置 */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">/* i2c0的设备树配置 */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">i2c0 </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        status </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;disabled&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><p>看懂设备树dts文件首先需要了解几个重要的设备树语法。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="设备树语法"></a>设备树语法<a class="hash-link" href="#设备树语法" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="设备树的组成和节点"></a>设备树的组成和节点<a class="hash-link" href="#设备树的组成和节点" title="Direct link to heading">#</a></h4><p>设备树是由节点(node)组成的，有根节点和子节点。
设备树是采用树形结构来描述板子上的设备信息的文件，每个设备都是一个节点，叫做设备节点，每个节点都通过一些属性信息来描述节点信息，属性就是键—值对。</p><p>下面是一个示例设备树 DTS 文件:</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv"><pre tabindex="0" class="prism-code language-undefined codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token plain">/dts-v1/;</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">/ {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        a-node {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                subnode_nodelabel: a-sub-node {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                        foo = &lt;3&gt;;</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                        label = &quot;SUBNODE&quot;;</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                };</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        };</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">};</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><p><code>/dts-v1/;</code>：dts语法版本version 1。</p><p>设备树的节点(node)：
在设备树中，node 由节点名、节点内容组成的。</p><p>示例中这个设备树有三个节点：</p><ol><li>根节点，dts文件中的<code>/</code>是根节点，每个设备树文件只有一个根节点。</li><li>一个名为 <code>a-node</code>的节点，它是根节点的子节点。</li><li>一个名为 <code>a-sub-node</code> 的节点，它是 <code>a-node</code>的子节点。</li><li>节点内容，<code>a-sub-node</code>节点内容为：</li></ol><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv"><pre tabindex="0" class="prism-code language-undefined codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token plain">foo = &lt;3&gt;;</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">label = &quot;SUBNODE&quot;;</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="设备树的label标签"></a>设备树的label(标签)<a class="hash-link" href="#设备树的label标签" title="Direct link to heading">#</a></h4><p>这个设备节点名称根据Zephyr的设备驱动模型(Device Driver Model)来定义，在应用程序开发中，可以通过<code>device_get_binding()</code>接口带入label名称来获取对应硬件设备的设备实例，例如：
在<code>csk6.dtsi</code>中i2c的设备树配置如下：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token plain">    i2c0</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> i2c@</span><span class="token number" style="color:rgb(181, 206, 168)">45600000</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        compatible </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;listenai,csk-i2c&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        reg </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token number" style="color:rgb(181, 206, 168)">0x45600000</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0x100000</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        interrupts </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token number" style="color:rgb(181, 206, 168)">14</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">address</span><span class="token macro property expression operator" style="color:rgb(212, 212, 212)">-</span><span class="token macro property expression">cells </span><span class="token macro property expression operator" style="color:rgb(212, 212, 212)">=</span><span class="token macro property expression"> </span><span class="token macro property expression operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token macro property expression number" style="color:rgb(181, 206, 168)">1</span><span class="token macro property expression operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">size</span><span class="token macro property expression operator" style="color:rgb(212, 212, 212)">-</span><span class="token macro property expression">cells </span><span class="token macro property expression operator" style="color:rgb(212, 212, 212)">=</span><span class="token macro property expression"> </span><span class="token macro property expression operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token macro property expression number" style="color:rgb(181, 206, 168)">0</span><span class="token macro property expression operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        label </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;I2C_0&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><p>应用开发中可通过I2C的label：<code>label = &quot;I2C_0&quot;</code>来获取<code>I2C0</code>设备的实例：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">device</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">i2c0_dev </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">NULL</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">main</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">/* 通过label获取i2c0设备实例 */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    i2c0_dev </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">device_get_binding</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;I2C_0&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">/* 通过I2C设备实例操作I2C API接口 */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">i2c_write</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">i2c0_dev</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> data0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">sizeof</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">data0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> SLAVE_ADDRESS</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="aliases和chosen节点"></a><code>Aliases</code>和<code>chosen</code>节点<a class="hash-link" href="#aliases和chosen节点" title="Direct link to heading">#</a></h4><ul><li><code>Aliases</code>节点</li></ul><p><code>aliases</code>的意思是“别名”，因此<code>aliases</code>节点的主要功能就是定义别名，定义别名的目的就是为了方便访问节点。不过我们一般会在节点命名的时候会加上 label，然后通过&amp;label来访问节点，这样也很方便，而且设备树里面大量的使用&amp;label 的形式来访问节点。
例如 <code>csk6002_9s_nano.dts</code>中aliases节点内容如下：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv"><pre tabindex="0" class="prism-code language-undefined codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token plain">        /* aliases节点，定义设备树某个硬件设备的别名，方便通过aliases访问节点的信息 */</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        aliases {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                led0 = &amp;board_led_2;</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                sw0 = &amp;user_button_0;</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                pwm-led0 = &amp;green_pwm_led;</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                i2c-0 = &amp;i2c0;</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        };</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><ul><li><code>chosen</code>节点
chosen 并不是一个真实的设备，chosen节点主要是为uboot向Linux内核传递数据。
例如 <code>csk6002_9s_nano.dts</code>中chosen内容如下：</li></ul><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv"><pre tabindex="0" class="prism-code language-undefined codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token plain">        /* chosen节点，指定启动参数，类似u-boot启动内核时指定的bootargs*/</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        chosen {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                zephyr,console = &amp;uart0;</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                zephyr,shell-uart = &amp;uart0;</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                zephyr,sram = &amp;sram0;</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                zephyr,itcm = &amp;itcm0;</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                zephyr,flash = &amp;flash0;</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                zephyr,flash_controller = &amp;flash;</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                /* other chosen settings  for your hardware */</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        };</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="设备树的几个标准属性"></a>设备树的几个标准属性<a class="hash-link" href="#设备树的几个标准属性" title="Direct link to heading">#</a></h4><p>节点是由一堆的属性组成，节点都是具体的设备，不同的设备需要的属性不同，用户可以自定义属性。除了用户自定义属性，有很多属性是标准属性，Linux 下的很多外设驱动都会使用这些标准属性，几个常用的标准属性：</p><ul><li><p><code>model</code> 属性
model属性通常用来描述设备模块信息。</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv"><pre tabindex="0" class="prism-code language-undefined codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token plain">model = &quot;csk6002 9s nano&quot;;</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div></li><li><p><code>compatible</code> 属性</p></li></ul><p>compatible 属性也叫做“兼容性”属性，这是非常重要的一个属性！compatible 属性的值是一个字符串列表，compatible 属性用于将设备和驱动绑定起来。字符串列表用于选择设备所要使用的驱动程序，compatible 属性的值格式如下所示：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv"><pre tabindex="0" class="prism-code language-undefined codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&quot;manufacturer,model&quot;</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><p>manufacturer 表示厂商名称，model通常指模块对应的驱动名称。
例如<code>csk6002_9s_nano.dts</code>中compatible配置为：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token plain">compatible </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;csk,csk6002_9s_nano&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><p>csk：芯片名称
csk6002_9s_nano：csk板型名称</p><ul><li><code>status</code> 属性</li></ul><p>status属性用来描述设备状态信息。</p><table><thead><tr><th>值</th><th>状态描述</th></tr></thead><tbody><tr><td>okay</td><td>设备可操作</td></tr><tr><td>disable</td><td>设备当前不可操作</td></tr><tr><td>fail</td><td>设备不可操作，检测到设备发生错误，切不可恢复</td></tr><tr><td>fail-sss</td><td>含义同fail，sss为错误内容</td></tr></tbody></table><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="节点名称和属性的取值"></a>节点名称和属性的取值<a class="hash-link" href="#节点名称和属性的取值" title="Direct link to heading">#</a></h4><ul><li>节点名称</li></ul><p>在设备树中，node 由节点名、节点内容组成的。下面是一个一个典型的形式：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token plain">node1@address </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    key</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    node2@address</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        key</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><p>其中 node1 是它的节点名，address 是节点的第一个寄存地址，如果没有寄存器 @address 为空。
节点名长度应该小于 31 个字符，对于不同类型的设备，Devicetree spec 有推荐对应的设备名，但并非强制。</p><ul><li>节点属性</li></ul><p>节点的属性是键值对的形式，如：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token plain">gpios </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">gpiob </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><ul><li>属性值 </li></ul><p>属性值有 7 种类型：</p><table><thead><tr><th>属性值</th><th>属性值描述</th></tr></thead><tbody><tr><td>u32</td><td>big-endian 32位整形，如：<code>current-speed = &lt;115200&gt;;</code></td></tr><tr><td>u64</td><td>big-endian 64位整形，分为两个32位整形，如：<code>reg = &lt;0x00080000 0x00010000&gt;;</code></td></tr><tr><td>string</td><td>字符串类型，如：<code>label = &quot;storage&quot;;</code></td></tr><tr><td>phandle-sss</td><td>节点引用，如：<code>i2c-0 = &amp;i2c0;</code></td></tr><tr><td>prop-encoded-array</td><td>任意数量的列表，如：<code>gpios = &lt;&amp;gpiob 5 0&gt;;</code></td></tr><tr><td>stringlist</td><td>字符串列表</td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="zephyr-sdk中的设备树文件"></a>Zephyr SDK中的设备树文件<a class="hash-link" href="#zephyr-sdk中的设备树文件" title="Direct link to heading">#</a></h2><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 设备树源文件</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">zephyr</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">boards</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">arm</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">csk6002_9s_nano</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">csk6002_9s_nano</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">dts </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 设备树源文件</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">zephyr</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">boards</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">arm</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">csk6002_9s_nano</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">csk6002_9s_nano_pinctrl</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">dtsi </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 设备树绑定文件</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">zephyr</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">dts</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">bindings</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">xxx</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">xxx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">yaml  </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 设备树的头文件</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">zephyr</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">include</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">devicetree</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 应用项目设备树配置文件</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">app</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">boards</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">csk6002_9s_nano</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">overlay  </span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="设备树源文件dts文件"></a>设备树源文件(.dts文件)<a class="hash-link" href="#设备树源文件dts文件" title="Direct link to heading">#</a></h4><p>以<code>csk6002_9s_nano</code>板型为例.dts在csk6 sdk中的路径为：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token plain">csk6 sdk</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">boards</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">arm</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">csk6002_9s_nano</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">csk6002_9s_nano</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">dts</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">csk6 sdk</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">boards</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">arm</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">csk6002_9s_nano</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">csk6002_9s_nano_pinctrl</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">dtsi</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><ul><li><strong>dts</strong>：设备树的源文件，基于某个soc的开发板设备硬件设备的细节，比如定义一个 <em>uart</em> 设备、外设的使能、GPIO、flash的分区等并定义其引脚信息等。</li><li><strong>dtsi</strong>：设备树的头文件，文件我们用于定义 SoC 的设备，如：CPU架构、主频、各外设寄存器地址范围等，<em>.dts</em> 可以像<em>C语言</em>一样，通过 <em>#include</em> 来包含它。</li></ul><p>dtsi是设备树头文件，类似c语言的.h文件，一般用于描述一个硬件模块，供板级dts或soc级dtsi引用。所以可以把一个固定硬件的设备信息放到.dtsi文件中。比如一个soc，一个型号的soc他的硬件资源是不会变的，所以可以统一写在一个dtsi中供板级dts文件引用。soc模块会包括cpu IP核和uart ip等，那么可以把一个cpu的的硬件资源或者uart资源可以写在dtsi文件中，供soc的dtsi引用。一般情况下，一个板级文件可以定义在多个dts文件中，在设备树编译阶段，会由脚本合并多个dts文件。</p><p>例如：<code>csk6002_9s_nano.dts</code>板型文件引用了csk6的基础配置<code>csk6002_9s_nano_pinctrl.dtsi</code>文件。</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">dts</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">v1</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;csk/csk6.dtsi&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&quot;csk6002_9s_nano_pinctrl.dtsi&quot;</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="设备树绑定文件yaml文件"></a>设备树绑定文件(.yaml文件)<a class="hash-link" href="#设备树绑定文件yaml文件" title="Direct link to heading">#</a></h4><p>bindings文件在csk6 sdk中的路径：
<code>csk6 sdk/dts/bindings/xxx/xxx.yaml</code>，例如pwm-leds的bindings文件目录为：<code>csk6 sdk/dts/bindings/led/pwm-leds.yaml</code></p><p>bindings文件在zephyr工程中是以.yaml文件形式存在，存放在zephyr/dts/bindings目录下, bindings顾名思义绑定的意思，他作为c语言和设备树之前的桥梁存在。用于告诉gen_defines.py dts中哪些信息被生成宏和以什么样的形式生成宏。bingdings可以解释设备树中设备节点的属性代表什么意思。前面提到的将设备树转换为c语言头文件，就是根据bindings文件中定义的规则来转换的。</p><p>dts通过note内的compatible属性指和yaml文件名进行匹配
例如<code>csk6 sdk/boards/arm/csk6002_9s_nano/csk6002_9s_nano.dts</code>中green_pwm_led配置：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pwmleds </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        compatible </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;pwm-leds&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        green_pwm_led</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> green_pwm_led </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            pwms </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">pwm0 </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> PWM_POLARITY_NORMAL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            label </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;User BOARD_LED_2 - PWM0&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><p><code>compatible = &quot;pwm-leds&quot;</code>指定green_pwm_led的规则文件为<code>pwm-leds.yaml</code>，那么它就会去<code>csk6 sdk/dts/bindings/</code>去找<code>led/pwm-leds.yaml</code>文件来绑定。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="设备树头文件devicetreeh文件"></a>设备树头文件(devicetree.h文件)<a class="hash-link" href="#设备树头文件devicetreeh文件" title="Direct link to heading">#</a></h4><p><code>devicetree.h</code>路径：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv"><pre tabindex="0" class="prism-code language-undefined codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token plain">csk6 sdk/include/devicetree.h</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><p>在zephyr中使用设备树，只要<code>#include &lt;devicetree.h&gt;</code>头文件就可以了。这里面主要定义了设备树供的API接口。
在应用项目的main文件中引用devicetree.h即可通过设备树API获取信息，例如：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;zephyr.h&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;device.h&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;devicetree.h&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;drivers/gpio.h&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">/* 通过devicetree DT_ALIAS接口获取别名为led0的设备树信息  */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">define</span><span class="token macro property"> </span><span class="token macro property macro-name">LED0</span><span class="token macro property"> </span><span class="token macro property expression function" style="color:rgb(220, 220, 170)">DT_GPIO_LABEL</span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token macro property expression function" style="color:rgb(220, 220, 170)">DT_ALIAS</span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token macro property expression">led0</span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token macro property expression"> gpios</span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">main</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">device</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">dev</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    bool led_is_on </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> ret</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">/* 获取gpio实例 */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    dev </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">device_get_binding</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">LED0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="应用项目中的dts文件overlay文件"></a>应用项目中的dts文件(.overlay文件)<a class="hash-link" href="#应用项目中的dts文件overlay文件" title="Direct link to heading">#</a></h4><p>dts在应用项目中通常以.overlay的形式存在：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token plain">app</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">boards</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">csk6002_9s_nano</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">overlay</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><p>zephyr sdk中的.dts对硬件板型进行了基础的设备树配置，但在应用开发中，经常需要对GPIO进行功能复用，如配置I2C、I2S、SPI等外设功能时，可通过应用目录下的<code>boards/XXXXX.overlay</code>增加对应的配置。</p><p>例如在I2C sample中，sample在overlay文件中完成gpio引脚复用I2C功能的配置：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">csk6002_9s_nano_pinctrl</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token comment" style="color:rgb(106, 153, 85)">/* I2C alternate function */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                pinctrl_i2c0_scl_default</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> i2c0_scl_default</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                        pinctrls </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">pinmuxa </span><span class="token number" style="color:rgb(181, 206, 168)">4</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">8</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                pinctrl_i2c0_sda_default</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> i2c0_sda_default</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                        pinctrls </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">pinmuxa </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">8</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                pinctrl_i2c1_scl_default</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> i2c1_scl_default</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                         pinctrls </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">pinmuxa </span><span class="token number" style="color:rgb(181, 206, 168)">7</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">9</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                pinctrl_i2c1_sda_default</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> i2c1_sda_default</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                        pinctrls </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">pinmuxa </span><span class="token number" style="color:rgb(181, 206, 168)">6</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">9</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">i2c1 </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        status </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;okay&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        pinctrl</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">pinctrl_i2c1_scl_default </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">pinctrl_i2c1_sda_default</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        pinctrl</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">names </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;default&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">i2c0 </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        status </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;okay&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        pinctrl</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">pinctrl_i2c0_scl_default </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">pinctrl_i2c0_sda_default</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        pinctrl</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">names </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;default&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="zephyr系统中设备树编译流程"></a>zephyr系统中设备树编译流程<a class="hash-link" href="#zephyr系统中设备树编译流程" title="Direct link to heading">#</a></h3><p><img src="/docs-csk6/assets/images/zephyr_dt_inputs_outputs-19584523f1faa7b52bf04ba6b27ca79c.png"></p><p>编译输入文件:</p><ul><li>sources (.dts) : 一般是board的dts文件</li><li>includes (.dtsi)：被dts包含的dtsi文件，是soc或者驱动级的公用描述</li><li>overlays (.overlay)：对于相同的应用采用不同的板子时，可以在应用下放不同overlay文件配置应用要用的设备</li><li>bindings (.yaml)： binding文件，用于帮助dts生成宏</li></ul><p>以上文件通常会出现在下面路径：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv"><pre tabindex="0" class="prism-code language-undefined codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token plain">CSK6 SDK/boards/arm/csk6002_9s_nano/csk6002_9s_nano.dts</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">CSK6 SDK/boards/arm/csk6002_9s_nano/csk6002_9s_nano_pinctrl.dtsi</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">app/board/xxx.overlay</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">CSK6 SDK/dts/bindings/xxx/xxx.yaml</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><p>编译输出文件：</p><ul><li>zephyr.dts.pre：这是一个中间输出文件</li><li>zephyr.dts：该文件是dts、dtsi、overlay合并为一个文件，zephyr.dts只是方便调试查看，不会对之后的构建有任何帮助</li><li>devicetree.h：dts最后生成的宏，会被代码引用</li></ul><p>以上文件通常会出现在下面路径：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv"><pre tabindex="0" class="prism-code language-undefined codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token plain">app/build/zephyr/zephyr.dts</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">csk6 sdk/include/devicetree.h</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">app/build/zephyr/include/generated/devicetree_fixups.h</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">app/build/zephyr/include/generated/devicetree_unfixed.h</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><p><code>csk6 sdk/include/devicetree.h</code>即为设备驱动程序、应用程序、测试、内核等最终引用的头文件。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="在应用开发中使用设备树"></a>在应用开发中使用设备树<a class="hash-link" href="#在应用开发中使用设备树" title="Direct link to heading">#</a></h2><p>通过以上章节的描述，我们对设备树有了基本的了解，如何在应用开发中使用设备树？下面通过几个示例来说明：</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="设备树api接口"></a>设备树API接口<a class="hash-link" href="#设备树api接口" title="Direct link to heading">#</a></h3><p>应用开发中常用的设备树API接口：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">/* 获取设备节点的label值 */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">define</span><span class="token macro property"> </span><span class="token macro property macro-name function" style="color:rgb(220, 220, 170)">DT_LABEL</span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token macro property expression">node_id</span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">/* 获取设备节点的node id */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">define</span><span class="token macro property"> </span><span class="token macro property macro-name function" style="color:rgb(220, 220, 170)">DT_ALIAS</span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token macro property expression">alias</span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">/* 获取设备节点的node id */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">define</span><span class="token macro property"> </span><span class="token macro property macro-name function" style="color:rgb(220, 220, 170)">DT_NODELABEL</span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token macro property expression">label</span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token macro property expression"> </span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><p>更多device tree API接口可以在zephyr官网<a href="https://docs.zephyrproject.org/latest/doxygen/html/devicetree_8h.html" target="_blank" rel="noopener noreferrer">devicetree.h File Reference</a>中查看。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="应用项目中使用设备树api接口获取设备实例"></a>应用项目中使用设备树API接口获取设备实例<a class="hash-link" href="#应用项目中使用设备树api接口获取设备实例" title="Direct link to heading">#</a></h3><p>以blinky sample为例，通过DT_ALIAS()API找到<code>led0</code>设备树配置，并解析<code>led0</code>的属性信息：
在<code>zephyr.dts</code>中<code>led0</code>的配置信息如下：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token plain">        aliases </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                led0 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">board_led_2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                sw0 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">user_button_0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                pwm</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">led0 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">green_pwm_led</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                i2c</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">i2c0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                i2c</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">i2c1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        leds </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                compatible </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;gpio-leds&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                board_led_2</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> board_led_2 </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                        gpios </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">gpioa </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                        label </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;User BOARD_LED_2&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><p>我们在gpio sample的实现代码中可以通过以下方式获取<code>led0</code>的属性信息：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">define</span><span class="token macro property"> </span><span class="token macro property macro-name">LED0_NODE</span><span class="token macro property"> </span><span class="token macro property expression function" style="color:rgb(220, 220, 170)">DT_ALIAS</span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token macro property expression">led0</span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token macro property comment" style="color:rgb(106, 153, 85)">/*通过alias标签获取led0 node_id*/</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">/*通过led0 node_id解析led0 lable下的属性信息*/</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">define</span><span class="token macro property"> </span><span class="token macro property macro-name">LED0</span><span class="token macro property">    </span><span class="token macro property expression function" style="color:rgb(220, 220, 170)">DT_GPIO_LABEL</span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token macro property expression">LED0_NODE</span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token macro property expression"> gpios</span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token macro property comment" style="color:rgb(106, 153, 85)">/*通过led0 node_id获取gpioa设备树配置*/</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">define</span><span class="token macro property"> </span><span class="token macro property macro-name">PIN</span><span class="token macro property"> </span><span class="token macro property expression function" style="color:rgb(220, 220, 170)">DT_GPIO_PIN</span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token macro property expression">LED0_NODE</span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token macro property expression"> gpios</span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token macro property comment" style="color:rgb(106, 153, 85)">/*获取gpioa PIN值*/</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">define</span><span class="token macro property"> </span><span class="token macro property macro-name">FLAGS</span><span class="token macro property">   </span><span class="token macro property expression function" style="color:rgb(220, 220, 170)">DT_GPIO_FLAGS</span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token macro property expression">LED0_NODE</span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token macro property expression"> gpios</span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token macro property comment" style="color:rgb(106, 153, 85)">/*获取pin flag值*/</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">main</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">device</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">dev</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">/* 获取LED0实例 */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    dev </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">device_get_binding</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">LED0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">/* 配置gpio */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ret </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">gpio_pin_configure</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">dev</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> PIN</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> GPIO_OUTPUT_ACTIVE </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> FLAGS</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">/* 操作GPIO口 */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">gpio_pin_set</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">dev</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> PIN</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="在应用项目开发中重写overlay文件完成引脚功能复用"></a>在应用项目开发中重写(.overlay文件)完成引脚功能复用<a class="hash-link" href="#在应用项目开发中重写overlay文件完成引脚功能复用" title="Direct link to heading">#</a></h3><p>在I2C sample中使用<code>i2c0(GPIO_A_04, GPIO_A_05)</code>和<code>i2c1(GPIO_A_06, GPIO_A_07)</code>两组GPIO口作为I2C的master和slave接口，因此需要在设备树中将这两组GPIO复用为I2C引脚功能，可在<code> .overlay</code>中添加设备树配置的方式完成GPIO复用I2C功能的配置。</p><p>在app目录下增加<code>csk6002_9s_nano.overlay</code>文件并添加如下配置：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">csk6002_9s_nano_pinctrl</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token comment" style="color:rgb(106, 153, 85)">/* 将GPIOA_4配置为i2c0 scl*/</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                pinctrl_i2c0_scl_default</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> i2c0_scl_default</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token comment" style="color:rgb(106, 153, 85)">/* 将pa4 设置function为8 复用I2C引脚功能 */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                    pinctrls </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">pinmuxa </span><span class="token number" style="color:rgb(181, 206, 168)">4</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">8</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token comment" style="color:rgb(106, 153, 85)">/* 将GPIOA_5 i2c0 sda*/</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                pinctrl_i2c0_sda_default</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> i2c0_sda_default</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                     </span><span class="token comment" style="color:rgb(106, 153, 85)">/* 将pa5 设置function为8 复用I2C引脚功能 */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                    pinctrls </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">pinmuxa </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">8</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                pinctrl_i2c1_scl_default</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> i2c1_scl_default</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                    pinctrls </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">pinmuxa </span><span class="token number" style="color:rgb(181, 206, 168)">7</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">9</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                pinctrl_i2c1_sda_default</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> i2c1_sda_default</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                    pinctrls </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">pinmuxa </span><span class="token number" style="color:rgb(181, 206, 168)">6</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">9</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">i2c1 </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        status </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;okay&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        pinctrl</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">pinctrl_i2c1_scl_default </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">pinctrl_i2c1_sda_default</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        pinctrl</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">names </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;default&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">i2c0 </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        status </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;okay&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        pinctrl</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">pinctrl_i2c0_scl_default </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">pinctrl_i2c0_sda_default</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        pinctrl</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">names </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;default&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><p>在sample实现代码中使用设备树API接口并完成I2C接口操作：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">/*定义一个I2C设备名称，并通过设备树接口获取I2C的设备树信息*/</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">define</span><span class="token macro property"> </span><span class="token macro property macro-name">I2C0_DEV_NAME</span><span class="token macro property"> </span><span class="token macro property expression function" style="color:rgb(220, 220, 170)">DT_LABEL</span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token macro property expression function" style="color:rgb(220, 220, 170)">DT_ALIAS</span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token macro property expression">i2c_0</span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token macro property expression"> </span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">/* 从机地址：csk6默认的从机地址为:0x35*/</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">define</span><span class="token macro property"> </span><span class="token macro property macro-name">SLAVE_ADDRESS</span><span class="token macro property"> </span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token macro property expression number" style="color:rgb(181, 206, 168)">0x35</span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token macro property expression"> </span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">/* 设置I2C的时钟速率和主从模式*/</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name" style="color:rgb(78, 201, 176)">uint32_t</span><span class="token plain"> i2c0_cfg </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">I2C_SPEED_SET</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">I2C_SPEED_STANDARD</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> I2C_MODE_MASTER</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name" style="color:rgb(78, 201, 176)">uint32_t</span><span class="token plain"> i2c1_cfg </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">/* 定义I2C设备实例 */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">device</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">i2c0_dev </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">NULL</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">device</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">i2c1_dev </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">NULL</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">/* i2c master 初始化 */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">i2c_master_init</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">/* 获取I2C设备实例 */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    i2c0_dev </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">device_get_binding</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">I2C0_DEV_NAME</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">/* i2c master configure */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token function" style="color:rgb(220, 220, 170)">i2c_configure</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">i2c0_dev</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> i2c0_cfg</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">printk</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;I2C0 config failed\n&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">/* i2c slave 初始化 */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">i2c_slave_init</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">   </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">/* 获取I2C设备实例 */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    i2c1_dev </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">device_get_binding</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">I2C1_DEV_NAME</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">i2c1_dev </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">NULL</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">printk</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;I2C1: Device is not found.\n&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">/* i2c slave configure */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token function" style="color:rgb(220, 220, 170)">i2c_configure</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">i2c1_dev</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> i2c1_cfg</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">printk</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;I2C1 config failed\n&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">/* i2c_master_thread实现：*/</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">i2c_master_thread</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">v1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">v2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">v3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">/* data0填充数据 */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">sizeof</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">data0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(212, 212, 212)">++</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        data0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">/* 1. master发送数据，slave接收 */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">i2c_write</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">i2c0_dev</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> data0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">sizeof</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">data0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> SLAVE_ADDRESS</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token comment" style="color:rgb(106, 153, 85)">//master写数据</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">/* 2. master接收数据 */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">i2c_read</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">i2c0_dev</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> data0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">sizeof</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">data0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> SLAVE_ADDRESS</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">/* i2c_slave_thread实现 */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">i2c_slave_thread</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">v1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">v2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">v3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">/* master发送数据，slave接收 */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">i2c_read</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">i2c1_dev</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> data1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">sizeof</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">data1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">main</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">/*配置I2C设备*/</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">i2c_configure</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">i2c0_dev</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> i2c0_cfg</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">i2c_configure</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">i2c1_dev</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> i2c1_cfg</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">/*创建一个线程，用于处理从设备的数据收发*/</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">k_thread_create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">slave_thread_data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> slave_stack_area</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token function" style="color:rgb(220, 220, 170)">K_THREAD_STACK_SIZEOF</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">slave_stack_area</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                    i2c_slave_thread</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">NULL</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">NULL</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">NULL</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pri</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> K_NO_WAIT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">/*创建一个线程，用于处理主设备的数据收发*/</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">k_thread_create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">master_thread_data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> master_stack_area</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token function" style="color:rgb(220, 220, 170)">K_THREAD_STACK_SIZEOF</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">master_stack_area</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> i2c_master_thread</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">NULL</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token constant" style="color:rgb(100, 102, 149)">NULL</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">NULL</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pri</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> K_NO_WAIT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><p>I2C sample更多内容请看<a href="/docs-csk6/chips/600X/application/peripheral/samples/i2c">I2C外设使用示例</a>。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="根据新的硬件配置板型文件dts"></a>根据新的硬件配置板型文件(.dts)<a class="hash-link" href="#根据新的硬件配置板型文件dts" title="Direct link to heading">#</a></h3><p>csk6 sdk默认支持了<code>csk6002_9s_nano</code>等开发板板型，开发者在使用官方的开发板时进行应用开发时可以直接使用这些板型。但在实际的应用场景中，开发者往往会基于CSK6芯片构建自己的硬件产品，开发者可能需要根据自己的硬件情况新增一个板型，具体实现请学习<a href="/docs-csk6/chips/600X/application/board">自定义板型</a>章节。</p><p>以上就是设备树的描述和使用示例，通过本章节的学习，您是否掌握了设备树的基本使用方法？如果您对设备树还有疑问或者有更深刻的理解，可以通过工单的形式向我们反馈，期待您的参与。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav><div class="gitalk-wrapper"><ul class="gitalk-option"><li class="like"><i class="icon like-icon"></i> <span id="like_num">有帮助  0</span></li><li class="unlike"><i class="icon unlike-icon"></i> <span id="unlike_num">没帮助 0</span></li><li>文档反馈</li></ul></div></div></div><div class="col col--3" style="padding-left:0px"><div class="tableOfContents_k96L thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#概述" class="table-of-contents__link">概述</a></li><li><a href="#什么是设备树" class="table-of-contents__link">什么是设备树</a></li><li><a href="#zephyr中的设备树" class="table-of-contents__link">Zephyr中的设备树</a><ul><li><a href="#设备树语法" class="table-of-contents__link">设备树语法</a></li></ul></li><li><a href="#zephyr-sdk中的设备树文件" class="table-of-contents__link">Zephyr SDK中的设备树文件</a><ul><li><a href="#zephyr系统中设备树编译流程" class="table-of-contents__link">zephyr系统中设备树编译流程</a></li></ul></li><li><a href="#在应用开发中使用设备树" class="table-of-contents__link">在应用开发中使用设备树</a><ul><li><a href="#设备树api接口" class="table-of-contents__link">设备树API接口</a></li><li><a href="#应用项目中使用设备树api接口获取设备实例" class="table-of-contents__link">应用项目中使用设备树API接口获取设备实例</a></li><li><a href="#在应用项目开发中重写overlay文件完成引脚功能复用" class="table-of-contents__link">在应用项目开发中重写(.overlay文件)完成引脚功能复用</a></li><li><a href="#根据新的硬件配置板型文件dts" class="table-of-contents__link">根据新的硬件配置板型文件(.dts)</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 安徽聆思智能科技有限公司皖ICP备05001217号</div></div></div></footer></div>
<script src="/docs-csk6/assets/js/runtime~main.ce611ca3.js"></script>
<script src="/docs-csk6/assets/js/main.b1c19881.js"></script>
<script>!function(e,n,s,t,d){e[s]=e[s]||function(){(e[s].a=e[s].a||[]).push(arguments)},(d=n.createElement("script")).async=!0,d.src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js",n.body.appendChild(d)}(window,document,"simplemde")</script></body>
</html>