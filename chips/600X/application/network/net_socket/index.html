<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.2">
<title data-react-helmet="true">网络连接 | 聆思文档中心</title><meta data-react-helmet="true" property="og:url" content="https://github.com/LISTENAI/docs-csk6/chips/600X/application/network/net_socket"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="网络连接 | 聆思文档中心"><meta data-react-helmet="true" name="description" content="概述"><meta data-react-helmet="true" property="og:description" content="概述"><link data-react-helmet="true" rel="shortcut icon" href="/docs-csk6/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://github.com/LISTENAI/docs-csk6/chips/600X/application/network/net_socket"><link data-react-helmet="true" rel="alternate" href="https://github.com/LISTENAI/docs-csk6/chips/600X/application/network/net_socket" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://github.com/LISTENAI/docs-csk6/chips/600X/application/network/net_socket" hreflang="x-default"><link rel="stylesheet" href="/docs-csk6/assets/css/styles.888b750d.css">
<link rel="preload" href="/docs-csk6/assets/js/runtime~main.69dcc439.js" as="script">
<link rel="preload" href="/docs-csk6/assets/js/main.91f98343.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_vO2r">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" titleclassname="navbar__title" href="/docs-csk6/"><img src="/docs-csk6/img/logo_light.svg" alt="LSOpen Logo" class="themedImage_K3WP themedImage--light_Fy0T navbar__logo"><img src="/docs-csk6/img/logo_dark.svg" alt="LSOpen Logo" class="themedImage_K3WP themedImage--dark_V9oi navbar__logo"></a><a class="navbar__item navbar__link" href="/docs-csk6/chips/4002/Chip_information_4002">芯片</a><a class="navbar__item navbar__link" href="/docs-csk6/tools/LStudio">工具</a><a class="navbar__item navbar__link" href="/docs-csk6/AIsolution/ESR/Quick_start/Scheme_introduction">AI语音应用方案</a><a class="navbar__item navbar__link" href="/docs-csk6/Industrysolution/Scanning_pen/Scheme_introduction">行业Turnkey解决方案</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs-csk6/FAQ/faq">FAQ</a><a class="navbar__item navbar__link" href="/docs-csk6/school/school">视频课程</a><a class="navbar__item navbar__link" href="/docs-csk6/workorder/workorder">工单</a><div class="react-toggle displayOnlyInLargeViewport_a-w0 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_8pH0"><img src="/docs-csk6/img/light.svg" alt="" class="themedImage_K3WP themedImage--light_Fy0T"><img src="/docs-csk6/img/unlight.svg" alt="" class="themedImage_K3WP themedImage--dark_V9oi"></span></div><div class="react-toggle-track-x"><span class="toggle_8pH0"><img src="/docs-csk6/img/undark.svg" alt="" class="themedImage_K3WP themedImage--light_Fy0T"><img src="/docs-csk6/img/dark.svg" alt="" class="themedImage_K3WP themedImage--dark_V9oi"></span></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="navbar__search searchBarContainer_I7kZ"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_Zg7X searchBarLoadingRing_J5Ez"><div></div><div></div><div></div><div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" titleclassname="navbar__title" href="/docs-csk6/"><img src="/docs-csk6/img/logo_light.svg" alt="LSOpen Logo" class="themedImage_K3WP themedImage--light_Fy0T navbar__logo"><img src="/docs-csk6/img/logo_dark.svg" alt="LSOpen Logo" class="themedImage_K3WP themedImage--dark_V9oi navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/chips/4002/Chip_information_4002">芯片</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/tools/LStudio">工具</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/AIsolution/ESR/Quick_start/Scheme_introduction">AI语音应用方案</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/Industrysolution/Scanning_pen/Scheme_introduction">行业Turnkey解决方案</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/FAQ/faq">FAQ</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/school/school">视频课程</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/workorder/workorder">工单</a></li></ul></div></div></div></nav><nav class="navbar subnavbar--fixed-top sub-navbar"><div class="navbar__inner subnavbar__inner"><div class="navbar__items"><a class="subnavbar__item subnavbar__link" dirname="/chips" href="/docs-csk6/chips/4002/Chip_information_4002">CSK4002</a><a aria-current="page" class="subnavbar__item subnavbar__link subnavbar__link--active" dirname="/chips" href="/docs-csk6/chips/600X/overview/chips">CSK600X</a><a class="subnavbar__item subnavbar__link" dirname="/chips" href="/docs-csk6/chips/micropython/index">MicroPython</a></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_Ol8-"><aside class="docSidebarContainer_UfDv"><div class="sidebar_OMtR"><nav class="menu menu--responsive thin-scrollbar menu_2y2e menuWithAnnouncementBar_Lwkw" aria-label="Sidebar navigation"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_IcOF" width="24" height="24" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--first menu__link--sublist" type="first" href="#!">简介</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/overview/chips">芯片</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" type="" href="#!" tabindex="-1">开发套件</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/overview/nanokit/nanokit_introduction">NanoKit开发套件</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" type="" href="#!" tabindex="-1">CSK6 NanoKit开发板</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/overview/nanokit/nanokit_csk6002_9s_nano">csk6002-9s-nano</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/overview/nanokit/nanokit_csk6011a_9s_nano">csk6011a-9s-nano</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" type="" href="#!" tabindex="-1">NanoKit 功能扩展板</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/overview/nanokit/nanokit_audio">语音功能板 v1</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/overview/system">系统与软件</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--first menu__link--sublist" type="first" href="#!">开发</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/application/getting_start">快速开始</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/application/application_development">应用开发</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" type="" href="#!" tabindex="-1">烧录与调试</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/gdbdebug/overview">概述</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/gdbdebug/csk6_load">CSK6 烧录</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/gdbdebug/gdbdebug-daplink">基于 DAPLink 的 GDB 调试</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/gdbdebug/gdbdebug-jlink">基于 J-Link 的 GDB 调试</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" type="" href="#!" tabindex="-1">lisa zephyr 命令行工具</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/tool/lisa_plugin_zephyr/index">概述</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/tool/lisa_plugin_zephyr/install">安装开发工具</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/tool/lisa_plugin_zephyr/basic">基础命令</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/tool/lisa_plugin_zephyr/command_detail">内置命令</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/tool/lisa_plugin_zephyr/config">配置</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/tool/lisa_plugin_zephyr/build_flash_debug">编译 烧录 调试</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/tool/lisa_plugin_zephyr/filesystem">文件系统相关</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/tool/lisa_plugin_zephyr/application_project">应用级提货单</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/tool/lisa_plugin_zephyr/trouble_shooting">疑难解答</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/tool/lisa_plugin_zephyr/release_note">lisa zephyr 更新日志</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/application/modules">模块</a></li></ul></li><li class="menu__list-item menu__list-item--current"><a class="menu__link menu__link--first menu__link--sublist menu__link--active" type="first" href="#!">使用示例</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" type="" href="#!" tabindex="0">外设驱动</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/application/peripheral/overview">外设驱动的使用</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/application/peripheral/samples/gpio">GPIO</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/application/peripheral/samples/pwm">PWM</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/application/peripheral/samples/UART">UART</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/application/peripheral/samples/I2C">I2C</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/application/peripheral/samples/spi">SPI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/application/peripheral/samples/ADC">SAR ADC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/application/peripheral/samples/RTC">RTC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/application/peripheral/samples/watchdog">WatchDog</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" type="" href="#!" tabindex="0">系统内核</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/application/kernel/overview">概述</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/application/kernel/timer">Timer定时器</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/application/kernel/multithread">多线程</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/application/kernel/sync_semaphore">信号量</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/application/kernel/sync_mutex">互斥量</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/application/kernel/sync_poll">轮询</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/application/kernel/thread_analyzer">线程分析器的使用</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/application/kernel/workqueue">工作队列的使用</a></li></ul></li><li class="menu__list-item menu__list-item--current"><a class="menu__link menu__link--sublist menu__link--active" type="" href="#!" tabindex="0">系统服务</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs-csk6/chips/600X/application/modules/overview">概述</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs-csk6/chips/600X/application/modules/logger">日志输出</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs-csk6/chips/600X/application/modules/usb_class">USB 模块</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs-csk6/chips/600X/application/modules/display_kscan">显示&amp;触摸</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs-csk6/chips/600X/application/modules/lvgl">LVGL</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs-csk6/chips/600X/application/shell_sample">Shell 的使用</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs-csk6/chips/600X/application/modules/nvs">NVS 的使用</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" type="" href="#!" tabindex="0">音频</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/application/audio/overview">概述</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/application/audio/audio_record">录音</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/application/audio/audio_playback">播音</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/application/audio/audio_record_play">录音和播音示例</a></li></ul></li><li class="menu__list-item menu__list-item--current"><a class="menu__link menu__link--sublist menu__link--active" type="" href="#!" tabindex="0">网络</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs-csk6/chips/600X/application/network/overview">概述</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs-csk6/chips/600X/application/network/wifi_connect">WIFI连接</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs-csk6/chips/600X/application/network/net_socket">网络连接</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" type="" href="#!" tabindex="0">自定义驱动</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/application/customdriver/custom-driver-video">添加自定义驱动</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" type="" href="#!" tabindex="0">自定义板型</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/application/board">添加自定义板型</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--first menu__link--sublist" type="first" href="#!">内核</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/kernel/index">概述</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/kernel/threads">线程</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/kernel/scheduling">调度</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/kernel/system_threads">系统线程</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/kernel/workqueue">工作队列线程</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/kernel/interrupts">中断</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/kernel/semaphores">信号量</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/kernel/mutexes">互斥量</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/kernel/timing/timers">定时器</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/kernel/fifos">FIFOs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/kernel/data_passing/pipes">管道</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--first menu__link--sublist" type="first" href="#!">系统服务</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/service/index">概述</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" type="" href="#!" tabindex="-1">存储</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/service/storage/nvs">非易失性存储 (NVS)</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/service/portability/posix">POSIX 支持</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/service/shell">Shell</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--first menu__link--sublist" type="first" href="#!">构建与配置系统</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/build/cmake/index">构建系统（ CMake ）</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" type="" href="#!" tabindex="-1">设备树</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/build/dts/intro">设备树概述</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/build/dts/design">设计目标</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/build/dts/bindings">设备树绑定</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/build/dts/howtos">设备树操作指引</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/build/dts/api_usage">在 C/C++ 中访问设备树</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/build/dts/troubleshooting">问题排查</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/build/dts/dt_vs_kconfig">设备树 VS Kconfig</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" type="" href="#!" tabindex="-1">API 引用</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/build/dts/api/index">概述</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/build/dts/api/api">设备树 API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/build/dts/api/bindings">绑定索引</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" type="" href="#!" tabindex="-1">Kconfig配置系统</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/build/kconfig/overview">概述</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/build/kconfig/Kconfig_gui">Kconfig交互界面</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/build/kconfig/Kconfig_configuration">设置Kconfig配置</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/build/kconfig/Kconfig_tips_and_demo">小贴士与最佳实践</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/build/kconfig/Kconfig_custom">自定义 Kconfig 预处理函数</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/build/kconfig/Kconfig_extension">Kconfig 拓展</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/build/zephyr_cmake_package">Zephyr CMake Package(包)</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--first menu__link--sublist" type="first" href="#!">硬件支持</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/hardware/pinctrl">引脚控制</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--first menu__link--sublist" type="first" href="#!">疑难解答</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/FAQ/index">FAQ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/chips/600X/quick_start/doc_issue">反馈</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--first menu__link--sublist" type="first" href="#!">引用</a><ul class="menu__list"><li class="menu__list-item"><a href="https://zephyr-docs.listenai.com/doxygen/html/index.html" target="_blank" rel="noopener noreferrer" class="menu__link" tabindex="0"><span>Zephyr API<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_qQrU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="menu__list-item"><a href="https://zephyr-docs.listenai.com/kconfig.html" target="_blank" rel="noopener noreferrer" class="menu__link" tabindex="0"><span>Kconfig 检索<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_qQrU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="menu__list-item"><a href="https://zephyr-docs.listenai.com/reference/devicetree/bindings.html" target="_blank" rel="noopener noreferrer" class="menu__link" tabindex="0"><span>设备树绑定索引<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_qQrU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_dRYS"><div class="container padding-top--md padding-bottom--lg center-container"><div class="row"><div class="col docItemCol_+xOG"><div class="docItemContainer_c+5G"><article><div class="markdown"><header><h1 class="h1Heading_5RMM">网络连接</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="概述"></a>概述<a class="hash-link" href="#概述" title="Direct link to heading">#</a></h2><p>CSK6-NanoKit开发板提供了网络连接及进行websocket收发数据的示例。</p><p>WIFI网络连接部分可以详见<a href="/docs-csk6/chips/600X/application/network/wifi_connect">WIFI连接</a>。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="相关-api接口"></a>相关 API接口<a class="hash-link" href="#相关-api接口" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="websocket_connect"></a>websocket_connect<a class="hash-link" href="#websocket_connect" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">websocket_connect</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> http_sock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">websocket_request</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">req</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">int32_t</span><span class="token plain"> timeout</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">user_data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><p>连接到提供websocket服务的服务器。建立连接后调用回调。返回的值是一个新的套接字描述符，可用于使用BSD套接字API发送/接收数据。</p><p>返回websocket id，该id用于<code>websocket_send_msg()</code>和<code>websocket_recv_msg()</code>的API接口。</p><p>参数说明：</p><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>http_sock</td><td>服务器的套接字id。请注意，此套接字用于进行HTTP握手等操作，实际的websocket连接是通过返回的websocket id完成的。注意，此函数返回后，http_sock不能关闭，因为它用于将websocket数据包传递到Websocket服务器。</td></tr><tr><td>req</td><td>websocket请求的信息，用户必须填充req结构体中的信息内容</td></tr><tr><td>timeout</td><td>等待连接的超时时间，以毫秒(ms)为单位。<code>SYS_FOREVER_MS</code>表示永远等待。</td></tr><tr><td>user_data</td><td>传递给回调函数的用户数据</td></tr></tbody></table><br><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="websocket_send_msg"></a>websocket_send_msg<a class="hash-link" href="#websocket_send_msg" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">websocket_send_msg</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> ws_sock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">uint8_t</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">payload</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">size_t</span><span class="token plain"> payload_len</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">               </span><span class="token keyword" style="color:rgb(86, 156, 214)">enum</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">websocket_opcode</span><span class="token plain"> opcode</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> bool mask</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> bool final</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">               </span><span class="token class-name" style="color:rgb(78, 201, 176)">int32_t</span><span class="token plain"> timeout</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><p>发送websocket数据。该函数接口会给待发送的数据，先添加上websocket的header信息再发送。</p><p>成功返回发送的字节数，大于或等于0，失败返回值小于0。</p><p><strong>参数说明：</strong></p><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>ws_sock</td><td>websocket id，<code>websocket_connect</code>接口的返回值</td></tr><tr><td>payload</td><td>待发送的数据</td></tr><tr><td>payload_len</td><td>待发送数据的长度</td></tr><tr><td>opcode</td><td>发送数据的格式，参照下述<code>enum websocket_opcode</code>枚举</td></tr><tr><td>mask</td><td>掩码操作，表示是否要对数据进行掩码操作</td></tr><tr><td>final</td><td>是否是发送的最后一条数据。<br>如果final为false（分段发送的消息数据），那么发送的第一条数据消息的opcode参数设置成适当的值，后续子序列发送的时候，opcode必须或上<code>WEBSOCKET_OPCODE_CONTINUE</code>。<br>如果final为true且只剩下这条消息数据，则opcode应该设置适当的值，如<code>WEBSOCKET_OPCODE_DATA_TEXT</code>或<code>WEBSOCKET_OPCODE_DATA_BINARY</code>。</td></tr><tr><td>timeout</td><td>发送数据的超时时间，以毫秒(ms)为单位，值<code>SYS_FOREVER_MS</code>表示永远等待。</td></tr></tbody></table><p><code>enum websocket_opcode</code>枚举值如下：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">enum</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">websocket_opcode</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    WEBSOCKET_OPCODE_CONTINUE     </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0x00</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    WEBSOCKET_OPCODE_DATA_TEXT    </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0x01</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    WEBSOCKET_OPCODE_DATA_BINARY  </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0x02</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    WEBSOCKET_OPCODE_CLOSE        </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0x08</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    WEBSOCKET_OPCODE_PING         </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0x09</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    WEBSOCKET_OPCODE_PONG         </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0x0A</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><br><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="websocket_recv_msg"></a>websocket_recv_msg<a class="hash-link" href="#websocket_recv_msg" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">websocket_recv_msg</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> ws_sock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">uint8_t</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">buf</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">size_t</span><span class="token plain"> buf_len</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">               </span><span class="token class-name" style="color:rgb(78, 201, 176)">uint32_t</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">message_type</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">uint64_t</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">remaining</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">               </span><span class="token class-name" style="color:rgb(78, 201, 176)">int32_t</span><span class="token plain"> timeout</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><p>接收websocket数据。该函数接口会将收到的数据，去掉websocket的header信息。</p><p>成功返回接收到的字节数，大于或等于0，失败返回值小于0。</p><p><strong>参数说明：</strong></p><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>ws_sock</td><td>websocket id，<code>websocket_connect</code>接口的返回值</td></tr><tr><td>buf</td><td>存放收到的数据的缓存</td></tr><tr><td>buf_len</td><td>buf的缓存大小</td></tr><tr><td>message_type</td><td>消息类型</td></tr><tr><td>remaining</td><td>接收完该消息后，还剩多少数据</td></tr><tr><td>timeout</td><td>接收数据的超时时间，以毫秒(ms)为单位，值<code>SYS_FOREVER_MS</code>表示永远等待。</td></tr></tbody></table><br><p>更多websocket API接口描述请查看CSK6 SDK websocket头文件描述：<a href="https://cloud.listenai.com/zephyr/zephyr/-/blob/master/include/net/websocket.h" target="_blank" rel="noopener noreferrer"><code>include/net/websocket.h</code></a>)。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="使用示例"></a>使用示例<a class="hash-link" href="#使用示例" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="实现逻辑"></a>实现逻辑<a class="hash-link" href="#实现逻辑" title="Direct link to heading">#</a></h3><p>本示例实现以下业务逻辑：</p><ul><li>连接一个AP热点，并获取IP地址信息，热点配置：ssid: xiaowei-yyds pwd: xiaowei-yyds（WIFI网络连接部分解析可以详见<a href="/docs-csk6/chips/600X/application/network/wifi_connect">WIFI连接</a>）。</li><li>使用websocket连接服务器。（本示例的服务器由websocket工具软件搭建）</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="准备工作"></a>准备工作<a class="hash-link" href="#准备工作" title="Direct link to heading">#</a></h3><p>本示例基于CSK6-NanoKit开发板基于<a href="/docs-csk6/chips/600X/application/network/wifi_connect">WIFI连接</a>章节示例代码进行改造，连接完wifi后进行websocket网络。</p><ul><li>CSK6-NanoKit开发板</li><li>手机或路由器设置一个WiFi热点，本示例中使用热点(ssid: xiaowei-yyds pwd: xiaowei-yyds)的做测试</li><li>改造wifi sameple示例代码作为本章节的websocket 代码接口使用</li><li>本示例websocket代码基于zephyr提供的websocket示例代码作为自己的工程改造，改造前源代码可参考路径<code>sdk/zephyr/samples/net/sockets/websocket_client</code></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="获取wifi-sample项目"></a>获取wifi sample项目<a class="hash-link" href="#获取wifi-sample项目" title="Direct link to heading">#</a></h3><p>通过Lisa命令创建项目：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv"><pre tabindex="0" class="prism-code language-undefined codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token plain">lisa zep create</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><p><img src="/docs-csk6/assets/images/liza_zep_create-2b31c9953e388e8804c8d3c9f7efa66f.png">
按以下目录选择完成sample创建：  </p><blockquote><p>boards → csk6 → network → wifi_sta</p></blockquote><p>sample 创建完成。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="wifi示例代码改造"></a>wifi示例代码改造<a class="hash-link" href="#wifi示例代码改造" title="Direct link to heading">#</a></h3><ul><li>将wifi的main函数，改造成接口的形式，接口名改为：wifi_connect，并在文件中加入信号量阻塞，以便直到wifi连通后，才可以往下运行websocket的示例，信号量相关章节可以查看<a href="/docs-csk6/chips/600X/application/kernel/sync_semaphore">线程间同步之信号量</a>；</li><li>本地创建wifi_connect.h空文件，并将wifi_connect.c中的wifi_connect接口添加进去以便在其他地方可以调用；</li><li>将wifi示例代码的文件夹中的main.c改名为wifi_connect.c，并且在wifi_connect.c中调用<code>#include&quot;wifi_connect.h&quot;</code>;</li><li>将改造后的代码以及Kconfig文件，放到自己的websocket工程目录下；</li><li>将wifi的prj.conf内容，添加到websocket工程目录下的prj.conf中；</li></ul><p>如下所示：</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="步骤一"></a>步骤一：<a class="hash-link" href="#步骤一" title="Direct link to heading">#</a></h4><p>main接口改名为wifi_connect</p><p><img alt="wifi_change_main" src="/docs-csk6/assets/images/wifi_change_main-252c8121f96de31944377311d15c7b7e.png"></p><p>定义初始化全局的信号量<code>K_SEM_DEFINE(wifi_mutex_test, 0, 1);</code></p><p>并在<code>handler_cb</code>函数接口中添加<code>k_sem_give(&amp;wifi_mutex_test);</code></p><p><img src="/docs-csk6/assets/images/wifi_add_sem1-915cdbc1f967c3e7dac29c8836dc8dda.png"></p><p>在<code>wifi_connect</code>接口最后添加<code>k_sem_take(&amp;wifi_mutex_test, K_FOREVER);</code></p><p><img src="/docs-csk6/assets/images/wifi_add_sem2-75333c8ab97e7d8f558f823820d16d5a.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="步骤二"></a>步骤二：<a class="hash-link" href="#步骤二" title="Direct link to heading">#</a></h4><p>创建头文件wifi_connect.h</p><p><img src="/docs-csk6/assets/images/wifi_connect_head_file-23362ffa52c46fed7b022e877f0268d7.png"></p><p>代码如下：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">ifndef</span><span class="token macro property"> </span><span class="token macro property expression">__WIFI_CONNECT_TEST__</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">define</span><span class="token macro property"> </span><span class="token macro property macro-name">__WIFI_CONNECT_TEST__</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">wifi_connect</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">endif</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="步骤三"></a>步骤三：<a class="hash-link" href="#步骤三" title="Direct link to heading">#</a></h4><p>头文件包含到c文件中</p><p><img src="/docs-csk6/assets/images/wifi_add_head_to_c_file-0cc3c3c2af7a532bf872e71c768f83de.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="步骤四"></a>步骤四：<a class="hash-link" href="#步骤四" title="Direct link to heading">#</a></h4><p>将改造后的wifi相关加入websocket的工程目录</p><p><img src="/docs-csk6/assets/images/add_wifi_to_dir1-b233fe1dc0b38f281091a2d2f9037aa1.png"></p><p><img src="/docs-csk6/assets/images/add_wifi_to_dir2-0c2cc2ae59af925c27d53d9c9034ac5e.png"></p><p>（websocket的工程目录中的代码，取自zephyr中sdk做改造，源路径为<code>sdk/zephyr/samples/net/sockets/websocket_client</code>）</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="步骤五"></a>步骤五：<a class="hash-link" href="#步骤五" title="Direct link to heading">#</a></h4><p>wifi的prj.conf内容添加到websocket工程目录下的prj.conf中，修改后的<code>prj.conf</code>内容如下：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv shell"><pre tabindex="0" class="prism-code language-shell codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"># 打开WiFi驱动配置</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_WIFI</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">y</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_CSK_WIFI_STATION</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">y</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_NET_L2_ETHERNET</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">y</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 打开NET网络配置</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_NETWORKING</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">y</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_NET_DHCPV4</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">y</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_NET_IPV4</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">y</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_NET_SOCKETS</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">y</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_TEST_RANDOM_GENERATOR</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">y</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_NET_SOCKETS_POSIX_NAMES</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">y</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 网络管理配置</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_NET_MGMT</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">y</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_NET_MGMT_EVENT</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">y</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_NET_MGMT_EVENT_STACK_SIZE</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">4096</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 网络线程栈配置</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_NET_RX_STACK_SIZE</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">2048</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_NET_TX_STACK_SIZE</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">2048</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 网络的内存池配置</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_NET_PKT_RX_COUNT</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">16</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_NET_PKT_TX_COUNT</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">16</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_NET_BUF_RX_COUNT</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">64</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_NET_BUF_TX_COUNT</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">64</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_NET_CONTEXT_NET_PKT_POOL</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">y</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 引用名为newlib的libc标准库</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_NEWLIB_LIBC</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">y</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># SYSTEM WORKQUEUE线程栈</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">2048</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 系统堆，分配内存，可根据实际使用配置</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_HEAP_MEM_POOL_SIZE</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">60000</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_MAIN_STACK_SIZE</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">10000</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_INIT_STACKS</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">y</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 打开LOG配置</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_LOG</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">y</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_WIFI_LOG_LEVEL_DBG</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">y</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_NET_TCP</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">y</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_NET_SHELL</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">y</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_NET_STATISTICS</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">y</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Sockets</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_NET_SOCKETS_POLL_MAX</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">4</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># HTTP &amp; Websocket</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_HTTP_CLIENT</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">y</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_WEBSOCKET_CLIENT</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">y</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_LOG_MODE_IMMEDIATE</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">y</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CONFIG_NET_LOG</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">y</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="mainc代码示例"></a>main.c代码示例<a class="hash-link" href="#mainc代码示例" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">/*</span></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * Copyright (c) 2019 Intel Corporation</span></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> *</span></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * SPDX-License-Identifier: Apache-2.0</span></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;logging/log.h&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">LOG_MODULE_REGISTER</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">net_websocket_client_sample</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> LOG_LEVEL_DBG</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;net/net_ip.h&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;net/socket.h&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;net/tls_credentials.h&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;net/websocket.h&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;random/rand32.h&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;shell/shell.h&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&quot;ca_certificate.h&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&quot;wifi_connect.h&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">define</span><span class="token macro property"> </span><span class="token macro property macro-name">SERVER_PORT</span><span class="token macro property"> </span><span class="token macro property expression number" style="color:rgb(181, 206, 168)">8080</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">if</span><span class="token macro property"> </span><span class="token macro property expression number" style="color:rgb(181, 206, 168)">0</span><span class="token macro property expression"> </span><span class="token macro property comment" style="color:rgb(106, 153, 85)">//这里也可以从prj.conf中配置</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">if</span><span class="token macro property"> </span><span class="token macro property expression function" style="color:rgb(220, 220, 170)">defined</span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token macro property expression">CONFIG_NET_CONFIG_PEER_IPV6_ADDR</span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">define</span><span class="token macro property"> </span><span class="token macro property macro-name">SERVER_ADDR6</span><span class="token macro property">  </span><span class="token macro property expression">CONFIG_NET_CONFIG_PEER_IPV6_ADDR</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">define</span><span class="token macro property"> </span><span class="token macro property macro-name">SERVER_ADDR6</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">endif</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">if</span><span class="token macro property"> </span><span class="token macro property expression function" style="color:rgb(220, 220, 170)">defined</span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token macro property expression">CONFIG_NET_CONFIG_PEER_IPV4_ADDR</span><span class="token macro property expression punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">define</span><span class="token macro property"> </span><span class="token macro property macro-name">SERVER_ADDR4</span><span class="token macro property">  </span><span class="token macro property expression">CONFIG_NET_CONFIG_PEER_IPV4_ADDR</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">define</span><span class="token macro property"> </span><span class="token macro property macro-name">SERVER_ADDR4</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&quot;192.168.101.10&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">endif</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">define</span><span class="token macro property"> </span><span class="token macro property macro-name">SERVER_ADDR4</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&quot;192.168.101.10&quot;</span><span class="token macro property"> </span><span class="token macro property comment" style="color:rgb(106, 153, 85)">//这里的地址，是准备发送websocket数据的目标服务器地址，</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                                   </span><span class="token comment" style="color:rgb(106, 153, 85)">//本示例使用的是自己电脑搭建的服务器地址</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">endif</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">/* Generated by http://www.lipsum.com/</span></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * 2 paragraphs, 178 words, 1160 bytes of Lorem Ipsum</span></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">if</span><span class="token macro property"> </span><span class="token macro property expression number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">char</span><span class="token plain"> lorem_ipsum</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit. &quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Vestibulum ultricies sapien tellus, ac viverra dolor bibendum &quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;lacinia. Vestibulum et nisl tristique tellus finibus gravida &quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;vitae sit amet nunc. Suspendisse maximus justo mi, vitae porta &quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;risus suscipit vitae. Curabitur ut fringilla velit. Donec ac nisi &quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;in dui semper lobortis sed nec ante. Sed nec luctus dui. Sed ut &quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;ante nisi. Mauris congue euismod felis, et maximus ex pellentesque &quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;nec. Proin nibh nisl, semper at nunc in, mattis pharetra metus. Nam &quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;turpis risus, pulvinar sit amet varius ac, pellentesque quis purus.&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot; &quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Nam consequat purus in lacinia fringilla. Morbi volutpat, tellus &quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;nec tempus dapibus, ante sem aliquam dui, eu feugiat libero diam &quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;at leo. Sed suscipit egestas orci in ultrices. Integer in elementum &quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;ligula, vel sollicitudin velit. Nullam sit amet eleifend libero. &quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Proin sit amet consequat tellus, vel vulputate arcu. Curabitur quis &quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;lobortis lacus. Sed faucibus vestibulum enim vel elementum. Vivamus &quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;enim nunc, auctor in purus at, aliquet pulvinar eros. Cras dapibus &quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;nec quam laoreet sagittis. Quisque dictum ante odio, at imperdiet &quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;est convallis a. Morbi mattis ut orci vitae volutpat.&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;\n&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">char</span><span class="token plain"> lorem_ipsum</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;wo wo wo wo aaaaa dffghhh&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;\n&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">endif</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">define</span><span class="token macro property"> </span><span class="token macro property macro-name">MAX_RECV_BUF_LEN</span><span class="token macro property"> </span><span class="token macro property expression number" style="color:rgb(181, 206, 168)">512</span><span class="token macro property expression"> </span><span class="token macro property comment" style="color:rgb(106, 153, 85)">//(sizeof(lorem_ipsum) - 1)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> ipsum_len </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> MAX_RECV_BUF_LEN</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">//这里的buf正式使用的时候，需要申请大一点，避免接收数据太多而导致内存溢出</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">//这里申请的内存大小，要注意依据prj.conf文件中的内存字段大小，避免超出运行内存导致溢出</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">uint8_t</span><span class="token plain"> recv_buf_ipv4</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">MAX_RECV_BUF_LEN</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">uint8_t</span><span class="token plain"> recv_buf_ipv6</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">MAX_RECV_BUF_LEN</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">define</span><span class="token macro property"> </span><span class="token macro property macro-name">EXTRA_BUF_SPACE</span><span class="token macro property"> </span><span class="token macro property expression number" style="color:rgb(181, 206, 168)">30</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">uint8_t</span><span class="token plain"> temp_recv_buf_ipv4</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">MAX_RECV_BUF_LEN </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> EXTRA_BUF_SPACE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">uint8_t</span><span class="token plain"> temp_recv_buf_ipv6</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">MAX_RECV_BUF_LEN </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> EXTRA_BUF_SPACE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">//创建socket</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">setup_socket</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name" style="color:rgb(78, 201, 176)">sa_family_t</span><span class="token plain"> family</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">char</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">server</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> port</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">sock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">sockaddr</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">socklen_t</span><span class="token plain"> addr_len</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">char</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">family_str </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> family </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> AF_INET </span><span class="token operator" style="color:rgb(212, 212, 212)">?</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;IPv4&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;IPv6&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> ret </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">memset</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> addr_len</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">family </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> AF_INET</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">net_sin</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">sin_family </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> AF_INET</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">net_sin</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">sin_port </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">htons</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">port</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">inet_pton</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">family</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> server</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token function" style="color:rgb(220, 220, 170)">net_sin</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">sin_addr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">net_sin6</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">sin6_family </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> AF_INET6</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">net_sin6</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">sin6_port </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">htons</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">port</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">inet_pton</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">family</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> server</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token function" style="color:rgb(220, 220, 170)">net_sin6</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">sin6_addr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">sock </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">socket</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">family</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> SOCK_STREAM</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> IPPROTO_TCP</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">sock </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">LOG_ERR</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Failed to create %s HTTP socket (%d)&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> family_str</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">errno</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> ret</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">fail</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">sock </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">close</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">sock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">sock </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> ret</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">//连接socket</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">connect_socket</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name" style="color:rgb(78, 201, 176)">sa_family_t</span><span class="token plain"> family</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">char</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">server</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> port</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">sock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">sockaddr</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">socklen_t</span><span class="token plain"> addr_len</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> ret</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ret </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">setup_socket</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">family</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> server</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> port</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> sock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> addr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> addr_len</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">ret </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">||</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">sock </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ret </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">connect</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">sock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> addr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> addr_len</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">ret </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">LOG_ERR</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Cannot connect to %s remote (%d)&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            family </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> AF_INET </span><span class="token operator" style="color:rgb(212, 212, 212)">?</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;IPv4&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;IPv6&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">errno</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        ret </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">errno</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> ret</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">//连接websocket的回调函数</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">connect_cb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> sock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">http_request</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">req</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">user_data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">printk</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Websocket %d for %s connected.&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> sock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">char</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">user_data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">size_t</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">how_much_to_send</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name" style="color:rgb(78, 201, 176)">size_t</span><span class="token plain"> max_len</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token class-name" style="color:rgb(78, 201, 176)">size_t</span><span class="token plain"> amount</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">do</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        amount </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">sys_rand32_get</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">%</span><span class="token plain"> max_len</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">amount </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0U</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> amount</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">//websocket发送数据</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">ssize_t</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">sendall_with_ws_api</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> sock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">buf</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">size_t</span><span class="token plain"> len</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">websocket_send_msg</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">sock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> buf</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> len</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> WEBSOCKET_OPCODE_DATA_TEXT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                  true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> SYS_FOREVER_MS</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">ssize_t</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">sendall_with_bsd_api</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> sock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">buf</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">size_t</span><span class="token plain"> len</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">send</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">sock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> buf</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> len</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">//websocket接收数据</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">recv_data_wso_api</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> sock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">size_t</span><span class="token plain"> amount</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">uint8_t</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">buf</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                  </span><span class="token class-name" style="color:rgb(78, 201, 176)">size_t</span><span class="token plain"> buf_len</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">char</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">proto</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token class-name" style="color:rgb(78, 201, 176)">uint64_t</span><span class="token plain"> remaining </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> ULLONG_MAX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> total_read</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token class-name" style="color:rgb(78, 201, 176)">uint32_t</span><span class="token plain"> message_type</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> ret</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> read_pos</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    read_pos </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    total_read </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">remaining </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        ret </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">websocket_recv_msg</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">sock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> buf </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> read_pos</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                     buf_len </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> read_pos</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                     </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">message_type</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                     </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">remaining</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                     </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">ret </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">ret </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">EAGAIN</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token function" style="color:rgb(220, 220, 170)">k_sleep</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token function" style="color:rgb(220, 220, 170)">K_MSEC</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">50</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token keyword" style="color:rgb(86, 156, 214)">continue</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token function" style="color:rgb(220, 220, 170)">LOG_DBG</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;%s connection closed while &quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;waiting (%d/%d)&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> proto</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> ret</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> errno</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">break</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        read_pos </span><span class="token operator" style="color:rgb(212, 212, 212)">+=</span><span class="token plain"> ret</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        total_read </span><span class="token operator" style="color:rgb(212, 212, 212)">+=</span><span class="token plain"> ret</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">remaining </span><span class="token operator" style="color:rgb(212, 212, 212)">!=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">||</span><span class="token plain"> total_read </span><span class="token operator" style="color:rgb(212, 212, 212)">!=</span><span class="token plain"> amount </span><span class="token operator" style="color:rgb(212, 212, 212)">||</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">/* Do not check the final \n at the end of the msg */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">memcmp</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">lorem_ipsum</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> buf</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> amount </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">!=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">LOG_ERR</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;%s data recv failure %zd/%d bytes (remaining %&quot;</span><span class="token plain"> PRId64 </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;)&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            proto</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> amount</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> total_read</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> remaining</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">LOG_HEXDUMP_DBG</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">buf</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> total_read</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;received ws buf&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">LOG_HEXDUMP_DBG</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">lorem_ipsum</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> total_read</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;sent ws buf&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">LOG_DBG</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;%s recv %d bytes&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> proto</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> total_read</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">recv_data_bsd_api</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> sock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">size_t</span><span class="token plain"> amount</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">uint8_t</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">buf</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                  </span><span class="token class-name" style="color:rgb(78, 201, 176)">size_t</span><span class="token plain"> buf_len</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">char</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">proto</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> remaining</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> ret</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> read_pos</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    remaining </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> amount</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    read_pos </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">remaining </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        ret </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">recv</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">sock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> buf </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> read_pos</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> buf_len </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> read_pos</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">ret </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">errno </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> EAGAIN </span><span class="token operator" style="color:rgb(212, 212, 212)">||</span><span class="token plain"> errno </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> ETIMEDOUT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token function" style="color:rgb(220, 220, 170)">k_sleep</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token function" style="color:rgb(220, 220, 170)">K_MSEC</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">50</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token keyword" style="color:rgb(86, 156, 214)">continue</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token function" style="color:rgb(220, 220, 170)">LOG_DBG</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;%s connection closed while &quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;waiting (%d/%d)&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> proto</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> ret</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> errno</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">break</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        read_pos </span><span class="token operator" style="color:rgb(212, 212, 212)">+=</span><span class="token plain"> ret</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        remaining </span><span class="token operator" style="color:rgb(212, 212, 212)">-=</span><span class="token plain"> ret</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">remaining </span><span class="token operator" style="color:rgb(212, 212, 212)">!=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">||</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">//最后一个字符是&#x27;\n&#x27;，注意别比较进去</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">memcmp</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">lorem_ipsum</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> buf</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> amount </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">!=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">LOG_ERR</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;%s data recv failure %zd/%d bytes (remaining %d)&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            proto</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> amount</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> read_pos</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> remaining</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">LOG_HEXDUMP_DBG</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">buf</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> read_pos</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;received bsd buf&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">LOG_HEXDUMP_DBG</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">lorem_ipsum</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> read_pos</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;sent bsd buf&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">LOG_DBG</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;%s recv %d bytes&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> proto</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> read_pos</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">//websocket发送数据以及等待接收回来的数据</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> bool </span><span class="token function" style="color:rgb(220, 220, 170)">send_and_wait_msg</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> sock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">size_t</span><span class="token plain"> amount</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">char</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">proto</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                  </span><span class="token class-name" style="color:rgb(78, 201, 176)">uint8_t</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">buf</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">size_t</span><span class="token plain"> buf_len</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> count</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> ret</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">sock </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">memcpy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">buf</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> lorem_ipsum</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> amount</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    buf</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">amount</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token char" style="color:rgb(209, 105, 105)">&#x27;\n&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">/* 使用专用websocket API和通用BSD套接字API每2次发送一次消息。</span></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">     * 真正的应用程序不会像这样做，但在这里我们想要测试这两个API。</span></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">     */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">count </span><span class="token operator" style="color:rgb(212, 212, 212)">%</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        ret </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">sendall_with_ws_api</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">sock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> buf</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> amount </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        ret </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">sendall_with_bsd_api</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">sock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> buf</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> amount </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">ret </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">ret </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token function" style="color:rgb(220, 220, 170)">LOG_ERR</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;%s failed to send data using %s (%d)&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> proto</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">count </span><span class="token operator" style="color:rgb(212, 212, 212)">%</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">?</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;ws API&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;socket API&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> ret</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token function" style="color:rgb(220, 220, 170)">LOG_DBG</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;%s connection closed&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> proto</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> false</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">LOG_DBG</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;%s sent %d bytes&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> proto</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> ret</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">count </span><span class="token operator" style="color:rgb(212, 212, 212)">%</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">recv_data_wso_api</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">sock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> amount </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> buf</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> buf_len</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> proto</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">recv_data_bsd_api</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">sock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> amount </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> buf</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> buf_len</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> proto</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    count</span><span class="token operator" style="color:rgb(212, 212, 212)">++</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">main</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">//以下字符只是一个演示作用，不是固定写死的字符</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">char</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">extra_headers</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Origin: http://foobar\r\n&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token constant" style="color:rgb(100, 102, 149)">NULL</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> sock4 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> sock6 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> websock4 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> websock6 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token class-name" style="color:rgb(78, 201, 176)">int32_t</span><span class="token plain"> timeout </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> MSEC_PER_SEC</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">sockaddr_in6</span><span class="token plain"> addr6</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">sockaddr_in</span><span class="token plain"> addr4</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token class-name" style="color:rgb(78, 201, 176)">size_t</span><span class="token plain"> amount</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> ret</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">//以下代码是wifi中的sample代码，在这里联wifi，连接不上会阻塞在这里，</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">//wifi名字可以在Kconfig文件中去修改默认，</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">//也可以在wifi_connect.c文件中去强制定义对应的宏即可</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">/**********************************begin:add to connect wifi**********************************/</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">printk</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;-----------------------wifi connect begin-----------------------\r\n&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">wifi_connect</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">printk</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;-----------------------wifi connect over-----------------------\r\n&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">/**********************************end:  add to connect wifi**********************************/</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">if</span><span class="token macro property"> </span><span class="token macro property expression number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token function" style="color:rgb(220, 220, 170)">IS_ENABLED</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">CONFIG_NET_SOCKETS_SOCKOPT_TLS</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        ret </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">tls_credential_add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">CA_CERTIFICATE_TAG</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                     TLS_CREDENTIAL_CA_CERTIFICATE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                     ca_certificate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                     </span><span class="token keyword" style="color:rgb(86, 156, 214)">sizeof</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">ca_certificate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">ret </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token function" style="color:rgb(220, 220, 170)">LOG_ERR</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Failed to register public certificate: %d&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                ret</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token function" style="color:rgb(220, 220, 170)">k_sleep</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">K_FOREVER</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">endif</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token function" style="color:rgb(220, 220, 170)">IS_ENABLED</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">CONFIG_NET_IPV4</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token function" style="color:rgb(220, 220, 170)">connect_socket</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">AF_INET</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> SERVER_ADDR4</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> SERVER_PORT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                     </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">sock4</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">sockaddr</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">addr4</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                     </span><span class="token keyword" style="color:rgb(86, 156, 214)">sizeof</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">addr4</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">sock4 </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">LOG_ERR</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Cannot create HTTP connection.&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">k_sleep</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">K_FOREVER</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">printk</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;socket =(%d) \r\n&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> sock4</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">k_sleep</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token function" style="color:rgb(220, 220, 170)">K_MSEC</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">100</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">sock4 </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">IS_ENABLED</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">CONFIG_NET_IPV4</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">websocket_request</span><span class="token plain"> req</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">memset</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">req</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">sizeof</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">req</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        req</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">host </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> SERVER_ADDR4</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        req</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">url </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;/&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        req</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">optional_headers </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> extra_headers</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        req</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">cb </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> connect_cb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        req</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">tmp_buf </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> temp_recv_buf_ipv4</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        req</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">tmp_buf_len </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">sizeof</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">temp_recv_buf_ipv4</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        websock4 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">websocket_connect</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">sock4</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">req</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> timeout</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;IPv4&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">websock4 </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token function" style="color:rgb(220, 220, 170)">LOG_ERR</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Cannot connect to %s:%d&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> SERVER_ADDR4</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> SERVER_PORT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token function" style="color:rgb(220, 220, 170)">close</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">sock4</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">printk</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; websock4 =(%d) \r\n&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> websock4</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">k_sleep</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token function" style="color:rgb(220, 220, 170)">K_MSEC</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">100</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">websock4 </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">LOG_ERR</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;No IPv4 connectivity&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">k_sleep</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">K_FOREVER</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        amount </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">how_much_to_send</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">ipsum_len</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">websock4 </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;&amp;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token operator" style="color:rgb(212, 212, 212)">!</span><span class="token function" style="color:rgb(220, 220, 170)">send_and_wait_msg</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">websock4</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> amount</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;IPv4&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                       recv_buf_ipv4</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">sizeof</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">recv_buf_ipv4</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">break</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">k_sleep</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token function" style="color:rgb(220, 220, 170)">K_MSEC</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">250</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">websock4 </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">close</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">websock4</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">websock6 </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">close</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">websock6</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">k_sleep</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">K_FOREVER</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="测试说明"></a>测试说明<a class="hash-link" href="#测试说明" title="Direct link to heading">#</a></h3><p>因为本示例需要连接到websocket，本示例使用的websocket是使用网络下载的工具作为websocket的服务器，用户测试需要发送到有意义的websocket服务器地址才可以进行收发，或者自行搭建即可。这里对服务器的搭建暂时不做过多解释，用户可以自行查找搭建方式。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="测试目标"></a>测试目标<a class="hash-link" href="#测试目标" title="Direct link to heading">#</a></h3><p>CSK6-NanoKit启动后，往目标服务器发送代码中写死的自定义的数据，且等待接收服务器返回的数据并打印出来，即可表示测试成功，如下图所示：</p><p><img src="/docs-csk6/assets/images/websocket_send_recv-53bc849019f586b4a46863c4a566081e.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="编译和烧录"></a>编译和烧录<a class="hash-link" href="#编译和烧录" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="编译"></a>编译<a class="hash-link" href="#编译" title="Direct link to heading">#</a></h4><p>在app根目录下通过以下指令完成编译：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv shell"><pre tabindex="0" class="prism-code language-shell codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token plain">lisa zep build -b csk6002_9s_nano</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="烧录"></a>烧录<a class="hash-link" href="#烧录" title="Direct link to heading">#</a></h4><p>CSK6-NanoKit通过USB连接PC，通过烧录指令开始烧录：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv shell"><pre tabindex="0" class="prism-code language-shell codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token plain">lisa zep flash --runner pyocd</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="查看结果"></a>查看结果<a class="hash-link" href="#查看结果" title="Direct link to heading">#</a></h4><p><strong>查看日志：</strong></p><p>CSK6-NanoKit通过板载DAPlink虚拟串口连接电脑，或者将CSK6-NanoKit的日志串口<code>A03 TX A02 RX</code>外接串口板并连接电脑。</p><ul><li>在电脑端使用串口调试助手查看日志，默认波特率为115200。</li></ul><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv shell"><pre tabindex="0" class="prism-code language-shell codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain">:05:46.941</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">收←◆*** Booting Zephyr OS build v1.0.3-alpha.2  ***</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-----------------------wifi connect begin-----------------------</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">xradio_generate_random_mac_addr, </span><span class="token number" style="color:rgb(181, 206, 168)">11</span><span class="token plain">, generate random mac addr</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">mac_addr: </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;44:29:04:e3:49:64&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">xr_taskqueue_start_thread , </span><span class="token number" style="color:rgb(181, 206, 168)">132</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">+-+0x8f098 :umac,8192</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">32muart:~$ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain">:05:47.810</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">收←◆</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">wlan information </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">firmware:</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    version </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">:</span><span class="token plain"> R0-XR_C07.08.52.65_02.65 Mar  </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2021</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">11</span><span class="token plain">:45:46 </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    buffer  </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">30</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">driver:</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    version </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">:</span><span class="token plain"> XR_V02.05_20220524v1</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">mac address:</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> use        </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">44</span><span class="token plain">:29:04:e3:49:64</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> use        </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">44</span><span class="token plain">:29:04:e3:49:65</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">8D</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">J</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">00:00:00.904,000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">dbg</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> csk_wifi.wlan_event_handler: Got wlan event </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">WLAN_EVENT_FW_STARTUP_DONE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">, current state</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">WIFI_SM_ON_STARTUP</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">32muart:~$ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">m</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">8D</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">J</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">00:00:00.920,000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">dbg</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> csk_wifi.wifi_obj_set_sm: </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">91</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">STA_SM: current</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">WIFI_SM_ON_STARTUP</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">, next</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">WIFI_SM_STARTUP_DONE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">32muart:~$ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">m</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">8D</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">J</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">00:00:00.935,000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">inf</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> csk_wifi: WiFi module startup done</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">32muart:~$ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain">:05:47.923</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">收←◆wlan_sta_set_autoconnect </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">enable</span><span class="token plain"> :0 </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">connecting to wifi: xiaowei-yyds </span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">8D</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">J</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">00:00:00.990,000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">dbg</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> csk_wifi.wifi_obj_set_sm: </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">91</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">STA_SM: current</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">WIFI_SM_STARTUP_DONE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">, next</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">WIFI_SM_STA_ON_CONNECT_SCAN</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">32muart:~$ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain">:05:48.969</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">收←◆EVENT NOTIFY WLAN_EVENT_SCAN_SUCCESS</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">8D</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">J</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">00:00:02.033,000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">dbg</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> csk_wifi.wlan_event_handler: Got wlan event </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">WLAN_EVENT_SCAN_SUCCESS</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">, current state</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">WIFI_SM_STA_ON_CONNECT_SCAN</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">32muart:~$ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">m</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">8D</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">J</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">00:00:02.050,000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">inf</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> csk_wifi: STA_SM</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">WIFI_SM_STA_ON_CONNECT_SCAN</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">: scan success</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">32muart:~$ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">m</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">8D</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">J</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">00:00:02.061,000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">dbg</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> csk_wifi.wifi_obj_set_sm: </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">91</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">STA_SM: current</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">WIFI_SM_STA_ON_CONNECT_SCAN</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">, next</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">WIFI_SM_STA_ON_CONNECT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">32muart:~$ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">msta: Trying to associate with c2:d0:2b:4c:44:67 </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">SSID</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;xiaowei-yyds&#x27;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">freq</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">2422</span><span class="token plain"> MHz</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain">:05:49.184</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">收←◆sta: Associated with c2:d0:2b:4c:44:67</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">sta: WPA: Key negotiation completed with c2:d0:2b:4c:44:67 </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">PTK</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">CCMP </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">GTK</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">CCMP</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">sta: CTRL-EVENT-CONNECTED - Connection to c2:d0:2b:4c:44:67 completed </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">id</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">id_str</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">8D</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">J</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">00:00:02.277,000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">dbg</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> csk_wifi.wlan_event_handler: Got wlan event </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">WLAN_EVENT_CONNECTED</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">, current state</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">WIFI_SM_STA_ON_CONNECT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">32muart:~$ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">m</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">8D</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">J</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">00:00:02.293,000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">inf</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> csk_wifi: STA_SM</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">WIFI_SM_STA_ON_CONNECT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">: connected</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">32muart:~$ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">m</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">8D</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">J</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">00:00:02.303,000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">dbg</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> csk_wifi.wifi_obj_set_sm: </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">91</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">STA_SM: current</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">WIFI_SM_STA_ON_CONNECT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">, next</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">WIFI_SM_STA_CONNECTED</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">32muart:~$ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">m</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">WiFi sta</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> connected</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">--------------------------Current AP info-------------------------------</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">ssid: xiaowei-yyds  pwd: xiaowei-yyds  bssid: c2:d0:2b:4c:44:67  channel: </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token plain">  rssi: -49</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">------------------------------------------------------------------------</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain">:05:52.343</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">收←◆</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">8D</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">J</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">00:00:05.403,000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">inf</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> net_dhcpv4: Received: </span><span class="token number" style="color:rgb(181, 206, 168)">192.168</span><span class="token plain">.101.215</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">32muart:~$ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">mYour address: </span><span class="token number" style="color:rgb(181, 206, 168)">192.168</span><span class="token plain">.101.215</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Lease time: </span><span class="token number" style="color:rgb(181, 206, 168)">86400</span><span class="token plain"> seconds</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Subnet: </span><span class="token number" style="color:rgb(181, 206, 168)">255.255</span><span class="token plain">.255.0</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Router: </span><span class="token number" style="color:rgb(181, 206, 168)">192.168</span><span class="token plain">.101.1</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-----------------------main </span><span class="token number" style="color:rgb(181, 206, 168)">369</span><span class="token plain"> wifi connect over-----------------------</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">WAR:1533</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">drop</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">1333</span><span class="token plain">, </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">fctl</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">0x00d0.</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> socket </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain">:05:53.403</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">收←◆</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">8D</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">J</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">00:00:06.464,000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">31m</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">err</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> net_websocket_client_sample: --------------111111111111111111--------------.</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">32muart:~$ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain">:05:54.932</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">收←◆Websocket </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">for</span><span class="token plain"> IPv4 connected.</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain">:05:56.936</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">收←◆ websock4 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain">:05:57.938</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">收←◆</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">8D</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">J</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">00:00:10.999,000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">dbg</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> net_websocket_client_sample.send_and_wait_msg: IPv4 sent </span><span class="token number" style="color:rgb(181, 206, 168)">26</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">32muart:~$ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain">:06:09.233</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">收←◆</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">8D</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">J</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">00:00:22.293,000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">31m</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">err</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> net_websocket_client_sample: IPv4 data recv failure </span><span class="token number" style="color:rgb(181, 206, 168)">26</span><span class="token plain">/26 bytes </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">remaining </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">32muart:~$ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">m</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">8D</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">J</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">00:00:22.306,000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">dbg</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> net_websocket_client_sample.received bsd buf</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                                                     </span><span class="token number" style="color:rgb(181, 206, 168)">31</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">32</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">33</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">34</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">35</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">37</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">38</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">39</span><span class="token plain">  e8 af b7 e8 bf 9b e8 a1 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token number" style="color:rgb(181, 206, 168)">12345789</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                                                     8c e6 b3 a8 e5 </span><span class="token number" style="color:rgb(181, 206, 168)">86</span><span class="token plain"> 8c ef  </span><span class="token function" style="color:rgb(220, 220, 170)">bc</span><span class="token plain"> 8c                   </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">32muart:~$ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">m</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">8D</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">J</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">00:00:22.340,000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">dbg</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> net_websocket_client_sample.sent bsd buf</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                                                     </span><span class="token number" style="color:rgb(181, 206, 168)">77</span><span class="token plain"> 6f </span><span class="token number" style="color:rgb(181, 206, 168)">20</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">77</span><span class="token plain"> 6f </span><span class="token number" style="color:rgb(181, 206, 168)">20</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">77</span><span class="token plain"> 6f  </span><span class="token number" style="color:rgb(181, 206, 168)">20</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">77</span><span class="token plain"> 6f </span><span class="token number" style="color:rgb(181, 206, 168)">20</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">61</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">61</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">61</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">61</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">wo wo wo  wo aaaa</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                                                     </span><span class="token number" style="color:rgb(181, 206, 168)">61</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">20</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">64</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">66</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">66</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">67</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">68</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">68</span><span class="token plain">  </span><span class="token number" style="color:rgb(181, 206, 168)">68</span><span class="token plain"> 0a                   </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">a dffghh h.      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">32muart:~$ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain">:06:09.564</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">收←◆</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">8D</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">J</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">00:00:22.624,000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">dbg</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> net_websocket_client_sample.send_and_wait_msg: IPv4 sent </span><span class="token number" style="color:rgb(181, 206, 168)">4</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">32muart:~$ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">m</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">8D</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">J</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">00:00:22.636,000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">31m</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">err</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> net_websocket_client_sample: IPv4 data recv failure </span><span class="token number" style="color:rgb(181, 206, 168)">4</span><span class="token plain">/12 bytes </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">remaining </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">32muart:~$ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">m</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">8D</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">J</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">00:00:22.649,000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">dbg</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> net_websocket_client_sample.received ws buf</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                                                     e5 b0 8a e9 </span><span class="token number" style="color:rgb(181, 206, 168)">87</span><span class="token plain"> 8d e5 </span><span class="token number" style="color:rgb(181, 206, 168)">88</span><span class="token plain">  9b e4 bd 9c             </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">32muart:~$ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">m</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">8D</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">J</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">00:00:22.671,000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">dbg</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> net_websocket_client_sample.sent ws buf</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                                                     </span><span class="token number" style="color:rgb(181, 206, 168)">77</span><span class="token plain"> 6f </span><span class="token number" style="color:rgb(181, 206, 168)">20</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">77</span><span class="token plain"> 6f </span><span class="token number" style="color:rgb(181, 206, 168)">20</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">77</span><span class="token plain"> 6f  </span><span class="token number" style="color:rgb(181, 206, 168)">20</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">77</span><span class="token plain"> 6f </span><span class="token number" style="color:rgb(181, 206, 168)">20</span><span class="token plain">             </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">wo wo wo  wo     </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">32muart:~$ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain">:06:09.883</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">收←◆</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">8D</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">J</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">00:00:22.943,000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">dbg</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> net_websocket_client_sample.send_and_wait_msg: IPv4 sent </span><span class="token number" style="color:rgb(181, 206, 168)">8</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">32muart:~$ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain">:06:23.683</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">收←◆</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">8D</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">J</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">00:00:36.743,000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">31m</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">err</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> net_websocket_client_sample: IPv4 data recv failure </span><span class="token number" style="color:rgb(181, 206, 168)">8</span><span class="token plain">/26 bytes </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">remaining -18</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">32muart:~$ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">m</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">8D</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">J</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">00:00:36.757,000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">dbg</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> net_websocket_client_sample.received bsd buf</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                                                     </span><span class="token number" style="color:rgb(181, 206, 168)">35</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">35</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">36</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">36</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">37</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">37</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">38</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">38</span><span class="token plain">  e8 af b7 e8 bf 9b e8 a1 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token number" style="color:rgb(181, 206, 168)">55667788</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                                                     8c e6 b3 a8 e5 </span><span class="token number" style="color:rgb(181, 206, 168)">86</span><span class="token plain"> 8c ef  </span><span class="token function" style="color:rgb(220, 220, 170)">bc</span><span class="token plain"> 8c                   </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">32muart:~$ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">m</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">8D</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">J</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">00:00:36.790,000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">dbg</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> net_websocket_client_sample.sent bsd buf</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                                                     </span><span class="token number" style="color:rgb(181, 206, 168)">77</span><span class="token plain"> 6f </span><span class="token number" style="color:rgb(181, 206, 168)">20</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">77</span><span class="token plain"> 6f </span><span class="token number" style="color:rgb(181, 206, 168)">20</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">77</span><span class="token plain"> 6f  </span><span class="token number" style="color:rgb(181, 206, 168)">20</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">77</span><span class="token plain"> 6f </span><span class="token number" style="color:rgb(181, 206, 168)">20</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">61</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">61</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">61</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">61</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">wo wo wo  wo aaaa</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                                                     </span><span class="token number" style="color:rgb(181, 206, 168)">61</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">20</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">64</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">66</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">66</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">67</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">68</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">68</span><span class="token plain">  </span><span class="token number" style="color:rgb(181, 206, 168)">68</span><span class="token plain"> 0a                   </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">a dffghh h.      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">32muart:~$ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain">:06:24.013</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">收←◆</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">8D</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">J</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">00:00:37.074,000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">dbg</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> net_websocket_client_sample.send_and_wait_msg: IPv4 sent </span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">32muart:~$ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">m</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">8D</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">J</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">00:00:37.087,000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">31m</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">err</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> net_websocket_client_sample: IPv4 data recv failure </span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain">/12 bytes </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">remaining </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">32muart:~$ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">m</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">8D</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">J</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">00:00:37.100,000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">dbg</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> net_websocket_client_sample.received ws buf</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                                                     e5 b0 8a e9 </span><span class="token number" style="color:rgb(181, 206, 168)">87</span><span class="token plain"> 8d e5 </span><span class="token number" style="color:rgb(181, 206, 168)">88</span><span class="token plain">  9b e4 bd 9c             </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">32muart:~$ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">m</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">8D</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">J</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">00:00:37.122,000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">dbg</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> net_websocket_client_sample.sent ws buf</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                                                     </span><span class="token number" style="color:rgb(181, 206, 168)">77</span><span class="token plain"> 6f </span><span class="token number" style="color:rgb(181, 206, 168)">20</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">77</span><span class="token plain"> 6f </span><span class="token number" style="color:rgb(181, 206, 168)">20</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">77</span><span class="token plain"> 6f  </span><span class="token number" style="color:rgb(181, 206, 168)">20</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">77</span><span class="token plain"> 6f </span><span class="token number" style="color:rgb(181, 206, 168)">20</span><span class="token plain">             </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">wo wo wo  wo     </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">32muart:~$ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain">:06:24.336</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">收←◆</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">8D</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">J</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">00:00:37.395,000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">dbg</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> net_websocket_client_sample.send_and_wait_msg: IPv4 sent </span><span class="token number" style="color:rgb(181, 206, 168)">8</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0m</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">32muart:~$ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">m</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><p>如日志所示，CSK6-NanoKit成功连接热点并获取IP地址，并且收发websocket数据成功。</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>注意，websocket接口功能还在完善中，后续会持续更新本文档。</p></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs-csk6/chips/600X/application/network/wifi_connect"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« WIFI连接</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs-csk6/chips/600X/application/customdriver/custom-driver-video"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">添加自定义驱动 »</div></a></div></nav><div class="gitalk-wrapper"><ul class="gitalk-option"><li class="like"><i class="icon like-icon"></i> <span id="like_num">有帮助  0</span></li><li class="unlike"><i class="icon unlike-icon"></i> <span id="unlike_num">没帮助 0</span></li><li>文档反馈</li></ul></div></div></div><div class="col col--3" style="padding-left:0px"><div class="tableOfContents_k96L thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#概述" class="table-of-contents__link">概述</a></li><li><a href="#相关-api接口" class="table-of-contents__link">相关 API接口</a><ul><li><a href="#websocket_connect" class="table-of-contents__link">websocket_connect</a></li><li><a href="#websocket_send_msg" class="table-of-contents__link">websocket_send_msg</a></li><li><a href="#websocket_recv_msg" class="table-of-contents__link">websocket_recv_msg</a></li></ul></li><li><a href="#使用示例" class="table-of-contents__link">使用示例</a><ul><li><a href="#实现逻辑" class="table-of-contents__link">实现逻辑</a></li><li><a href="#准备工作" class="table-of-contents__link">准备工作</a></li><li><a href="#获取wifi-sample项目" class="table-of-contents__link">获取wifi sample项目</a></li><li><a href="#wifi示例代码改造" class="table-of-contents__link">wifi示例代码改造</a></li><li><a href="#mainc代码示例" class="table-of-contents__link">main.c代码示例</a></li><li><a href="#测试说明" class="table-of-contents__link">测试说明</a></li><li><a href="#测试目标" class="table-of-contents__link">测试目标</a></li><li><a href="#编译和烧录" class="table-of-contents__link">编译和烧录</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 安徽聆思智能科技有限公司皖ICP备05001217号</div></div></div></footer></div>
<script src="/docs-csk6/assets/js/runtime~main.69dcc439.js"></script>
<script src="/docs-csk6/assets/js/main.91f98343.js"></script>
<script>!function(e,n,s,t,d){e[s]=e[s]||function(){(e[s].a=e[s].a||[]).push(arguments)},(d=n.createElement("script")).async=!0,d.src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js",n.body.appendChild(d)}(window,document,"simplemde")</script></body>
</html>