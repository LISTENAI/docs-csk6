"use strict";(self.webpackChunkls_docs_web=self.webpackChunkls_docs_web||[]).push([[7147],{3905:(e,t,n)=>{n.d(t,{Zo:()=>o,kt:()=>k});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var d=a.createContext({}),s=function(e){var t=a.useContext(d),n=t;return e&&(n="function"==typeof e?e(t):p(p({},t),e)),n},o=function(e){var t=s(e.components);return a.createElement(d.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,d=e.parentName,o=l(e,["components","mdxType","originalType","parentName"]),m=s(n),k=r,E=m["".concat(d,".").concat(k)]||m[k]||c[k]||i;return n?a.createElement(E,p(p({ref:t},o),{},{components:n})):a.createElement(E,p({ref:t},o))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,p=new Array(i);p[0]=m;var l={};for(var d in t)hasOwnProperty.call(t,d)&&(l[d]=t[d]);l.originalType=e,l.mdxType="string"==typeof e?e:r,p[1]=l;for(var s=2;s<i;s++)p[s]=n[s];return a.createElement.apply(null,p)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},46534:(e,t,n)=>{n.r(t),n.d(t,{contentTitle:()=>p,default:()=>o,frontMatter:()=>i,metadata:()=>l,toc:()=>d});var a=n(87462),r=(n(67294),n(3905));const i={},p="\u8bbe\u5907\u6811\u64cd\u4f5c\u6307\u5f15",l={unversionedId:"chips/600X/build/dts/howtos",id:"chips/600X/build/dts/howtos",isDocsHomePage:!1,title:"\u8bbe\u5907\u6811\u64cd\u4f5c\u6307\u5f15",description:"\u9605\u8bfb\u5b8c\u672c\u6587\uff0c\u4f60\u5c06\u5b66\u4f1a\u6309\u6b65\u9aa4\u4f7f\u7528\u8bbe\u5907\u6811\u5b8c\u6210\u4efb\u52a1\u3002",source:"@site/docs/chips/600X/build/dts/howtos.md",sourceDirName:"chips/600X/build/dts",slug:"/chips/600X/build/dts/howtos",permalink:"/docs-csk6/chips/600X/build/dts/howtos",version:"current",frontMatter:{},sidebar:"docs/chips/600X",previous:{title:"\u8bbe\u5907\u6811\u7ed1\u5b9a",permalink:"/docs-csk6/chips/600X/build/dts/bindings"},next:{title:"\u5728 C/C++ \u4e2d\u8bbf\u95ee\u8bbe\u5907\u6811",permalink:"/docs-csk6/chips/600X/build/dts/api_usage"}},d=[{value:"\u83b7\u53d6\u4f60\u7684\u8bbe\u5907\u6811\u4e0e\u751f\u6210\u7684\u5934\u6587\u4ef6",id:"\u83b7\u53d6\u4f60\u7684\u8bbe\u5907\u6811\u4e0e\u751f\u6210\u7684\u5934\u6587\u4ef6",children:[]},{value:"\u4ece\u8bbe\u5907\u6811\u8282\u70b9\u83b7\u53d6\u8bbe\u5907\u7ed3\u6784\u4f53\uff08<code>struct device</code>\uff09",id:"\u4ece\u8bbe\u5907\u6811\u8282\u70b9\u83b7\u53d6\u8bbe\u5907\u7ed3\u6784\u4f53struct-device",children:[]},{value:"\u627e\u5230\u8bbe\u5907\u6811\u7ed1\u5b9a",id:"\u627e\u5230\u8bbe\u5907\u6811\u7ed1\u5b9a",children:[]},{value:"\u8bbe\u7f6e\u8bbe\u5907\u6811 overlay",id:"\u8bbe\u7f6e\u8bbe\u5907\u6811-overlay",children:[]},{value:"\u4f7f\u7528\u8bbe\u5907\u6811 overlay",id:"\u4f7f\u7528\u8bbe\u5907\u6811-overlay",children:[]},{value:"\u4f7f\u7528\u8bbe\u5907\u6811 API \u7f16\u5199\u8bbe\u5907\u9a71\u52a8",id:"\u4f7f\u7528\u8bbe\u5907\u6811-api-\u7f16\u5199\u8bbe\u5907\u9a71\u52a8",children:[{value:"\u65b9\u5f0f 1\uff1a\u901a\u8fc7\u5b9e\u4f8b\u7f16\u53f7\u521b\u5efa\u8bbe\u5907",id:"\u65b9\u5f0f-1\u901a\u8fc7\u5b9e\u4f8b\u7f16\u53f7\u521b\u5efa\u8bbe\u5907",children:[]},{value:"\u65b9\u5f0f 2\uff1a\u901a\u8fc7\u8282\u70b9\u6807\u7b7e\u521b\u5efa\u8bbe\u5907",id:"\u65b9\u5f0f-2\u901a\u8fc7\u8282\u70b9\u6807\u7b7e\u521b\u5efa\u8bbe\u5907",children:[]}]},{value:"\u4f9d\u8d56\u5176\u4ed6\u8bbe\u5907\u7684\u8bbe\u5907\u9a71\u52a8",id:"\u4f9d\u8d56\u5176\u4ed6\u8bbe\u5907\u7684\u8bbe\u5907\u9a71\u52a8",children:[]},{value:"\u4f9d\u8d56\u5f00\u53d1\u677f\u7279\u5b9a\u8bbe\u5907\u7684\u5e94\u7528",id:"\u4f9d\u8d56\u5f00\u53d1\u677f\u7279\u5b9a\u8bbe\u5907\u7684\u5e94\u7528",children:[]}],s={toc:d};function o(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"\u8bbe\u5907\u6811\u64cd\u4f5c\u6307\u5f15"},"\u8bbe\u5907\u6811\u64cd\u4f5c\u6307\u5f15"),(0,r.kt)("p",null,"\u9605\u8bfb\u5b8c\u672c\u6587\uff0c\u4f60\u5c06\u5b66\u4f1a\u6309\u6b65\u9aa4\u4f7f\u7528\u8bbe\u5907\u6811\u5b8c\u6210\u4efb\u52a1\u3002"),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"\u63d0\u793a")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"\u53c2\u8003 ",(0,r.kt)("a",{parentName:"p",href:"/docs-csk6/chips/600X/build/dts/troubleshooting"},"\u8bbe\u5907\u6811\u95ee\u9898\u6392\u67e5")," \u4e86\u89e3\u4e00\u4e9b\u89e3\u51b3\u95ee\u9898\u7684\u601d\u8def\u3002"))),(0,r.kt)("h2",{id:"\u83b7\u53d6\u4f60\u7684\u8bbe\u5907\u6811\u4e0e\u751f\u6210\u7684\u5934\u6587\u4ef6"},"\u83b7\u53d6\u4f60\u7684\u8bbe\u5907\u6811\u4e0e\u751f\u6210\u7684\u5934\u6587\u4ef6"),(0,r.kt)("p",null,"\u4e00\u4e2a\u677f\u578b\u7684\u8bbe\u5907\u6811 ( ",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/build/dts/intro.html#devicetree-in-out-files"},"BOARD.dts")," ) \u662f\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"#include")," \u9884\u5904\u7406\u5668\u6307\u4ee4\u6765\u5f15\u5165\u516c\u5171\u8282\u70b9\u5b9a\u4e49\u7684\u3002\u8fd9\u4e00\u64cd\u4f5c\u81f3\u5c11\u4f1a include  SoC \u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},".dtsi")," \u3002\u67e5\u770b\u8fd9\u4e9b\u6587\u4ef6\u662f\u7406\u89e3\u8bbe\u5907\u6811\u5185\u5bb9\u7684\u65b9\u6cd5\u4e4b\u4e00\uff0c\u4f8b\u5982\u67e5\u770b ",(0,r.kt)("inlineCode",{parentName:"p"},"dts/<ARCH>/<vendor>/<soc>.dtsi")," \uff0c\u4f46\u8fd9\u53ef\u80fd\u8017\u8d39\u5927\u91cf\u65f6\u95f4\u3002"),(0,r.kt)("p",null,"\u5982\u679c\u4f60\u53ea\u60f3\u67e5\u770b\u4f60\u7684\u677f\u578b\u7684\u201c\u6700\u7ec8\u201d\u8bbe\u5907\u6811\uff0c\u53ea\u9700\u6210\u529f\u6784\u5efa\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\uff0c\u5e76\u6253\u5f00\u6784\u5efa\u76ee\u5f55\u4e2d\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"zephyr.dts")," \u6587\u4ef6\uff08\u8def\u5f84\u4e00\u822c\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"build/zephyr/zephyr.dts")," \uff09\u3002"),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"\u63d0\u793a")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"\u4f60\u53ef\u4ee5\u901a\u8fc7\u4e3a\u4f60\u7684\u677f\u578b\u6784\u5efa ",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/samples/hello_world/README.html#hello-world"},"Hello World")," \u67e5\u770b\u201c\u57fa\u7840\u201d\u8bbe\u5907\u6811\uff0c\u56e0\u4e3a\u8fd9\u4e00\u7ed3\u679c\u6ca1\u6709\u53d7\u4efb\u4f55 ",(0,r.kt)("a",{parentName:"p",href:"/docs-csk6/chips/600X/build/dts/intro#%E8%BE%93%E5%85%A5%E6%96%87%E4%BB%B6"},"overlay \u6587\u4ef6")," \u5f71\u54cd\u3002"))),(0,r.kt)("p",null,"\u4f8b\u5982\uff0c\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"csk6002_9s_nano")," \u6784\u5efa ",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/samples/hello_world/README.html#hello-world"},"Hello World")," \uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# \u6b64\u5904\u7684 --cmake-only \u76ee\u7684\u662f\u4e3a\u4e86\u8282\u7701\u65f6\u95f4\uff0c\n# \u5b83\u4f1a\u5f3a\u5236\u8ba9 CMake \u8fd0\u884c\uff0c\u5e76\u8df3\u8fc7\u6784\u5efa\u8fc7\u7a0b\u3002\nlisa zep build -b csk6002_9s_nano samples/hello_world --cmake-only\n")),(0,r.kt)("p",null,"\u4f60\u4e5f\u53ef\u4ee5\u5c06 ",(0,r.kt)("inlineCode",{parentName:"p"},"csk6002_9s_nano")," \u66ff\u6362\u6210\u4f60\u7684\u677f\u578b\u3002"),(0,r.kt)("p",null,"CMake \u5c06\u6253\u5370\u8f93\u5165\u548c\u8f93\u51fa\u6587\u4ef6\u7684\u4f4d\u7f6e\uff0c\u5982\u4e0b\u6240\u793a\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"-- Found BOARD.dts: .../zephyr/boards/arm/csk6002_9s_nano/csk6002_9s_nano.dts\n-- Generated zephyr.dts: .../build/zephyr/zephyr.dts\n-- Generated devicetree_unfixed.h: .../build/zephyr/include/generated/devicetree_unfixed.h\n")),(0,r.kt)("p",null,"DTS \u683c\u5f0f\u6587\u4ef6 ",(0,r.kt)("inlineCode",{parentName:"p"},"zephyr.dts")," \u5373\u4e3a\u6700\u7ec8\u8bbe\u5907\u6811\u3002"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"devicetree_unfixed.h")," \u6587\u4ef6\u5219\u662f\u4e0e\u5176\u5bf9\u5e94\u7684\u751f\u6210\u5934\u6587\u4ef6\u3002"),(0,r.kt)("p",null,"\u8bf7\u53c2\u9605 ",(0,r.kt)("a",{parentName:"p",href:"/docs-csk6/chips/600X/build/dts/intro#%E8%BE%93%E5%85%A5%E4%B8%8E%E8%BE%93%E5%87%BA%E6%96%87%E4%BB%B6"},"\u8f93\u5165\u548c\u8f93\u51fa\u6587\u4ef6")," \u4e86\u89e3\u8fd9\u4e48\u6587\u4ef6\u7684\u8be6\u7ec6\u4fe1\u606f\u3002"),(0,r.kt)("h2",{id:"\u4ece\u8bbe\u5907\u6811\u8282\u70b9\u83b7\u53d6\u8bbe\u5907\u7ed3\u6784\u4f53struct-device"},"\u4ece\u8bbe\u5907\u6811\u8282\u70b9\u83b7\u53d6\u8bbe\u5907\u7ed3\u6784\u4f53\uff08",(0,r.kt)("inlineCode",{parentName:"h2"},"struct device"),"\uff09"),(0,r.kt)("p",null,"\u5728\u7f16\u5199 Zephyr \u5e94\u7528\u7a0b\u5e8f\u65f6\uff0c\u4f60\u901a\u5e38\u5e0c\u671b\u83b7\u5f97\u4e0e\u8bbe\u5907\u6811\u8282\u70b9\u5bf9\u5e94\u7684\u9a71\u52a8\u7a0b\u5e8f\u7ea7 ",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/kernel/drivers/index.html#device-model-api"},"struct device")," \u53d8\u91cf\u3002"),(0,r.kt)("p",null,"\u5047\u8bbe\u4f60\u8981\u4ece\u8fd9\u4e2a\u8bbe\u5907\u6811\u7247\u6bb5\u4e2d\u83b7\u53d6 ",(0,r.kt)("inlineCode",{parentName:"p"},"serial@40002000")," \u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"struct device")," \uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},'/ {\n        soc {\n                serial0: serial@40002000 {\n                        status = "okay";\n                        current-speed = <115200>;\n                        /* ... */\n                };\n        };\n\n        aliases {\n                my-serial = &serial0;\n        };\n\n        chosen {\n                zephyr,console = &serial0;\n        };\n};\n')),(0,r.kt)("p",null,"\u9996\u5148\u4e3a\u4f60\u611f\u5174\u8da3\u7684\u8bbe\u5907\u8282\u70b9\u5b9a\u4e49\u4e00\u4e2a ",(0,r.kt)("a",{parentName:"p",href:"/docs-csk6/chips/600X/build/dts/api_usage#%E8%8A%82%E7%82%B9-id"},"\u8282\u70b9 id")," \u3002\u4e0b\u9762\u7684\u4f8b\u5b50\u5c55\u793a\u4e86\u53ef\u8fbe\u6210\u76ee\u7684\u7684\u4e0d\u540c\u65b9\u6cd5\uff0c\u4f60\u53ef\u4ee5\u4ece\u4e2d\u9009\u62e9\u6700\u6ee1\u8db3\u4f60\u9700\u6c42\u7684\u65b9\u5f0f\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},"/* \u65b9\u6cd5 1: \u901a\u8fc7\u8282\u70b9\u6807\u7b7e */\n#define MY_SERIAL DT_NODELABEL(serial0)\n\n/* \u65b9\u6cd5 1: \u901a\u8fc7\u8282\u70b9\u522b\u540d */\n#define MY_SERIAL DT_ALIAS(my_serial)\n\n/* \u65b9\u6cd5 1: \u901a\u8fc7 chosen \u8282\u70b9 */\n#define MY_SERIAL DT_CHOSEN(zephyr_console)\n\n/* \u65b9\u6cd5 1: \u901a\u8fc7\u8def\u5f84 */\n#define MY_SERIAL DT_PATH(soc, serial_40002000)\n")),(0,r.kt)("p",null,"\u83b7\u5f97\u8282\u70b9 id \u540e\uff0c\u6709\u4e24\u79cd\u65b9\u6cd5\u53ef\u4ee5\u83b7\u53d6\u8bbe\u5907\u3002\u4e00\u79cd\u65b9\u6cd5\u662f\u4f7f\u7528 ",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/kernel/drivers/index.html#c.DEVICE_DT_GET"},(0,r.kt)("inlineCode",{parentName:"a"},"DEVICE_DT_GET()"))," \uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},"const struct device *uart_dev = DEVICE_DT_GET(MY_SERIAL);\n\nif (!device_is_ready(uart_dev)) {\n        /* Not ready, do not use */\n        return -ENODEV;\n}\n")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/kernel/drivers/index.html#c.DEVICE_DT_GET"},(0,r.kt)("inlineCode",{parentName:"a"},"DEVICE_DT_GET()"))," \u6709\u591a\u79cd\u53d8\u4f53\uff0c\u4f8b\u5982 ",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/kernel/drivers/index.html#c.DEVICE_DT_GET_OR_NULL"},(0,r.kt)("inlineCode",{parentName:"a"},"DEVICE_DT_GET_OR_NULL()"))," \u3001 ",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/kernel/drivers/index.html#c.DEVICE_DT_GET_ONE"},(0,r.kt)("inlineCode",{parentName:"a"},"DEVICE_DT_GET_ONE()"))," \u6216 ",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/kernel/drivers/index.html#c.DEVICE_DT_GET_ANY"},(0,r.kt)("inlineCode",{parentName:"a"},"DEVICE_DT_GET_ANY()"))," \u3002\u8fd9\u4e2a\u60ef\u7528\u65b9\u5f0f\u5728\u6784\u5efa\u65f6\u83b7\u53d6\u8bbe\u5907\u6307\u9488\uff0c\u8fd9\u610f\u5473\u7740\u6ca1\u6709\u8fd0\u884c\u65f6\u7684\u6027\u80fd\u635f\u5931\u3002\u5982\u679c\u8981\u5c06\u8bbe\u5907\u6307\u9488\u5b58\u50a8\u4e3a\u914d\u7f6e\u6570\u636e\uff0c\u6b64\u65b9\u6cd5\u5f88\u6709\u7528\u3002\u4f46\u7531\u4e8e\u8bbe\u5907\u53ef\u80fd\u672a\u521d\u59cb\u5316\u6216\u521d\u59cb\u5316\u5931\u8d25\uff0c\u56e0\u6b64\u5728\u5c06\u8bbe\u5907\u6307\u9488\u4f20\u9012\u7ed9\u4efb\u4f55 API \u51fd\u6570\u4e4b\u524d\uff0c\u4f60\u5fc5\u987b\u9a8c\u8bc1\u8bbe\u5907\u662f\u5426\u5df2\u51c6\u5907\u597d\u88ab\u4f7f\u7528\u3002 \uff08\u6b64\u68c0\u67e5\u7531 ",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/kernel/drivers/index.html#c.device_get_binding"},(0,r.kt)("inlineCode",{parentName:"a"},"device_get_binding()"))," \u4e3a\u4f60\u5b8c\u6210\u3002\uff09"),(0,r.kt)("p",null,"\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u8bbe\u5907\u5728\u6784\u5efa\u65f6\u662f\u672a\u77e5\u7684\uff0c\u4f8b\u5982\uff0c\u6709\u65f6\u8bbe\u5907\u9700\u8981\u901a\u8fc7\u7528\u6237\u8f93\u5165\uff08\u6bd4\u5982 shell \uff09\u6765\u786e\u8ba4\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u5c06 ",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/build/dts/api/api.html#c.DT_LABEL"},(0,r.kt)("inlineCode",{parentName:"a"},"DT_LABEL()"))," \u4e0e ",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/kernel/drivers/index.html#c.device_get_binding"},(0,r.kt)("inlineCode",{parentName:"a"},"device_get_binding()"))," \u7ec4\u5408\u6765\u83b7\u53d6 ",(0,r.kt)("inlineCode",{parentName:"p"},"struct device")," \uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},"const struct device *uart_dev = device_get_binding(DT_LABEL(MY_SERIAL));\n")),(0,r.kt)("p",null,"\u7136\u540e\uff0c\u4f60\u53ef\u4ee5\u5c06 ",(0,r.kt)("inlineCode",{parentName:"p"},"uart_dev")," \u7528\u4e8e ",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/hardware/peripherals/uart.html#uart-api"},"UART")," API \u51fd\u6570\uff08\u5982 ",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/hardware/peripherals/uart.html#c.uart_configure"},(0,r.kt)("inlineCode",{parentName:"a"},"uart_configure()"))," \uff09\u3002\u5176\u4ed6\u8bbe\u5907\u7c7b\u578b\u6240\u4f7f\u7528\u7684\u4ee3\u7801\u4e5f\u4e0e\u6b64\u7c7b\u4f3c\uff1b\u53ea\u9700\u786e\u4fdd\u4e3a\u8bbe\u5907\u4f7f\u7528\u6b63\u786e\u7684 API\u3002"),(0,r.kt)("p",null,"\u65e0\u9700\u5c06 ",(0,r.kt)("inlineCode",{parentName:"p"},"label")," \u5c5e\u6027\u8986\u76d6\u4e3a\u5176\u4ed6\u5185\u5bb9\uff1a\u53ea\u9700\u521b\u5efa\u4e00\u4e2a\u8282\u70b9\u6807\u8bc6\u7b26\u5e76\u5c06\u5176\u4f20\u9012\u7ed9 ",(0,r.kt)("inlineCode",{parentName:"p"},"DT_LABEL")," \u4ee5\u83b7\u53d6\u6b63\u786e\u7684\u5b57\u7b26\u4e32\u4ee5\u4f20\u9012\u7ed9 ",(0,r.kt)("inlineCode",{parentName:"p"},"device_get_binding()")," \u3002"),(0,r.kt)("p",null,"\u5982\u679c\u4f60\u9047\u5230\u95ee\u9898\uff0c\u8bf7\u53c2\u9605 ",(0,r.kt)("a",{parentName:"p",href:"/docs-csk6/chips/600X/build/dts/troubleshooting"},"\u8bbe\u5907\u6811\u95ee\u9898\u6392\u67e5")," \u3002\u9996\u5148\u8981\u68c0\u67e5\u7684\u662f\u8282\u70b9\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},'status = "okay"')," \uff0c\u50cf\u8fd9\u6837\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},'#define MY_SERIAL DT_NODELABEL(my_serial)\n\n#if DT_NODE_HAS_STATUS(MY_SERIAL, okay)\nconst struct device *uart_dev = DEVICE_DT_GET(MY_SERIAL);\n#else\n#error "Node is disabled"\n#endif\n')),(0,r.kt)("p",null,"\u5982\u679c\u4f60\u770b\u5230\u6b64 ",(0,r.kt)("inlineCode",{parentName:"p"},"#error")," \u8f93\u51fa\uff0c\u8bf7\u786e\u4fdd\u4f60\u5df2\u7ecf\u542f\u7528\u4e86\u8be5\u8bbe\u5907\u6811\u8282\u70b9\u3002\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u4f60\u7684\u4ee3\u7801\u867d\u7136\u4f1a\u7f16\u8bd1\uff0c\u4f46\u65e0\u6cd5\u94fe\u63a5\u5230\u7c7b\u4f3c\u4e8e\u4ee5\u4e0b\u5185\u5bb9\u7684\u6d88\u606f\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"...undefined reference to `__device_dts_ord_N'\ncollect2: error: ld returned 1 exit status\n")),(0,r.kt)("p",null,"\u8fd9\u53ef\u80fd\u610f\u5473\u7740\uff0c\u5b58\u5728\u67d0\u4e2a Kconfig \u95ee\u9898\uff0c\u963b\u6b62\u4e86\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u7684\u6784\u5efa\uff0c\u5bfc\u81f4\u5f15\u7528\u4e0d\u751f\u6548\u3002\u5982\u679c\u4f60\u7684\u4ee3\u7801\u53ef\u4ee5\u7f16\u8bd1\u6210\u529f\uff0c\u6700\u540e\u8981\u505a\u7684\u662f\uff0c\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u68c0\u67e5\u8bbe\u5907\u662f\u5426\u51c6\u5907\u5c31\u7eea\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},'if (!device_is_ready(uart_dev)) {\n     printk("Device not ready\\n");\n}\n')),(0,r.kt)("p",null,"\u5982\u679c\u4f60\u53d1\u73b0\u8bbe\u5907\u6ca1\u6709\u51c6\u5907\u5c31\u7eea\uff0c\u5f88\u53ef\u80fd\u662f\u8bbe\u5907\u7684\u521d\u59cb\u5316\u529f\u80fd\u5931\u8d25\u4e86\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u542f\u7528\u65e5\u5fd7\u8bb0\u5f55\u6216\u5bf9\u9a71\u52a8\u7a0b\u5e8f\u4ee3\u7801\u8fdb\u884c\u8c03\u8bd5\uff0c\u53ef\u80fd\u4f1a\u6709\u6240\u5e2e\u52a9\u3002\u8bf7\u6ce8\u610f\uff0c\u4f60\u8fd8\u53ef\u4ee5\u4f7f\u7528 ",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/kernel/drivers/index.html#c.device_get_binding"},(0,r.kt)("inlineCode",{parentName:"a"},"device_get_binding()"))," \u5728\u8fd0\u884c\u65f6\u83b7\u53d6\u5bf9\u8bbe\u5907\u5f15\u7528\u3002\u5982\u679c\u5b83\u8fd4\u56de ",(0,r.kt)("inlineCode",{parentName:"p"},"NULL")," \uff0c\u5219\u53ef\u80fd\u610f\u5473\u7740\u8bbe\u5907\u7684\u9a71\u52a8\u7a0b\u5e8f\u65e0\u6cd5\u521d\u59cb\u5316\u6216\u6839\u672c\u4e0d\u5b58\u5728\u3002"),(0,r.kt)("h2",{id:"\u627e\u5230\u8bbe\u5907\u6811\u7ed1\u5b9a"},"\u627e\u5230\u8bbe\u5907\u6811\u7ed1\u5b9a"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"/docs-csk6/chips/600X/build/dts/bindings"},"\u8bbe\u5907\u6811\u7ed1\u5b9a")," \u662f YAML \u6587\u4ef6\uff0c\u5b83\u58f0\u660e\u4e86\u4f60\u53ef\u4ee5\u5bf9\u5176\u63cf\u8ff0\u7684\u8282\u70b9\u6267\u884c\u4ec0\u4e48\u64cd\u4f5c\uff0c\u56e0\u6b64\u80fd\u591f\u4e3a\u4f60\u6b63\u5728\u4f7f\u7528\u7684\u8282\u70b9\u627e\u5230\u7ed1\u5b9a\u81f3\u5173\u91cd\u8981\u3002"),(0,r.kt)("p",null,"\u9996\u5148\uff0c\u5148\u53c2\u8003 ",(0,r.kt)("a",{parentName:"p",href:"#%E8%8E%B7%E5%8F%96%E4%BD%A0%E7%9A%84%E8%AE%BE%E5%A4%87%E6%A0%91%E4%B8%8E%E7%94%9F%E6%88%90%E7%9A%84%E5%A4%B4%E6%96%87%E4%BB%B6"},"\u83b7\u53d6\u4f60\u7684\u8bbe\u5907\u6811\u4e0e\u751f\u6210\u7684\u5934\u6587\u4ef6")," \uff0c\u786e\u4fdd\u6240\u9700\u7684\u8bbe\u5907\u6811\u5934\u6587\u4ef6\u5df2\u7ecf\u751f\u6210\u3002\u7136\u540e\uff0c\u6253\u5f00\u751f\u6210\u7684\u5934\u6587\u4ef6\uff0c\u5728\u4ee5\u4e0b\u8ff0\u6ce8\u91ca\u5f00\u5934\u7684\u5757\u6ce8\u91ca\u4e2d\uff0c\u53ef\u4ee5\u770b\u5230\u4e00\u4e2a\u8282\u70b9\u5217\u8868\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},"/*\n * [...]\n * Nodes in dependency order (ordinal and path):\n *   0   /\n *   1   /aliases\n *   2   /chosen\n *   3   /flash@0\n *   4   /memory@20000000\n *          (etc.)\n * [...]\n */\n")),(0,r.kt)("p",null,"\u5148\u8bb0\u4e0b\u8981\u67e5\u627e\u7684\u8282\u70b9\u7684\u8def\u5f84\uff0c\u4f8b\u5982 ",(0,r.kt)("inlineCode",{parentName:"p"},"/flash@0")," \u3002\u5728\u6587\u4ef6\u4e2d\u641c\u7d22\u8fd9\u4e00\u8282\u70b9\u7684\u5185\u5bb9\uff0c\u5982\u679c\u8282\u70b9\u5177\u6709\u5339\u914d\u7684\u7ed1\u5b9a\uff0c\u90a3\u5b83\u5e94\u8be5\u4ee5\u7c7b\u4f3c\u4e0b\u9762\u7684\u5185\u5bb9\u5f00\u5934\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},"/*\n * Devicetree node:\n *   /flash@0\n *\n * Binding (compatible = soc-nv-flash):\n *   $ZEPHYR_BASE/dts/bindings/mtd/soc-nv-flash.yaml\n * [...]\n */\n")),(0,r.kt)("p",null,"\u5982\u679c\u8fd9\u4e00\u8fc7\u7a0b\u9047\u5230\u95ee\u9898\uff0c\u53ef\u53c2\u9605 ",(0,r.kt)("a",{parentName:"p",href:"/docs-csk6/chips/600X/build/dts/troubleshooting#%E6%A3%80%E6%9F%A5%E7%BC%BA%E5%A4%B1%E7%9A%84%E7%BB%91%E5%AE%9A"},"\u95ee\u9898\u6392\u67e5\u4e2d\u7684\u68c0\u67e5\u7f3a\u5931\u7684\u7ed1\u5b9a")," \u3002"),(0,r.kt)("h2",{id:"\u8bbe\u7f6e\u8bbe\u5907\u6811-overlay"},"\u8bbe\u7f6e\u8bbe\u5907\u6811 overlay"),(0,r.kt)("p",null,"\u8bbe\u5907\u6811 overlay \u5728 ",(0,r.kt)("a",{parentName:"p",href:"/docs-csk6/chips/600X/build/dts/intro"},"\u8bbe\u5907\u6811\u6982\u8ff0")," \u4e2d\u8fdb\u884c\u4e86\u4ecb\u7ecd\u3002 CMake \u53d8\u91cf ",(0,r.kt)("strong",{parentName:"p"},"DTC_OVERLAY_FILE")," \u5305\u542b\u8981\u4f7f\u7528\u7684 overlay \u6587\u4ef6\u7684\u5217\u8868\uff0c\u6bcf\u4e2a\u6587\u4ef6\u7528 ",(0,r.kt)("em",{parentName:"p"},"\u7a7a\u683c")," \u6216 ",(0,r.kt)("em",{parentName:"p"},"\u5206\u53f7")," \u5206\u9694\u3002\u5982\u679c ",(0,r.kt)("strong",{parentName:"p"},"DTC_OVERLAY_FILE")," \u6307\u5b9a\u4e86\u591a\u4e2a\u6587\u4ef6\uff0c\u5b83\u4eec\u5c06\u7531 C \u9884\u5904\u7406\u5668\u6309\u6307\u5b9a\u7684\u987a\u5e8f\u5305\u542b\u3002"),(0,r.kt)("p",null,"\u4f60\u53ef\u4ee5\u8bbe\u7f6e ",(0,r.kt)("strong",{parentName:"p"},"DTC_OVERLAY_FILE")," \u7528\u4e8e\u5305\u542b\u4f60\u8981\u4f7f\u7528\u7684\u6587\u4ef6\u3002\u8fd9\u91cc\u63d0\u4f9b\u4e00\u4e2a\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"lisa zep build")," \u7684 ",(0,r.kt)("a",{parentName:"p",href:"/docs-csk6/chips/600X/tool/lisa_plugin_zephyr/build_flash_debug"},"\u793a\u4f8b")," \u3002"),(0,r.kt)("p",null,"\u5982\u679c\u4f60\u6ca1\u6709\u8bbe\u7f6e ",(0,r.kt)("strong",{parentName:"p"},"DTC_OVERLAY_FILE")," \uff0c\u6784\u5efa\u7cfb\u7edf\u5c06\u6309\u7167\u4ee5\u4e0b\u6b65\u9aa4\uff0c\u5728\u4f60\u7684\u5e94\u7528\u7a0b\u5e8f\u6e90\u76ee\u5f55\u4e2d\u67e5\u627e\u6587\u4ef6\u4ee5\u7528\u4f5c\u8bbe\u5907\u6811 overlay \uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u5982\u679c\u5b58\u5728 ",(0,r.kt)("inlineCode",{parentName:"li"},"boards/<BOARD>.overlay")," \u6587\u4ef6\uff0c\u5219\u76f4\u63a5\u4f7f\u7528\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u5982\u679c\u5f53\u524d\u677f\u578b\u5b58\u5728 ",(0,r.kt)("a",{parentName:"li",href:"https://docs.zephyrproject.org/latest/hardware/porting/board_porting.html#porting-board-revisions"},"\u591a\u4e2a\u4fee\u8ba2\u7248")," \uff0c\u5e76\u4e14\u5b58\u5728 ",(0,r.kt)("inlineCode",{parentName:"li"},"boards/<BOARD>_<revision>.overlay")," \u6587\u4ef6\uff0c\u90a3\u4e48\u8be5 overlay \u6587\u4ef6\u5c06\u88ab\u4f7f\u7528\u3002\u5982\u679c ",(0,r.kt)("inlineCode",{parentName:"li"},"boards/<BOARD>.overlay")," \u5b58\u5728\uff0c\u90a3\u4e48\u4f1a\u4e24\u8005\u5c06\u7ec4\u5408\u5728\u4e00\u8d77\u5728\u6784\u5efa\u7cfb\u7edf\u4e2d\u4f7f\u7528\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u5982\u679c\u4e0a\u4e00\u6b65\u4e2d\u5df2\u7ecf\u627e\u5230\u4e86\u4e00\u4e2a\u6216\u591a\u4e2a\u6587\u4ef6\uff0c\u6784\u5efa\u7cfb\u7edf\u5c31\u505c\u6b62\u7ee7\u7eed\u67e5\u627e\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u5426\u5219\uff0c\u5982\u679c ",(0,r.kt)("inlineCode",{parentName:"li"},"<BOARD>.overlay")," \u6587\u4ef6\u5b58\u5728\uff0c\u90a3\u4e48\u5b83\u5c06\u88ab\u4f7f\u7528\uff0c\u5e76\u4e14\u6784\u5efa\u7cfb\u7edf\u5c06\u505c\u6b62\u67e5\u627e\u8fc7\u7a0b\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u518d\u4e0d\u7136\uff0c\u5982\u679c ",(0,r.kt)("inlineCode",{parentName:"li"},"app.overlay")," \u5b58\u5728\u5c31\u4f1a\u88ab\u4f7f\u7528\u3002")),(0,r.kt)("p",null,"\u4f7f\u7528 ",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/hardware/porting/shields.html#shields"},"Shields")," \u4e5f\u53ef\u4ee5\u6dfb\u52a0\u8bbe\u5907\u6811 overlay \u6587\u4ef6\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"DTC_OVERLAY_FILE")," \u7684\u503c\u5b58\u50a8\u5728 CMake \u7f13\u5b58\u4e2d\u5e76\u5728\u540e\u7eed\u6784\u5efa\u4e2d\u4f7f\u7528\u3002"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"/docs-csk6/chips/600X/build/cmake/index"},"\u6784\u5efa\u7cfb\u7edf")," \u4f1a\u5728\u914d\u7f6e\u9636\u6bb5\u6253\u5370\u627e\u5230\u7684\u6240\u6709\u8bbe\u5907\u6811 overlay \uff0c\u5982\u4e0b\u6240\u793a\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"-- Found devicetree overlay: .../some/file.overlay\n")),(0,r.kt)("h2",{id:"\u4f7f\u7528\u8bbe\u5907\u6811-overlay"},"\u4f7f\u7528\u8bbe\u5907\u6811 overlay"),(0,r.kt)("p",null,"\u5148\u6839\u636e ",(0,r.kt)("a",{parentName:"p",href:"#%E8%AE%BE%E7%BD%AE%E8%AE%BE%E5%A4%87%E6%A0%91-overlay"},"\u8bbe\u7f6e\u8bbe\u5907\u6811 overlay")," \u7684\u63cf\u8ff0\u4e3a\u4f60\u7684\u6784\u5efa\u6dfb\u52a0\u4e00\u4e2a overlay \u3002"),(0,r.kt)("p",null,"overlay \u53ef\u4ee5\u4f7f\u7528\u591a\u79cd\u65b9\u5f0f\u8986\u76d6\u8282\u70b9\u5c5e\u6027\u503c\u3002\u4f8b\u5982\uff0c\u5047\u8bbe\u4f60\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"BOARD.dts")," \u4e2d\u5305\u542b\u4ee5\u4e0b\u8282\u70b9\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},'/ {\n        soc {\n                serial0: serial@40002000 {\n                        status = "okay";\n                        current-speed = <115200>;\n                        /* ... */\n                };\n        };\n};\n')),(0,r.kt)("p",null,"\u5728 overlay \u4e2d\u8986\u76d6 ",(0,r.kt)("inlineCode",{parentName:"p"},"current-speed")," \u5c5e\u6027\u503c\u7684\u7b49\u4ef7\u65b9\u5f0f\u662f\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},"/* Option 1 */\n&serial0 {\n     current-speed = <9600>;\n};\n\n/* Option 2 */\n&{/soc/serial@40002000} {\n     current-speed = <9600>;\n};\n")),(0,r.kt)("p",null,"\u5728\u4e0b\u9762\u7684\u4f8b\u5b50\u6211\u4eec\u5c06\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"&serial0")," \u7684\u5f62\u5f0f\u6765\u5f15\u7528\u8fd9\u4e00\u8282\u70b9\u3002"),(0,r.kt)("p",null,"\u4f60\u53ef\u4ee5\u4f7f\u7528 overlay \u5728\u4f60\u7684\u8bbe\u5907\u6811\u4e2d\u522b\u540d\u6dfb\u52a0\u5230\uff1a\u522b\u540d\u4f5c\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"/aliases")," \u8282\u70b9\u7684\u4e00\u4e2a\u5c5e\u6027\u3002\u4f8b\u5982\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},"/ {\n     aliases {\n             my-serial = &serial0;\n     };\n};\n")),(0,r.kt)("p",null,"\u9009\u62e9\u7684\u8282\u70b9\u4e5f\u4ee5\u76f8\u540c\u7684\u65b9\u5f0f\u5de5\u4f5c\u3002\u4f8b\u5982\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},"/ {\n     chosen {\n             zephyr,console = &serial0;\n     };\n};\n")),(0,r.kt)("p",null,"\u5220\u9664\u4e00\u4e2a\u5c5e\u6027\uff08\u9664\u4e86\u4e00\u822c\u60c5\u51b5\u4e4b\u5916\uff0c\u5982\u679c boolean \u5c5e\u6027\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"BOARD.dts")," \u4e2d\uff0c\u5219\u4ee3\u8868\u5b83\u4e3a true \uff0c\u4ee5\u4e0b\u662f\u5982\u4f55\u5c06 boolean \u5c5e\u6027\u8bbe\u7f6e\u4e3a false \uff0c\u5177\u4f53\u63cf\u8ff0\u53ef\u53c2\u8003 ",(0,r.kt)("a",{parentName:"p",href:"/docs-csk6/chips/600X/build/dts/intro#%E8%AE%BE%E7%BD%AE%E5%B1%9E%E6%80%A7%E5%80%BC"},"\u8bbe\u7f6e\u5c5e\u6027\u503c")," \uff09\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"&serial0 {\n     /delete-property/ some-unwanted-property;\n};\n")),(0,r.kt)("p",null,"\u4f60\u53ef\u4ee5\u4f7f\u7528 overlay \u6dfb\u52a0\u5b50\u8282\u70b9\u3002\u4f8b\u5982\uff0c\u8981\u5728\u73b0\u6709\u603b\u7ebf\u8282\u70b9\u4e0a\u914d\u7f6e SPI \u6216 I2C \u5b50\u8bbe\u5907\uff0c\u53ef\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},'/* SPI device example */\n&spi1 {\n     my_spi_device: temp-sensor@0 {\n             compatible = "...";\n             label = "TEMP_SENSOR_0";\n             /* \u5982\u6709\u5fc5\u8981\uff0c reg \u53ef\u4f5c\u4e3a\u7247\u9009\u6570\u5b57;\n              * \u5982\u679c\u5b58\u5728\uff0c\u5b83\u5fc5\u987b\u5339\u914d\u5230\u8282\u70b9\u7684\u5355\u5143\u5730\u5740\u3002 */\n             reg = <0>;\n\n            /* \u6839\u636e\u9700\u8981\u914d\u7f6e SPI \u8bbe\u5907\u7684\u5176\u4ed6\u5c5e\u6027\n             * \u627e\u5230\u4f60\u7684\u8bbe\u5907\u7684\u8bbe\u5907\u6811\u7ed1\u5b9a\u4e86\u89e3\u8be6\u7ec6\u4fe1\u606f\u3002 */\n             spi-max-frequency = <4000000>;\n     };\n};\n\n/* I2C device example */\n&i2c2 {\n     my_i2c_device: touchscreen@76 {\n             compatible = "...";\n             label = "TOUCHSCREEN";\n             /* reg \u662f I2C \u8bbe\u5907\u7684\u5730\u5740\u3002\n              * \u5982\u679c\u5b58\u5728\uff0c\u5b83\u5fc5\u987b\u5339\u914d\u5230\u8282\u70b9\u7684\u5355\u5143\u5730\u5740\u3002 */\n             reg = <76>;\n\n            /* \u6839\u636e\u9700\u8981\u914d\u7f6e I2C \u8bbe\u5907\u7684\u5176\u4ed6\u5c5e\u6027\n             * \u627e\u5230\u4f60\u7684\u8bbe\u5907\u7684\u8bbe\u5907\u6811\u7ed1\u5b9a\u4e86\u89e3\u8be6\u7ec6\u4fe1\u606f\u3002 */\n     };\n};\n')),(0,r.kt)("p",null,"\u5176\u4ed6\u603b\u7ebf\u8bbe\u5907\u4e5f\u53ef\u4ee5\u7c7b\u4f3c\u914d\u7f6e\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5c06\u8bbe\u5907\u521b\u5efa\u4e3a\u7236\u603b\u7ebf\u7684\u5b50\u8282\u70b9"),(0,r.kt)("li",{parentName:"ul"},"\u6839\u636e\u5176\u7ed1\u5b9a\u8bbe\u7f6e\u5176\u5c5e\u6027")),(0,r.kt)("p",null,"\u5047\u8bbe\u4f60\u6709\u4e00\u4e2a\u5408\u9002\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\uff0c\u4e0e ",(0,r.kt)("inlineCode",{parentName:"p"},"my_spi_device")," \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"my_i2c_device")," \u7684 compatible \u76f8\u5173\u8054\uff0c\u90a3\u4e48\u4f60\u53ef\u901a\u8fc7 Kconfig \u542f\u7528\u9a71\u52a8\u7a0b\u5e8f\uff0c\u5e76\u6839\u636e\u4f60\u65b0\u6dfb\u52a0\u7684\u603b\u7ebf\u8282\u70b9 ",(0,r.kt)("a",{parentName:"p",href:"#%E4%BB%8E%E8%AE%BE%E5%A4%87%E6%A0%91%E8%8A%82%E7%82%B9%E8%8E%B7%E5%8F%96%E8%AE%BE%E5%A4%87%E7%BB%93%E6%9E%84%E4%BD%93struct-device"},"\u83b7\u53d6\u8bbe\u5907\u7ed3\u6784\u4f53")," \uff0c\u7136\u540e\u5c06\u5176\u4e0e\u8be5\u9a71\u52a8\u7a0b\u5e8f API \u4e00\u8d77\u4f7f\u7528\u3002"),(0,r.kt)("h2",{id:"\u4f7f\u7528\u8bbe\u5907\u6811-api-\u7f16\u5199\u8bbe\u5907\u9a71\u52a8"},"\u4f7f\u7528\u8bbe\u5907\u6811 API \u7f16\u5199\u8bbe\u5907\u9a71\u52a8"),(0,r.kt)("p",null,"\u201c\u8bbe\u5907\u6811\u611f\u77e5\u201d",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/kernel/drivers/index.html#device-model-api"},"\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f")," \uff08\u5373\u9a71\u52a8\u7a0b\u5e8f\u53ef\u901a\u8fc7\u8bbe\u5907\u6811\u6765\u786e\u8ba4\u9700\u9a71\u52a8\u54ea\u4e9b\u8bbe\u5907\uff09\u5e94\u8be5\u4e3a\u6bcf\u4e2a\u914d\u7f6e ",(0,r.kt)("inlineCode",{parentName:"p"},'status = "okay"')," \u7684\u8bbe\u5907\u6811\u8282\u70b9\u521b\u5efa\u4e00\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"struct device")," \uff0c\u8be5\u8282\u70b9\u5177\u6709\u9a71\u52a8\u7a0b\u5e8f\u652f\u6301\u7684\u7279\u5b9a ",(0,r.kt)("a",{parentName:"p",href:"/docs-csk6/chips/600X/build/dts/intro#%E9%87%8D%E8%A6%81%E5%B1%9E%E6%80%A7"},"compatible")," \uff08\u6216\u76f8\u5173\u7684 compatible \u96c6\u5408\uff09\u3002"),(0,r.kt)("p",null,"\u7f16\u5199\u201c\u8bbe\u5907\u6811\u611f\u77e5\u201d\u9a71\u52a8\u7a0b\u5e8f\uff0c\u9996\u5148\u8981\u4e3a\u9a71\u52a8\u7a0b\u5e8f\u652f\u6301\u7684\u8bbe\u5907\u5b9a\u4e49\u4e00\u4e2a ",(0,r.kt)("a",{parentName:"p",href:"/docs-csk6/chips/600X/build/dts/bindings"},"\u8bbe\u5907\u6811\u7ed1\u5b9a")," \u3002\u4f7f\u7528\u6765\u81ea\u9a71\u52a8\u7a0b\u5e8f\u4e2d\u7684\u73b0\u6709\u7ed1\u5b9a\u4f5c\u4e3a\u8d77\u70b9\u3002\u5f00\u59cb\u7684\u7ed1\u5b9a\u811a\u624b\u67b6\u53ea\u9700\u8981\u8fd9\u6837\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'description: <Human-readable description of your binding>\ncompatible: "foo-company,bar-device"\ninclude: base.yaml\n')),(0,r.kt)("p",null,"\u6709\u5173\u67e5\u627e\u73b0\u6709\u7ed1\u5b9a\u7684\u66f4\u591a\u5efa\u8bae\uff0c\u8bf7\u53c2\u9605 ",(0,r.kt)("a",{parentName:"p",href:"#%E6%89%BE%E5%88%B0%E8%AE%BE%E5%A4%87%E6%A0%91%E7%BB%91%E5%AE%9A"},"\u67e5\u627e\u8bbe\u5907\u6811\u7ed1\u5b9a")," \u3002"),(0,r.kt)("p",null,"\u7f16\u5199\u7ed1\u5b9a\u540e\uff0c\u4f60\u7684\u9a71\u52a8\u7a0b\u5e8f C \u6587\u4ef6\u53ef\u4ee5\u4f7f\u7528\u8bbe\u5907\u6811 API \u67e5\u627e\u6ee1\u8db3 compatible \u63cf\u8ff0\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},'status = "okay"')," \u8282\u70b9\uff0c\u5e76\u4e3a\u6bcf\u4e2a\u8282\u70b9\u5b9e\u4f8b\u5316\u4e00\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"struct device")," \u3002\u5b9e\u4f8b\u5316\u6bcf\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"struct device")," \u6709\u4e24\u79cd\u9009\u62e9\uff1a\u4f7f\u7528\u5b9e\u4f8b\u7f16\u53f7\u548c\u4f7f\u7528\u8282\u70b9\u6807\u7b7e\u3002"),(0,r.kt)("p",null,"\u5bf9\u5e94\u6bcf\u4e00\u79cd\u60c5\u51b5\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u6bcf\u4e2a ",(0,r.kt)("inlineCode",{parentName:"li"},"struct device")," \u7684\u540d\u79f0\u90fd\u5e94\u8bbe\u7f6e\u4e3a\u5176\u8bbe\u5907\u6811\u8282\u70b9\u7684\u6807\u7b7e ",(0,r.kt)("inlineCode",{parentName:"li"},"label")," \u5c5e\u6027\u3002\u8fd9\u5141\u8bb8\u9a71\u52a8\u7a0b\u5e8f\u7684\u4f7f\u7528\u8005\u4ee5\u901a\u5e38\u7684\u65b9\u5f0f ",(0,r.kt)("a",{parentName:"li",href:"#%E4%BB%8E%E8%AE%BE%E5%A4%87%E6%A0%91%E8%8A%82%E7%82%B9%E8%8E%B7%E5%8F%96%E8%AE%BE%E5%A4%87%E7%BB%93%E6%9E%84%E4%BD%93struct-device"},"\u4ece\u8bbe\u5907\u6811\u8282\u70b9\u83b7\u53d6\u8bbe\u5907\u7ed3\u6784\u4f53")," \u3002"),(0,r.kt)("li",{parentName:"ul"},"\u6bcf\u4e2a\u8bbe\u5907\u7684\u521d\u59cb\u914d\u7f6e\u5e94\u5c3d\u53ef\u80fd\u4f7f\u7528\u6765\u81ea\u8bbe\u5907\u6811\u5c5e\u6027\u7684\u503c\u3002\u8fd9\u5141\u8bb8\u4f7f\u7528\u8005\u4f7f\u7528 ",(0,r.kt)("a",{parentName:"li",href:"#%E4%BD%BF%E7%94%A8%E8%AE%BE%E5%A4%87%E6%A0%91-overlay"},"\u8bbe\u5907\u6811 overlay")," \u6765\u914d\u7f6e\u9a71\u52a8\u7a0b\u5e8f\u3002")),(0,r.kt)("p",null,"\u4ee5\u4e0b\u662f\u5982\u4f55\u6267\u884c\u6b64\u64cd\u4f5c\u7684\u793a\u4f8b\u3002\u8fd9\u4e9b\u793a\u4f8b\u5747\u5047\u8bbe\u4f60\u5df2\u7ecf\u5b9e\u73b0\u4e86\u7279\u5b9a\u4e8e\u8bbe\u5907\u7684\u914d\u7f6e\u548c\u6570\u636e\u7ed3\u6784\u4ee5\u53ca API \u51fd\u6570\uff0c\u5982\u4e0b\u6240\u793a\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},"/* my_driver.c */\n#include <zephyr/drivers/some_api.h>\n\n/* \u5b9a\u4e49\u6570\u636e (RAM) \u548c\u914d\u7f6e (ROM) \u7ed3\u6784: */\nstruct my_dev_data {\n     /* \u5b58\u50a8\u5728 RAM \u4e2d\u7684\u6bcf\u4e2a\u8bbe\u5907\u7684\u503c*/\n};\nstruct my_dev_cfg {\n     uint32_t freq; /* Just an example: initial clock frequency in Hz */\n     /* \u5b58\u50a8\u5728 ROM \u4e2d\u7684\u914d\u7f6e */\n};\n\n/* \u5b9e\u73b0\u9a71\u52a8\u7684 API \u51fd\u6570 (drivers/some_api.h \u56de\u8c03): */\nstatic int my_driver_api_func1(const struct device *dev, uint32_t *foo) { /* ... */ }\nstatic int my_driver_api_func2(const struct device *dev, uint64_t bar) { /* ... */ }\nstatic struct some_api my_api_funcs = {\n     .func1 = my_driver_api_func1,\n     .func2 = my_driver_api_func2,\n};\n")),(0,r.kt)("h3",{id:"\u65b9\u5f0f-1\u901a\u8fc7\u5b9e\u4f8b\u7f16\u53f7\u521b\u5efa\u8bbe\u5907"},"\u65b9\u5f0f 1\uff1a\u901a\u8fc7\u5b9e\u4f8b\u7f16\u53f7\u521b\u5efa\u8bbe\u5907"),(0,r.kt)("p",null,"\u8bf7\u5c3d\u53ef\u80fd\u4f7f\u7528\u6b64\u65b9\u5f0f\uff0c\u672c\u65b9\u5f0f\u4f7f\u7528 ",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/build/dts/api/api.html#devicetree-inst-apis"},"\u57fa\u4e8e\u5b9e\u4f8b\u7684 API")," \u3002\u4f46\u662f\uff0c\u5b83\u4eec\u4ec5\u5f53\u8bbe\u5907\u6811\u8282\u70b9\u4e0e\u9a71\u52a8\u7a0b\u5e8f\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"compatible")," \u662f\u7b49\u6548\u65f6\u624d\u8d77\u4f5c\u7528\uff0c\u5e76\u4e14\u4f60\u4e0d\u9700\u8981\u80fd\u591f\u533a\u5206\u5b83\u4eec\u3002"),(0,r.kt)("p",null,"\u4e3a\u4e86\u4f7f\u7528\u57fa\u4e8e\u5b9e\u4f8b\u7684 API\uff0c\u9996\u5148\u9700\u8981\u5c06 ",(0,r.kt)("inlineCode",{parentName:"p"},"DT_DRV_COMPAT")," \u5b9a\u4e49\u4e3a\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u652f\u6301\u7684 compatible \uff08\u5c0f\u5199\u548c\u4e0b\u5212\u7ebf\u7248\u672c\uff09\u3002\u4f8b\u5982\uff0c\u5982\u679c\u4f60\u7684\u9a71\u52a8\u7a0b\u5e8f\u7684 compatible \u5bf9\u5e94\u8bbe\u5907\u6811\u4e2d\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"vnd_my_device")," \uff0c\u4f60\u9700\u8981\u5728\u9a71\u52a8\u7a0b\u5e8f C \u6587\u4ef6\u4e2d\u5c06 ",(0,r.kt)("inlineCode",{parentName:"p"},"DT_DRV_COMPAT")," \u5b9a\u4e49\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"vnd_my_device")," \uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},' /*\n * \u5c06\u6b64\u884c\u5b9a\u4e49\u7f6e\u4e8e\u6e90\u7801\u6587\u4ef6\u7684\u9876\u90e8\u3002\u4f4d\u4e8e include \u533a\u57df\u4e4b\u540e\u5c31\u633a\u597d\u3002\n * (\u4f60\u53ef\u4ee5\u5728 Zephry git \u4ed3\u5e93\u8fd0\u884c "git grep DT_DRV_COMPAT drivers" \u67e5\u770b\n * \u90a3\u4e9b\u4f7f\u7528\u6b64\u6837\u5f0f\u58f0\u660e\u7684\u793a\u4f8b\u9a71\u52a8\u7a0b\u5e8f)\u3002\n */\n#define DT_DRV_COMPAT vnd_my_device\n')),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"\u91cd\u8981")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"\u6b63\u5982\u793a\u4f8b\u4e2d\u7684\u5f62\u5f0f\uff0c ",(0,r.kt)("inlineCode",{parentName:"p"},"DT_DRV_COMPAT")," \u5b8f\u4e0d\u5e94\u5305\u542b\u5f15\u53f7\u6216\u7279\u6b8a\u5b57\u7b26\u3002\u4ece compatible \u5c5e\u6027\u521b\u5efa ",(0,r.kt)("inlineCode",{parentName:"p"},"DT_DRV_COMPAT")," \u65f6\uff0c\u5e94\u5f53\u5220\u9664\u5f15\u53f7\u5e76\u5c06\u7279\u6b8a\u5b57\u7b26\u8f6c\u6362\u4e3a\u4e0b\u5212\u7ebf\u3002"))),(0,r.kt)("p",null,"\u6700\u540e\uff0c\u5b9a\u4e49\u4e00\u4e2a\u5b9e\u4f8b\u5316\u5b8f\uff0c\u5b83\u4f7f\u7528\u5b9e\u4f8b\u7f16\u53f7\u521b\u5efa\u6bcf\u4e2a\u8bbe\u5907\u7ed3\u6784\u4f53 ",(0,r.kt)("inlineCode",{parentName:"p"},"struct device")," \u3002\u5728\u5b9a\u4e49 ",(0,r.kt)("inlineCode",{parentName:"p"},"my_api_funcs")," \u4e4b\u540e\u6267\u884c\u6b64\u64cd\u4f5c\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},'/*\n * \u8fd9\u4e00\u5b9e\u4f8b\u5316\u5b8f\u547d\u540d\u4e3a "CREATE_MY_DEVICE" \u3002\n * \u5176 "inst" \u53c2\u6570\u8868\u793a\u4efb\u4e00\u5b9e\u4f8b\u7f16\u53f7\u3002\n *\n * \u5c06\u6b64\u4ee3\u7801\u6bb5\u653e\u7740\u6587\u4ef6\u672b\u5c3e\uff0c\u4f8b\u5982\u5728\u5b9a\u4e49 "my_api_funcs" \u4e4b\u540e\u3002\n */\n#define CREATE_MY_DEVICE(inst)                                       \\\n     static struct my_dev_data my_data_##inst = {                    \\\n             /* initialize RAM values as needed, e.g.: */            \\\n             .freq = DT_INST_PROP(inst, clock_frequency),            \\\n     };                                                              \\\n     static const struct my_dev_cfg my_cfg_##inst = {                \\\n             /* initialize ROM values as needed. */                  \\\n     };                                                              \\\n     DEVICE_DT_INST_DEFINE(inst,                                     \\\n                           my_dev_init_function,                     \\\n                           NULL,                                     \\\n                           &my_data_##inst,                          \\\n                           &my_cfg_##inst,                           \\\n                           MY_DEV_INIT_LEVEL, MY_DEV_INIT_PRIORITY,  \\\n                           &my_api_funcs);\n')),(0,r.kt)("p",null,"\u6ce8\u610f\u4f7f\u7528 ",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/build/dts/api/api.html#c.DT_INST_PROP"},(0,r.kt)("inlineCode",{parentName:"a"},"DT_INST_PROP()"))," \u548c ",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/kernel/drivers/index.html#c.DEVICE_DT_INST_DEFINE"},(0,r.kt)("inlineCode",{parentName:"a"},"DEVICE_DT_INST_DEFINE()"))," \u7b49 API \u6765\u8bbf\u95ee\u8bbe\u5907\u6811\u8282\u70b9\u6570\u636e\u3002\u8fd9\u4e9b API \u4ece\u8bbe\u5907\u6811\u4e2d\u68c0\u7d22\u5b9e\u4f8b\u7f16\u53f7\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"inst")," \u7684\u8282\u70b9\u6570\u636e\u2014\u2014\u5176\u4e2d\u5224\u65ad\u8282\u70b9\u6ee1\u8db3\u6761\u4ef6\u7684\u4f9d\u636e\u662f\uff0c\u68c0\u67e5 compatible \u662f\u5426\u4e0e ",(0,r.kt)("inlineCode",{parentName:"p"},"DT_DRV_COMPAT")," \u5bf9\u5e94\u3002"),(0,r.kt)("p",null,"\u6700\u540e\uff0c\u5c06\u5b9e\u4f8b\u5316\u7684\u5b8f\u4f20\u7ed9 ",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/build/dts/api/api.html#c.DT_INST_FOREACH_STATUS_OKAY"},(0,r.kt)("inlineCode",{parentName:"a"},"DT_INST_FOREACH_STATUS_OKAY()"))," \uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},"/* \u5bf9\u6bcf\u4e00\u4e2a\u5b9e\u4f8b\uff0c\u8c03\u7528\u521b\u5efa\u8bbe\u5907\u7684\u5b8f: */\nDT_INST_FOREACH_STATUS_OKAY(CREATE_MY_DEVICE)\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"DT_INST_FOREACH_STATUS_OKAY")," \u5c06\u5c55\u5f00\u4e3a\u4ee3\u7801\u6bb5\uff0c\u8be5\u4ee3\u7801\u4e3a\u6bcf\u4e2a\u542f\u7528\u7684\u8282\u70b9\uff08\u5176 compatible \u4e0e ",(0,r.kt)("inlineCode",{parentName:"p"},"DT_DRV_COMPAT")," \u5bf9\u5e94\uff09\u8c03\u7528\u4e00\u6b21 ",(0,r.kt)("inlineCode",{parentName:"p"},"CREATE_MY_DEVICE")," \u3002\u5b83\u4e0d\u4f1a\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"CREATE_MY_DEVICE")," \u6269\u5c55\u7684\u672b\u5c3e\u9644\u52a0\u5206\u53f7\uff0c\u56e0\u6b64 ",(0,r.kt)("inlineCode",{parentName:"p"},"CREATE_MY_DEVICE")," \u7684\u6269\u5c55\u5fc5\u987b\u4ee5\u5206\u53f7\u6216\u4ee3\u8868\u51fd\u6570\u7684\u5b8f\uff08\u6b64\u5b8f\u7684\u5b9a\u4e49\u4e2d\u4e5f\u9700\u8981\u4ee5\u5206\u53f7\u7ed3\u5c3e\uff09\u7ed3\u5c3e\u4ee5\u652f\u6301\u591a\u4e2a\u8bbe\u5907\u3002"),(0,r.kt)("h3",{id:"\u65b9\u5f0f-2\u901a\u8fc7\u8282\u70b9\u6807\u7b7e\u521b\u5efa\u8bbe\u5907"},"\u65b9\u5f0f 2\uff1a\u901a\u8fc7\u8282\u70b9\u6807\u7b7e\u521b\u5efa\u8bbe\u5907"),(0,r.kt)("p",null,"\u67d0\u4e9b\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u4e0d\u80fd\u4f7f\u7528\u5b9e\u4f8b\u7f16\u53f7\u3002\u4f8b\u5982\uff0c\u4e00\u4e2a SoC \u5916\u8bbe\u9a71\u52a8\u7a0b\u5e8f\uff0c\u5b83\u4f9d\u8d56\u4e8e\u4e13\u95e8\u9488\u5bf9\u5404\u4e2a IP \u5757\u7684\u4f9b\u5e94\u5546 HAL API \u6765\u5b9e\u73b0 Zephyr \u9a71\u52a8\u7a0b\u5e8f\u56de\u8c03\u3002\u6b64\u7c7b\u60c5\u51b5\u5e94\u4f7f\u7528 ",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/build/dts/api/api.html#c.DT_NODELABEL"},(0,r.kt)("inlineCode",{parentName:"a"},"DT_NODELABEL()"))," \u6765\u5f15\u7528\u8bbe\u5907\u6811\u4e2d\u4ee3\u8868 SoC \u4e0a\u652f\u6301\u7684\u5916\u8bbe\u7684\u5404\u4e2a\u8282\u70b9\u3002\u7136\u540e\u53ef\u4ee5\u4f7f\u7528 devicetree.h ",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/build/dts/api/api.html#devicetree-generic-apis"},"\u901a\u7528 API")," \u8bbf\u95ee\u8282\u70b9\u6570\u636e\u3002"),(0,r.kt)("p",null,"\u4e3a\u6b64\uff0c\u5fc5\u987b\u5728\u4f60\u7684 ",(0,r.kt)("a",{parentName:"p",href:"/docs-csk6/chips/600X/build/dts/intro#%E8%BE%93%E5%85%A5%E6%96%87%E4%BB%B6"},"SoC \u7684 dtsi \u6587\u4ef6")," \u4e2d\uff0c\u4e3a\u4f60\u7684\u9a71\u52a8\u7a0b\u5e8f\u652f\u6301\u7684 IP \u5757\u5b9a\u4e49\u9002\u5408\u7684\u8282\u70b9\u6807\u7b7e\uff0c\u5982 ",(0,r.kt)("inlineCode",{parentName:"p"},"mydevice0")," \u3001 ",(0,r.kt)("inlineCode",{parentName:"p"},"mydevice1")," \u7b49\u3002\u751f\u6210\u7684\u8bbe\u5907\u6811\u901a\u5e38\u770b\u8d77\u6765\u50cf\u8fd9\u6837\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},'/ {\n        soc {\n                mydevice0: dev@0 {\n                        compatible = "vnd,my-device";\n                };\n                mydevice1: dev@1 {\n                        compatible = "vnd,my-device";\n                };\n        };\n};\n')),(0,r.kt)("p",null,"\u9a71\u52a8\u7a0b\u5e8f\u53ef\u4ee5\u4f7f\u7528\u8bbe\u5907\u6811\u4e2d\u7684\u8282\u70b9\u6807\u7b7e ",(0,r.kt)("inlineCode",{parentName:"p"},"mydevice0")," \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"mydevice1")," \u5bf9\u7279\u5b9a\u8bbe\u5907\u8282\u70b9\u8fdb\u884c\u64cd\u4f5c\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},'/*\n * \u521b\u5efa\u6b64\u5b8f\u53ef\u4fbf\u4e8e\u4e3a\u5bf9\u5e94\u8bbe\u5907\u521b\u5efa\u8282\u70b9 id \u3002\n * \u4f8b\u5982\u4f7f\u7528 MYDEV(0) \u6765\u5f15\u7528\u6807\u7b7e\u4e3a "mydevice0" \u7684\u8282\u70b9\u3002\n */\n#define MYDEV(idx) DT_NODELABEL(mydevice ## idx)\n\n/*\n * \u5b9a\u4e49\u4f60\u7684\u5b9e\u4f8b\u5316\u5b8f\uff1b "idx" \u662f\u7d22\u5f15\uff0c\u8868\u793a\u4e0e\u8bbe\u5907\u6709\u5bf9\u5e94\u5173\u7cfb\u7684\u6570\u5b57\uff0c\n * \u4f8b\u5982 mydevice0 \u5bf9\u5e94 0 \uff0cmydevice1 \u5bf9\u5e94 1 \u3002\n * \u5176\u4e2d\u5c06\u4f7f\u7528 MYDEV() \u521b\u5efa\u7531\u7d22\u5f15\u5f97\u51fa\u7684\u8282\u70b9\u6807\u7b7e\u3002\n */\n#define CREATE_MY_DEVICE(idx)                                        \\\n     static struct my_dev_data my_data_##idx = {                     \\\n             /* initialize RAM values as needed, e.g.: */            \\\n             .freq = DT_PROP(MYDEV(idx), clock_frequency),           \\\n     };                                                              \\\n     static const struct my_dev_cfg my_cfg_##idx = { /* ... */ };    \\\n     DEVICE_DT_DEFINE(MYDEV(idx),                                    \\\n                     my_dev_init_function,                           \\\n                     NULL,                                           \\\n                     &my_data_##idx,                                 \\\n                     &my_cfg_##idx,                                  \\\n                     MY_DEV_INIT_LEVEL, MY_DEV_INIT_PRIORITY,        \\\n                     &my_api_funcs)\n')),(0,r.kt)("p",null,"\u8981\u8bbf\u95ee\u8bbe\u5907\u6811\u8282\u70b9\u6570\u636e\u65f6\uff0c\u8bf7\u6ce8\u610f ",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/build/dts/api/api.html#c.DT_PROP"},(0,r.kt)("inlineCode",{parentName:"a"},"DT_PROP()"))," \u548c ",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/kernel/drivers/index.html#c.DEVICE_DT_DEFINE"},(0,r.kt)("inlineCode",{parentName:"a"},"DEVICE_DT_DEFINE()"))," \u7b49 API \u7684\u7528\u6cd5\u3002"),(0,r.kt)("p",null,"\u6700\u540e\uff0c\u901a\u8fc7\u5b9a\u4e49\u5b8f\u624b\u52a8\u68c0\u6d4b\u6bcf\u4e2a\u8bbe\u5907\u6811\u8282\u70b9\u662f\u5426\u542f\u7528\uff0c\u5e76\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"CREATE_MY_DEVICE")," \u5b9e\u4f8b\u5316\u6bcf\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"struct device")," \uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},"#if DT_NODE_HAS_STATUS(DT_NODELABEL(mydevice0), okay)\nCREATE_MY_DEVICE(0)\n#endif\n\n#if DT_NODE_HAS_STATUS(DT_NODELABEL(mydevice1), okay)\nCREATE_MY_DEVICE(1)\n#endif\n")),(0,r.kt)("p",null,"\u8fd9\u79cd\u8c03\u7528\u5f62\u5f0f\u4e0d\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"DT_INST_FOREACH_STATUS_OKAY()")," \uff0c\u56e0\u6b64\u9a71\u52a8\u7a0b\u5e8f\u4f5c\u8005\u9700\u8981\u8d1f\u8d23\u4e3a\u6bcf\u4e2a\u53ef\u80fd\u6ee1\u8db3\u6761\u4ef6\u7684\u8282\u70b9\u8c03\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"CREATE_MY_DEVICE()")," \uff0c\u4f8b\u5982\u6839\u636e\u53d7 SoC \u4e0a\u53ef\u652f\u6301\u5916\u8bbe\u7684\u6709\u5173\u4fe1\u606f\uff0c\u6765\u5224\u65ad\u662f\u5426\u53ef\u6ee1\u8db3\u6761\u4ef6\u3002"),(0,r.kt)("h2",{id:"\u4f9d\u8d56\u5176\u4ed6\u8bbe\u5907\u7684\u8bbe\u5907\u9a71\u52a8"},"\u4f9d\u8d56\u5176\u4ed6\u8bbe\u5907\u7684\u8bbe\u5907\u9a71\u52a8"),(0,r.kt)("p",null,"\u6709\u65f6\uff0c\u4e00\u4e2a",(0,r.kt)("inlineCode",{parentName:"p"},"struct device")," \u4f9d\u8d56\u4e8e\u53e6\u4e00\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"struct device")," \u5e76\u9700\u8981\u4e00\u4e2a\u53ef\u6307\u5411\u5b83\u7684\u6307\u9488\u3002\u4f8b\u5982\uff0c\u4f20\u611f\u5668\u8bbe\u5907\u53ef\u80fd\u9700\u8981\u6307\u5411\u5176 SPI \u603b\u7ebf\u63a7\u5236\u5668\u8bbe\u5907\u7684\u6307\u9488\u3002\u5bf9\u6b64\u6709\u4e00\u4e9b\u5efa\u8bae\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5728\u7f16\u5199\u4f60\u7684\u8bbe\u5907\u6811\u7ed1\u5b9a\u65f6\uff0c\u5c3d\u53ef\u80fd\u4ee5\u4f7f\u7528\u7531 devicetree.h \u7684 ",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/build/dts/api/api.html#devicetree-hw-api"},"\u786c\u4ef6\u7279\u5b9a API")," \u6279\u51c6\u7684\u65b9\u5f0f\u3002")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u7279\u522b\u662f\uff0c\u5bf9\u4e8e\u603b\u7ebf\u8bbe\u5907\uff0c\u4f60\u7684\u9a71\u52a8\u7a0b\u5e8f\u7ed1\u5b9a\u5e94\u8be5 include \u4f8b\u5982 ",(0,r.kt)("a",{parentName:"p",href:"https://cloud.listenai.com/zephyr/zephyr/-/blob/master/dts/bindings/spi/spi-device.yaml"},"dts/bindings/spi/spi-device.yaml")," \u7684\u6587\u4ef6\uff0c\u5b83\u4e3a\u8bbe\u5907\u63d0\u4f9b\u4e00\u4e9b\u901a\u7528\u5b9a\u4e49\uff0c\u7528\u4e8e\u7279\u5b9a\u603b\u7ebf\u5bfb\u5740\u3002\u8fd9\u5141\u8bb8\u4f7f\u7528 ",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/build/dts/api/api.html#c.DT_BUS"},(0,r.kt)("inlineCode",{parentName:"a"},"DT_BUS()"))," \u4e4b\u7c7b\u7684 API \u6765\u83b7\u53d6\u603b\u7ebf\u8282\u70b9\u7684\u8282\u70b9 id \u3002\u7136\u540e\uff0c\u4f60\u53ef\u4ee5\u5bf9\u603b\u7ebf\u4f7f\u7528 ",(0,r.kt)("a",{parentName:"p",href:"#%E4%BB%8E%E8%AE%BE%E5%A4%87%E6%A0%91%E8%8A%82%E7%82%B9%E8%8E%B7%E5%8F%96%E8%AE%BE%E5%A4%87%E7%BB%93%E6%9E%84%E4%BD%93struct-device"},"\u4ece\u8bbe\u5907\u6811\u8282\u70b9\u83b7\u53d6\u8bbe\u5907\u7ed3\u6784\u4f53")," \u7684\u4e00\u822c\u65b9\u5f0f\u3002"))),(0,r.kt)("p",null,"\u53ef\u641c\u7d22\u73b0\u6709\u7ed1\u5b9a\u548c\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u4ee5\u83b7\u53d6\u793a\u4f8b\u3002"),(0,r.kt)("h2",{id:"\u4f9d\u8d56\u5f00\u53d1\u677f\u7279\u5b9a\u8bbe\u5907\u7684\u5e94\u7528"},"\u4f9d\u8d56\u5f00\u53d1\u677f\u7279\u5b9a\u8bbe\u5907\u7684\u5e94\u7528"),(0,r.kt)("p",null,"\u5982\u679c\u60f3\u8981\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7801\u672a\u7ecf\u4fee\u6539\u5373\u53ef\u5728\u591a\u4e2a\u677f\u4e0a\u8fd0\u884c\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u8bbe\u5907\u6811\u522b\u540d\u6765\u6307\u5b9a\u786c\u4ef6\u7279\u5b9a\u90e8\u5206\uff0c\u5c31\u50cf\u5728 ",(0,r.kt)("a",{parentName:"p",href:"/docs-csk6/chips/600X/application/peripheral/samples/gpio"},"GPIO \u793a\u4f8b")," \u4e2d\u6240\u505a\u7684\u90a3\u6837\u3002\u7136\u540e\u53ef\u4ee5\u5728 ",(0,r.kt)("a",{parentName:"p",href:"/docs-csk6/chips/600X/build/dts/intro#%E8%BE%93%E5%85%A5%E4%B8%8E%E8%BE%93%E5%87%BA%E6%96%87%E4%BB%B6"},"BOARD.dts")," \u6587\u4ef6\u4e2d\u6216\u901a\u8fc7 ",(0,r.kt)("a",{parentName:"p",href:"#%E4%BD%BF%E7%94%A8%E8%AE%BE%E5%A4%87%E6%A0%91-overlay"},"\u8bbe\u5907\u6811 overlay")," \u914d\u7f6e\u5e94\u7528\u7a0b\u5e8f\u3002"))}o.isMDXComponent=!0}}]);