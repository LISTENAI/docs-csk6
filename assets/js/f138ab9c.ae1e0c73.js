"use strict";(self.webpackChunkls_docs_web=self.webpackChunkls_docs_web||[]).push([[9985],{3905:(e,a,t)=>{t.d(a,{Zo:()=>k,kt:()=>m});var n=t(67294);function p(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function r(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function i(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?r(Object(t),!0).forEach((function(a){p(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function l(e,a){if(null==e)return{};var t,n,p=function(e,a){if(null==e)return{};var t,n,p={},r=Object.keys(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||(p[t]=e[t]);return p}(e,a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(p[t]=e[t])}return p}var o=n.createContext({}),s=function(e){var a=n.useContext(o),t=a;return e&&(t="function"==typeof e?e(a):i(i({},a),e)),t},k=function(e){var a=s(e.components);return n.createElement(o.Provider,{value:a},e.children)},c={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},h=n.forwardRef((function(e,a){var t=e.components,p=e.mdxType,r=e.originalType,o=e.parentName,k=l(e,["components","mdxType","originalType","parentName"]),h=s(t),m=p,d=h["".concat(o,".").concat(m)]||h[m]||c[m]||r;return t?n.createElement(d,i(i({ref:a},k),{},{components:t})):n.createElement(d,i({ref:a},k))}));function m(e,a){var t=arguments,p=a&&a.mdxType;if("string"==typeof e||p){var r=t.length,i=new Array(r);i[0]=h;var l={};for(var o in a)hasOwnProperty.call(a,o)&&(l[o]=a[o]);l.originalType=e,l.mdxType="string"==typeof e?e:p,i[1]=l;for(var s=2;s<r;s++)i[s]=t[s];return n.createElement.apply(null,i)}return n.createElement.apply(null,t)}h.displayName="MDXCreateElement"},17018:(e,a,t)=>{t.d(a,{Z:()=>p});var n=t(67294);const p=function(e){let{children:a,hidden:t,className:p}=e;return n.createElement("div",{role:"tabpanel",hidden:t,className:p},a)}},98936:(e,a,t)=>{t.d(a,{Z:()=>c});var n=t(67294),p=t(12674);const r=function(){const e=(0,n.useContext)(p.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e};var i=t(86010);const l="tabItem_TMUB",o="tabItemActive_WQC4";const s=37,k=39;const c=function(e){const{lazy:a,block:t,defaultValue:p,values:c,groupId:h,className:m}=e,{tabGroupChoices:d,setTabGroupChoices:u}=r(),[y,g]=(0,n.useState)(p),f=n.Children.toArray(e.children),C=[];if(null!=h){const e=d[h];null!=e&&e!==y&&c.some((a=>a.value===e))&&g(e)}const Z=e=>{const a=e.currentTarget,t=C.indexOf(a),n=c[t].value;g(n),null!=h&&(u(h,n),setTimeout((()=>{(function(e){const{top:a,left:t,bottom:n,right:p}=e.getBoundingClientRect(),{innerHeight:r,innerWidth:i}=window;return a>=0&&p<=i&&n<=r&&t>=0})(a)||(a.scrollIntoView({block:"center",behavior:"smooth"}),a.classList.add(o),setTimeout((()=>a.classList.remove(o)),2e3))}),150))},N=e=>{var a;let t;switch(e.keyCode){case k:{const a=C.indexOf(e.target)+1;t=C[a]||C[0];break}case s:{const a=C.indexOf(e.target)-1;t=C[a]||C[C.length-1];break}}null==(a=t)||a.focus()};return n.createElement("div",{className:"tabs-container"},n.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":t},m)},c.map((e=>{let{value:a,label:t}=e;return n.createElement("li",{role:"tab",tabIndex:y===a?0:-1,"aria-selected":y===a,className:(0,i.Z)("tabs__item",l,{"tabs__item--active":y===a}),key:a,ref:e=>C.push(e),onKeyDown:N,onFocus:Z,onClick:Z},t)}))),a?(0,n.cloneElement)(f.filter((e=>e.props.value===y))[0],{className:"margin-vert--md"}):n.createElement("div",{className:"margin-vert--md"},f.map(((e,a)=>(0,n.cloneElement)(e,{key:a,hidden:e.props.value!==y})))))}},12674:(e,a,t)=>{t.d(a,{Z:()=>n});const n=(0,t(67294).createContext)(void 0)},78361:(e,a,t)=>{t.r(a),t.d(a,{contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>k});var n=t(87462),p=(t(67294),t(3905)),r=t(98936),i=t(17018);const l={},o="Zephyr CMake Package(\u5305)",s={unversionedId:"chips/600X/build/cmake_package",id:"chips/600X/build/cmake_package",isDocsHomePage:!1,title:"Zephyr CMake Package(\u5305)",description:"The Zephyr CMake package is a convenient way to create a Zephyr-based application.",source:"@site/docs/chips/600X/build/cmake_package.md",sourceDirName:"chips/600X/build",slug:"/chips/600X/build/cmake_package",permalink:"/docs-csk6/chips/600X/build/cmake_package",version:"current",frontMatter:{},sidebar:"docs/chips/600X",previous:{title:"\u6784\u5efa\u7cfb\u7edf\uff08 CMake \uff09",permalink:"/docs-csk6/chips/600X/build/cmake/index"},next:{title:"\u8bbe\u5907\u6811\u6982\u8ff0",permalink:"/docs-csk6/chips/600X/build/dts/intro"}},k=[{value:"Zephyr CMake package export (west)",id:"zephyr-cmake-package-export-west",children:[]},{value:"Zephyr CMake \u5305 \u5bfc\u51fa (Lisa)",id:"zephyr-cmake-\u5305-\u5bfc\u51fa-lisa",children:[]},{value:"Zephyr CMake package export (without west)",id:"zephyr-cmake-package-export-without-west",children:[]},{value:"Zephyr CMake \u5305 \u5bfc\u51fa (\u65e0 Lisa)",id:"zephyr-cmake-\u5305-\u5bfc\u51fa-\u65e0-lisa",children:[]},{value:"Zephyr Base Environment Setting",id:"zephyr-base-environment-setting",children:[]},{value:"Zephyr \u57fa\u7840\u73af\u5883\u8bbe\u7f6e",id:"zephyr-\u57fa\u7840\u73af\u5883\u8bbe\u7f6e",children:[]},{value:"Zephyr CMake Package Search Order",id:"zephyr-cmake-package-search-order",children:[]},{value:"Zephyr CMake \u5305\u641c\u7d22\u987a\u5e8f",id:"zephyr-cmake-\u5305\u641c\u7d22\u987a\u5e8f",children:[]},{value:"Zephyr CMake Package Version\xb6",id:"zephyr-cmake-package-version",children:[]},{value:"Zephyr CMake \u5305\u7248\u672c",id:"zephyr-cmake-\u5305\u7248\u672c",children:[]},{value:"Multiple Zephyr Installations (Zephyr workspace)",id:"multiple-zephyr-installations-zephyr-workspace",children:[]},{value:"\u591a\u4e2a Zephyr",id:"\u591a\u4e2a-zephyr",children:[]},{value:"Zephyr Build Configuration CMake package (Freestanding application)",id:"zephyr-build-configuration-cmake-package-freestanding-application",children:[]},{value:"Zephyr \u6784\u5efa\u914d\u7f6e CMake \u5305(\u72ec\u7acb\u5e94\u7528)",id:"zephyr-\u6784\u5efa\u914d\u7f6e-cmake-\u5305\u72ec\u7acb\u5e94\u7528",children:[]},{value:"Zephyr CMake package source code",id:"zephyr-cmake-package-source-code",children:[]},{value:"Zephyr CMake \u5305\u6e90\u4ee3\u7801",id:"zephyr-cmake-\u5305\u6e90\u4ee3\u7801",children:[]}],c={toc:k};function h(e){let{components:a,...t}=e;return(0,p.kt)("wrapper",(0,n.Z)({},c,t,{components:a,mdxType:"MDXLayout"}),(0,p.kt)("h1",{id:"zephyr-cmake-package\u5305"},"Zephyr CMake Package(\u5305)"),(0,p.kt)("p",null,"The Zephyr ",(0,p.kt)("a",{parentName:"p",href:"https://cmake.org/cmake/help/latest/manual/cmake-packages.7.html"},"CMake package")," is a convenient way to create a Zephyr-based application."),(0,p.kt)("p",null,"The Zephyr CMake package ensures that CMake can automatically select a Zephyr to use for building the application, whether it is a ",(0,p.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/develop/application/index.html#zephyr-repo-app"},"Zephyr repository application"),", ",(0,p.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/develop/application/index.html#zephyr-workspace-app"},"Zephyr workspace application"),", or a ",(0,p.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/develop/application/index.html#zephyr-freestanding-app"},"Zephyr freestanding application"),"."),(0,p.kt)("p",null,"When developing a Zephyr-based application, then a developer simply needs to write ",(0,p.kt)("inlineCode",{parentName:"p"},"find_package(Zephyr)")," in the beginning of the application ",(0,p.kt)("inlineCode",{parentName:"p"},"CMakeLists.txt")," file."),(0,p.kt)("p",null,"To use the Zephyr CMake package it must first be exported to the CMake user package registry. This is means creating a reference to the current Zephyr installation inside the CMake user package registry."),(0,p.kt)("p",null,"Zephyr ",(0,p.kt)("a",{parentName:"p",href:"https://cmake.org/cmake/help/latest/manual/cmake-packages.7.html"},"CMake Package"),"(\u5305) \u975e\u5e38\u9002\u5408\u521b\u5efa\u57fa\u4e8e Zephyr \u7684\u5e94\u7528\u3002"),(0,p.kt)("p",null,"Zephyr CMake Package(\u5305) \u786e\u4fdd CMake \u53ef\u4ee5\u81ea\u52a8\u9009\u62e9 Zephyr \u7528\u4e8e\u7f16\u8bd1\u5e94\u7528\uff0c\u65e0\u8bba\u662f",(0,p.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/develop/application/index.html#zephyr-workspace-app"},"Zephyr \u96c6\u6210\u5f0f\u5e94\u7528"),"\uff0c\u8fd8\u662f ",(0,p.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/develop/application/index.html#zephyr-freestanding-app"},"Zephyr \u72ec\u7acb\u5f0f\u5e94\u7528"),"\u3002"),(0,p.kt)("p",null,"\u5728\u5f00\u53d1\u57fa\u4e8e Zephyr \u7684\u5e94\u7528\u65f6\uff0c\u5f00\u53d1\u8005\u53ea\u9700\u8981\u5728\u5e94\u7528\u7684\u76ee\u5f55 ",(0,p.kt)("inlineCode",{parentName:"p"},"CMakeLists.txt")," \u6587\u4ef6\u7684\u5f00\u5934\u5199\u5165 ",(0,p.kt)("inlineCode",{parentName:"p"},"find_package(Zephyr)")," \u5373\u53ef\u3002"),(0,p.kt)("p",null,"\u8981\u4f7f\u7528 Zephyr CMake Package(\u5305) \u5fc5\u987b\u5148\u5c06\u5176\u5bfc\u51fa\u5230 ",(0,p.kt)("a",{parentName:"p",href:"https://cmake.org/cmake/help/latest/manual/cmake-packages.7.html#user-package-registry"},"CMake \u7528\u6237\u5305\u6ce8\u518c\u8868"),"\u3002\u4e0a\u8ff0\u7684\u610f\u601d\u662f\u5728 CMake \u7528\u6237\u5305\u6ce8\u518c\u8868\u4e2d\u521b\u5efa\u4e00\u4e2a\u5230\u5f53\u524d Zephyr \u7684\u5f15\u7528\u3002"),(0,p.kt)(r.Z,{defaultValue:"ubuntu",values:[{label:"Ubuntu",value:"ubuntu"},{label:"macOS",value:"mac"},{label:"Windows",value:"win"}],mdxType:"Tabs"},(0,p.kt)(i.Z,{value:"ubuntu",mdxType:"TabItem"},(0,p.kt)("p",null,"In Linux, the CMake user package registry is found in:"),(0,p.kt)("p",null,(0,p.kt)("inlineCode",{parentName:"p"},"~/.cmake/package/Zephyr")),(0,p.kt)("p",null,"\u5728 Linux \u4e2d\uff0cCMake \u7528\u6237\u5305\u6ce8\u518c\u8868\u5728:"),(0,p.kt)("p",null,(0,p.kt)("inlineCode",{parentName:"p"},"~/.cmake/package/Zephyr"))),(0,p.kt)(i.Z,{value:"mac",mdxType:"TabItem"},(0,p.kt)("p",null,"In macOS, the CMake user package registry is found in:"),(0,p.kt)("p",null,(0,p.kt)("inlineCode",{parentName:"p"},"~/.cmake/package/Zephyr")),(0,p.kt)("p",null,"\u5728 macOS \u4e2d\uff0cCMake \u7528\u6237\u5305\u6ce8\u518c\u8868\u5728:"),(0,p.kt)("p",null,(0,p.kt)("inlineCode",{parentName:"p"},"~/.cmake/package/Zephyr"))),(0,p.kt)(i.Z,{value:"win",mdxType:"TabItem"},(0,p.kt)("p",null,"In Windows, the CMake user package registry is found in:"),(0,p.kt)("p",null,(0,p.kt)("inlineCode",{parentName:"p"},"HKEY_CURRENT_USER\\Software\\Kitware\\CMake\\Packages\\Zephyr")),(0,p.kt)("p",null,"\u5728 Windows \u4e2d\uff0cCMake \u7528\u6237\u5305\u6ce8\u518c\u8868\u5728:"),(0,p.kt)("p",null,(0,p.kt)("inlineCode",{parentName:"p"},"HKEY_CURRENT_USER\\Software\\Kitware\\CMake\\Packages\\Zephyr")))),(0,p.kt)("p",null,"The Zephyr CMake package allows CMake to automatically find a Zephyr base. One or more Zephyr installations must be exported. Exporting multiple Zephyr installations may be useful when developing or testing Zephyr freestanding applications, Zephyr workspace application with vendor forks, etc.."),(0,p.kt)("p",null,"Zephyr CMake Package(\u5305)\u5141\u8bb8 CMake \u81ea\u52a8\u67e5\u627e Zephyr\uff0c\u5fc5\u987b\u5bfc\u51fa\u4e00\u4e2a\u6216\u8005\u591a\u4e2a Zephyr\u3002\u5728\u5f00\u53d1\u6216\u6d4b\u8bd5 Zephyr \u72ec\u7acb\u5f0f\u5e94\u7528\u3001\u5e26\u6709\u4f9b\u5e94\u5546\u5206\u652f\u7684 Zephyr \u96c6\u6210\u5f0f\u5e94\u7528\u7b49\u65f6\uff0c\u5bfc\u51fa\u591a\u4e2a Zephyr \u53ef\u80fd\u5f88\u6709\u7528\u3002"),(0,p.kt)("h2",{id:"zephyr-cmake-package-export-west"},"Zephyr CMake package export (west)"),(0,p.kt)("h2",{id:"zephyr-cmake-\u5305-\u5bfc\u51fa-lisa"},"Zephyr CMake \u5305 \u5bfc\u51fa (Lisa)"),(0,p.kt)("p",null,"When installing ",(0,p.kt)("a",{parentName:"p",href:"https://zephyr-docs.listenai.com/getting_started/index.html#get-the-code"},"Zephyr using west")," then it is recommended to export Zephyr using ",(0,p.kt)("inlineCode",{parentName:"p"},"west zephyr-export"),"."),(0,p.kt)("p",null,"\u4f7f\u7528 ",(0,p.kt)("inlineCode",{parentName:"p"},"Lisa Zephyr")," \u63d2\u4ef6\u5b89\u88c5 Zephyr \u65f6\uff0c\u5efa\u8bae\u4f7f\u7528 ",(0,p.kt)("inlineCode",{parentName:"p"},"lisa zep zephyr-export"),"\u3002"),(0,p.kt)("h2",{id:"zephyr-cmake-package-export-without-west"},"Zephyr CMake package export (without west)"),(0,p.kt)("h2",{id:"zephyr-cmake-\u5305-\u5bfc\u51fa-\u65e0-lisa"},"Zephyr CMake \u5305 \u5bfc\u51fa (\u65e0 Lisa)"),(0,p.kt)("p",null,"Zephyr CMake package is exported to the CMake user package registry using the following commands:"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-bash"},"cmake -P <PATH-TO-ZEPHYR>/share/zephyr-package/cmake/zephyr_export.cmake\n")),(0,p.kt)("p",null,"This will export the current Zephyr to the CMake user package registry."),(0,p.kt)("p",null,"\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u5c06 Zephyr CMake \u5305\u5bfc\u51fa\u5230 CMake \u7528\u6237\u5305\u6ce8\u518c\u8868:"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-bash"},"cmake -P <PATH-TO-ZEPHYR>/share/zephyr-package/cmake/zephyr_export.cmake\n")),(0,p.kt)("p",null,"\u8fd9\u4f1a\u5c06\u5f53\u524d\u7684 Zephyr \u5bfc\u51fa\u5230 CMake \u7528\u6237\u5305\u6ce8\u518c\u8868\u4e2d\u3002"),(0,p.kt)("p",null,"To also export the Zephyr Unittest CMake package, run the following command in addition:"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-bash"},"cmake -P <PATH-TO-ZEPHYR>/share/zephyrunittest-package/cmake/zephyr_export.cmake\n")),(0,p.kt)("p",null,"\u8981\u5bfc\u51fa Zephyr \u5355\u5143\u6d4b\u8bd5 CMake \u5305\uff0c\u9700\u8981\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4:"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-bash"},"cmake -P <PATH-TO-ZEPHYR>/share/zephyrunittest-package/cmake/zephyr_export.cmake\n")),(0,p.kt)("h2",{id:"zephyr-base-environment-setting"},"Zephyr Base Environment Setting"),(0,p.kt)("h2",{id:"zephyr-\u57fa\u7840\u73af\u5883\u8bbe\u7f6e"},"Zephyr \u57fa\u7840\u73af\u5883\u8bbe\u7f6e"),(0,p.kt)("p",null,"The Zephyr CMake package search functionality allows for explicitly specifying a Zephyr base using an environment variable."),(0,p.kt)("p",null,"To do this, use the following ",(0,p.kt)("inlineCode",{parentName:"p"},"find_package()")," syntax:"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-cmake"},"find_package(Zephyr REQUIRED HINTS $ENV{ZEPHYR_BASE})\n")),(0,p.kt)("p",null,"This syntax instructs CMake to first search for Zephyr using the Zephyr base environment setting ",(0,p.kt)("inlineCode",{parentName:"p"},"ZEPHYR_BASE")," and then use the normal search paths."),(0,p.kt)("p",null,"Zephyr CMake \u5305\u641c\u7d22\u529f\u80fd\u5141\u8bb8\u4f7f\u7528\u73af\u5883\u53d8\u91cf\u6307\u5b9a Zephyr base\u3002"),(0,p.kt)("p",null,"\u4e3a\u6b64\uff0c\u4f7f\u7528\u4ee5\u4e0b ",(0,p.kt)("inlineCode",{parentName:"p"},"find_package()")," \u8bed\u6cd5:"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-cmake"},"find_package(Zephyr REQUIRED HINTS $ENV{ZEPHYR_BASE})\n")),(0,p.kt)("p",null,"\u6b64\u8bed\u6cd5\u8bf4\u660e CMake \u5148\u4f7f\u7528 ",(0,p.kt)("inlineCode",{parentName:"p"},"ZEPHYR_BASE")," \u7684\u73af\u5883\u53d8\u91cf\u641c\u7d22 Zephyr\uff0c\u7136\u540e\u518d\u4f7f\u7528\u6807\u51c6\u7684\u641c\u7d22\u8def\u5f84\u3002"),(0,p.kt)("h2",{id:"zephyr-cmake-package-search-order"},"Zephyr CMake Package Search Order"),(0,p.kt)("h2",{id:"zephyr-cmake-\u5305\u641c\u7d22\u987a\u5e8f"},"Zephyr CMake \u5305\u641c\u7d22\u987a\u5e8f"),(0,p.kt)("p",null,"When Zephyr base environment setting is not used for searching, the Zephyr installation matching the following criteria will be used:"),(0,p.kt)("p",null,"\u5f53 Zephyr base \u73af\u5883\u53d8\u91cf\u4e0d\u7528\u4e8e\u641c\u7d22\u65f6\uff0cZephyr \u5c06\u4f7f\u7528\u4ee5\u4e0b\u6761\u4ef6\u5339\u914d:"),(0,p.kt)("ul",null,(0,p.kt)("li",{parentName:"ul"},"A Zephyr repository application will use the Zephyr in which it is located. For example:")),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre"},"<projects>/zephyr-workspace/zephyr\n\u2514\u2500\u2500 samples\n    \u2514\u2500\u2500 hello_world\n")),(0,p.kt)("ul",null,(0,p.kt)("li",{parentName:"ul"},"Zephyr workspace application will use the Zephyr that share the same workspace. For example:")),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre"},"<projects>/zephyr-workspace\n\u251c\u2500\u2500 zephyr\n\u251c\u2500\u2500 ...\n\u2514\u2500\u2500 my_applications\n     \u2514\u2500\u2500 my_first_app\n")),(0,p.kt)("p",null,"in this example, ",(0,p.kt)("inlineCode",{parentName:"p"},"my_first_app")," will use ",(0,p.kt)("inlineCode",{parentName:"p"},"<projects>/zephyr-workspace/zephyr")," as this Zephyr is located in the same workspace as the Zephyr workspace application."),(0,p.kt)("ul",null,(0,p.kt)("li",{parentName:"ul"},"Zephyr \u96c6\u6210\u5f0f\u5e94\u7528\u5c06\u4f7f\u7528\u5171\u540c Zephyr SDK \u76ee\u5f55\u3002\u4f8b\u5982:")),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre"},"<projects>/zephyr-workspace\n\u251c\u2500\u2500 zephyr\n\u251c\u2500\u2500 ...\n\u2514\u2500\u2500 my_applications\n     \u2514\u2500\u2500 my_first_app\n")),(0,p.kt)("p",null,"\u5728\u672c\u4f8b\u4e2d\uff0c",(0,p.kt)("inlineCode",{parentName:"p"},"my_first_app")," \u5c06\u4f7f\u7528 ",(0,p.kt)("inlineCode",{parentName:"p"},"<projects>/zephyr-workspace/zephyr")," \u76ee\u5f55\u4f5c\u4e3a Zephyr SDK\u3002"),(0,p.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,p.kt)("div",{parentName:"div",className:"admonition-heading"},(0,p.kt)("h5",{parentName:"div"},(0,p.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,p.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,p.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,p.kt)("div",{parentName:"div",className:"admonition-content"},(0,p.kt)("p",{parentName:"div"},"The root of a Zephyr workspace is identical to west topdir if the workspace was installed using west\n\u5982\u679c Zephyr SDK \u4f7f\u7528 ",(0,p.kt)("inlineCode",{parentName:"p"},"Lisa Zephyr")," \u63d2\u4ef6\u5b89\u88c5\uff0cZephyr SDK \u7684\u6839\u76ee\u5f55\u4e0e ",(0,p.kt)("inlineCode",{parentName:"p"},"lisa zep topdir")," \u6253\u5370\u7684\u76ee\u5f55\u76f8\u540c\u3002"))),(0,p.kt)("ul",null,(0,p.kt)("li",{parentName:"ul"},"Zephyr freestanding application will use the Zephyr registered in the CMake user package registry. For example:")),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre"},"<projects>/zephyr-workspace-1\n\u2514\u2500\u2500 zephyr                       (Not exported to CMake)\n\n<projects>/zephyr-workspace-2\n\u2514\u2500\u2500 zephyr                       (Exported to CMake)\n\n<home>/app\n\u251c\u2500\u2500 CMakeLists.txt\n\u251c\u2500\u2500 prj.conf\n\u2514\u2500\u2500 src\n    \u2514\u2500\u2500 main.c\n")),(0,p.kt)("p",null,"in this example, only ",(0,p.kt)("inlineCode",{parentName:"p"},"<projects>/zephyr-workspace-2/zephyr")," is exported to the CMake package registry and therefore this Zephyr will be used by the Zephyr freestanding application ",(0,p.kt)("inlineCode",{parentName:"p"},"<home>/app"),"."),(0,p.kt)("p",null,"If user wants to test the application with ",(0,p.kt)("inlineCode",{parentName:"p"},"<projects>/zephyr-workspace-1/zephyr"),", this can be done by using the Zephyr Base environment setting, meaning set ",(0,p.kt)("inlineCode",{parentName:"p"},"ZEPHYR_BASE=<projects>/zephyr-workspace-1/zephyr"),", before running CMake."),(0,p.kt)("ul",null,(0,p.kt)("li",{parentName:"ul"},"Zephyr \u96c6\u6210\u5f0f\u5e94\u7528\u5c06\u4f7f\u7528 CMake \u7528\u6237\u5305\u6ce8\u518c\u8868\u4e2d\u7684 Zephyr\u3002\u4f8b\u5982:")),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre"},"<projects>/zephyr-workspace-1\n\u2514\u2500\u2500 zephyr                       (Not exported to CMake)\n\n<projects>/zephyr-workspace-2\n\u2514\u2500\u2500 zephyr                       (Exported to CMake)\n\n<home>/app\n\u251c\u2500\u2500 CMakeLists.txt\n\u251c\u2500\u2500 prj.conf\n\u2514\u2500\u2500 src\n    \u2514\u2500\u2500 main.c\n")),(0,p.kt)("p",null,"\u8be5\u793a\u4f8b\u4e2d\uff0c\u53ea\u6709 ",(0,p.kt)("inlineCode",{parentName:"p"},"<projects>/zephyr-workspace-2/zephyr")," \u88ab\u5bfc\u51fa\u5230 CMake \u7528\u6237\u5305\u6ce8\u518c\u8868\u4e2d\uff0c\u56e0\u6b64\u8be5 Zephyr \u5c06\u7528\u4e8e ",(0,p.kt)("inlineCode",{parentName:"p"},"<home>/app")," \u7684 Zephyr \u96c6\u6210\u5f0f\u5e94\u7528\u3002"),(0,p.kt)("p",null,"\u5982\u679c\u7528\u6237\u60f3\u7528 ",(0,p.kt)("inlineCode",{parentName:"p"},"<projects>/zephyr-workspace-1/zephyr")," \u6765\u6d4b\u8bd5\u5e94\u7528\uff0c\u5728\u8fd0\u884c CMake \u4e4b\u524d\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7 ",(0,p.kt)("inlineCode",{parentName:"p"},"ZEPHYR_BASE=<projects>/zephyr-workspace-1/zephyr")," \u6765\u8bbe\u7f6e Zephyr Base \u73af\u5883\u53d8\u91cf\u3002"),(0,p.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,p.kt)("div",{parentName:"div",className:"admonition-heading"},(0,p.kt)("h5",{parentName:"div"},(0,p.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,p.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,p.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,p.kt)("div",{parentName:"div",className:"admonition-content"},(0,p.kt)("p",{parentName:"div"},"The Zephyr package selected on the first CMake invocation will be used for all subsequent builds. To change the Zephyr package, for example to test the application using Zephyr base environment setting, then it is necessary to do a pristine build first (See ",(0,p.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/develop/application/index.html#application-rebuild"},"Rebuilding an Application"),")."),(0,p.kt)("p",{parentName:"div"},"\u5728\u7b2c\u4e00\u6b21 CMake \u8fd0\u884c\u4e2d\u9009\u62e9\u7684 Zephyr \u5305\u5c06\u7528\u4e8e\u6240\u6709\u540e\u7eed\u6784\u5efa\u3002\u8981\u66f4\u6539 Zephyr \u5305\uff0c\u4f8b\u5982\u4f7f\u7528 Zephyr base \u73af\u5883\u8bbe\u7f6e\u6d4b\u8bd5\u5e94\u7528\uff0c\u5219\u9700\u8981\u5148\u8fdb\u884c\u539f\u59cb\u6784\u5efa\uff08\u8bf7\u53c2\u9605",(0,p.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/develop/application/index.html#application-rebuild"},"Rebuilding an Application"),"\uff09\u3002"))),(0,p.kt)("h2",{id:"zephyr-cmake-package-version"},"Zephyr CMake Package Version\xb6"),(0,p.kt)("h2",{id:"zephyr-cmake-\u5305\u7248\u672c"},"Zephyr CMake \u5305\u7248\u672c"),(0,p.kt)("p",null,"When writing an application then it is possible to specify a Zephyr version number ",(0,p.kt)("inlineCode",{parentName:"p"},"x.y.z")," that must be used in order to build the application."),(0,p.kt)("p",null,"Specifying a version is especially useful for a Zephyr freestanding application as it ensures the application is built with a minimal Zephyr version."),(0,p.kt)("p",null,"It also helps CMake to select the correct Zephyr to use for building, when there are multiple Zephyr installations in the system."),(0,p.kt)("p",null,"\u5728\u7f16\u5199\u5e94\u7528\u7a0b\u5e8f\u65f6\uff0c\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a ",(0,p.kt)("inlineCode",{parentName:"p"},"x.y.z")," \u7684\u7248\u672c\uff0c\u5728\u6307\u5b9a\u7248\u672c\u540e\uff0c\u5fc5\u987b\u7528\u8be5\u7248\u672c\u8fdb\u884c\u7f16\u8bd1\u3002"),(0,p.kt)("p",null,"\u6307\u5b9a\u7248\u672c\u53f7\u5bf9\u4e8e Zephyr \u72ec\u7acb\u5f0f\u5e94\u7528\u7279\u522b\u6709\u7528\uff0c\u56e0\u4e3a\u5b83\u786e\u4fdd\u5e94\u7528\u7a0b\u5e8f\u4f7f\u7528\u6700\u5c0f\u7684 Zephyr \u7248\u672c\u6784\u5efa\u7684\u3002"),(0,p.kt)("p",null,"\u5f53\u7cfb\u7edf\u4e2d\u6709\u591a\u4e2a Zephyr \u65f6\uff0c\u5b83\u8fd8\u6709\u52a9\u4e8e CMake \u9009\u62e9\u6b63\u786e\u7684 Zephyr \u7528\u4e8e\u6784\u5efa\u3002"),(0,p.kt)("p",null,"For example:"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-cmake"},"find_package(Zephyr 2.2.0)\nproject(app)\n")),(0,p.kt)("p",null,"\u4f8b\u5982:"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-cmake"},"find_package(Zephyr 2.2.0)\nproject(app)\n")),(0,p.kt)("p",null,"will require ",(0,p.kt)("inlineCode",{parentName:"p"},"app")," to be built with Zephyr 2.2.0 as minimum. CMake will search all exported candidates to find a Zephyr installation which matches this version criteria."),(0,p.kt)("p",null,"Thus it is possible to have multiple Zephyr installations and have CMake automatically select between them based on the version number provided, see ",(0,p.kt)("a",{parentName:"p",href:"https://cmake.org/cmake/help/latest/command/find_package.html#version-selection"},"CMake package version")," for details."),(0,p.kt)("p",null,"\u8fd9\u6837\u81f3\u5c11\u9700\u8981 ",(0,p.kt)("inlineCode",{parentName:"p"},"app")," \u4f7f\u7528 Zephyr 2.2.0 \u6784\u5efa\u3002CMake \u5c06\u641c\u7d22\u6240\u6709\u5bfc\u51fa\u7684\u7248\u672c\uff0c\u4ee5\u627e\u5230\u7b26\u5408\u6b64\u7248\u672c Zephyr SDK\u3002"),(0,p.kt)("p",null,"\u56e0\u6b64\uff0c\u53ef\u4ee5\u6709\u591a\u4e2a Zephyr\uff0c\u5e76\u8ba9 CMake \u6839\u636e\u63d0\u4f9b\u7684\u7248\u672c\u53f7\u5728\u5b83\u4eec\u4e4b\u95f4\u81ea\u52a8\u9009\u62e9\uff0c\u6709\u5173\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605",(0,p.kt)("a",{parentName:"p",href:"https://cmake.org/cmake/help/latest/command/find_package.html#version-selection"},"CMake \u5305\u7248\u672c"),"\u3002"),(0,p.kt)("p",null,"For example:"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre"},"<projects>/zephyr-workspace-2.a\n\u2514\u2500\u2500 zephyr                       (Exported to CMake)\n\n<projects>/zephyr-workspace-2.b\n\u2514\u2500\u2500 zephyr                       (Exported to CMake)\n\n<home>/app\n\u251c\u2500\u2500 CMakeLists.txt\n\u251c\u2500\u2500 prj.conf\n\u2514\u2500\u2500 src\n    \u2514\u2500\u2500 main.c\n")),(0,p.kt)("p",null,"in this case, there are two released versions of Zephyr installed at their own workspaces. Workspace 2.a and 2.b, corresponding to the Zephyr version."),(0,p.kt)("p",null,"\u4f8b\u5982\uff1a"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre"},"<projects>/zephyr-workspace-2.a\n\u2514\u2500\u2500 zephyr                       (Exported to CMake)\n\n<projects>/zephyr-workspace-2.b\n\u2514\u2500\u2500 zephyr                       (Exported to CMake)\n\n<home>/app\n\u251c\u2500\u2500 CMakeLists.txt\n\u251c\u2500\u2500 prj.conf\n\u2514\u2500\u2500 src\n    \u2514\u2500\u2500 main.c\n")),(0,p.kt)("p",null,"\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6709\u4e24\u4e2a\u53d1\u5e03\u7248\u672c\u7684 Zephyr SDK \u5df2\u7ecf\u5b89\u88c5\u5728\u81ea\u5df1\u7684\u7535\u8111\u4e0a\u3002zephyr-workspace 2.a \u548c 2.b\uff0c\u5bf9\u5e94\u4e8e Zephyr \u7248\u672c\u3002"),(0,p.kt)("p",null,"To ensure ",(0,p.kt)("inlineCode",{parentName:"p"},"app")," is built with minimum version ",(0,p.kt)("inlineCode",{parentName:"p"},"2.a")," the following ",(0,p.kt)("inlineCode",{parentName:"p"},"find_package")," syntax may be used:"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-cmake"},"find_package(Zephyr 2.a)\nproject(app)\n")),(0,p.kt)("p",null,"Note that both ",(0,p.kt)("inlineCode",{parentName:"p"},"2.a")," and ",(0,p.kt)("inlineCode",{parentName:"p"},"2.b")," fulfill this requirement."),(0,p.kt)("p",null,"\u4e3a\u4e86\u786e\u4fdd ",(0,p.kt)("inlineCode",{parentName:"p"},"app")," \u4f7f\u7528\u6700\u5c0f\u7248\u672c 2.a \u6784\u5efa\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b ",(0,p.kt)("inlineCode",{parentName:"p"},"find_package")," \u8bed\u6cd5:"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-cmake"},"find_package(Zephyr 2.a)\nproject(app)\n")),(0,p.kt)("p",null,(0,p.kt)("strong",{parentName:"p"},"\u8bf7\u6ce8\u610f")," ",(0,p.kt)("inlineCode",{parentName:"p"},"2.a")," \u548c ",(0,p.kt)("inlineCode",{parentName:"p"},"2.b")," \u7248\u672c\u90fd\u6ee1\u8db3\u6b64\u8981\u6c42\u3002"),(0,p.kt)("p",null,"CMake also supports the keyword ",(0,p.kt)("inlineCode",{parentName:"p"},"EXACT"),", to ensure an exact version is used, if that is required. In this case, the application CMakeLists.txt could be written as:"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-cmake"},"find_package(Zephyr 2.a EXACT)\nproject(app)\n")),(0,p.kt)("p",null,"CMake \u8fd8\u652f\u6301\u5173\u952e\u5b57 ",(0,p.kt)("inlineCode",{parentName:"p"},"EXACT"),"\uff0c\u5982\u679c\u9700\u8981\u7cbe\u786e\u7684\u7248\u672c\uff0c\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u5173\u952e\u5b57\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5e94\u7528 CMakeLists.txt \u53ef\u4ee5\u5199\u6210:"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-cmake"},"find_package(Zephyr 2.a EXACT)\nproject(app)\n")),(0,p.kt)("p",null,"In case no Zephyr is found which satisfies the version required, as example, the application specifies"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-cmake"},"find_package(Zephyr 2.z)\nproject(app)\n")),(0,p.kt)("p",null,"\u5982\u679c\u6ca1\u627e\u5230\u6ee1\u8db3\u6240\u9700\u7248\u672c\u7684 Zephyr\uff0c\u4f8b\u5982\uff1a"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-cmake"},"find_package(Zephyr 2.z)\nproject(app)\n")),(0,p.kt)("p",null,"then an error similar to below will be printed:"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre"},'Could not find a configuration file for package "Zephyr" that is compatible\nwith requested version "2.z".\n\nThe following configuration files were considered but not accepted:\n\n  <projects>/zephyr-workspace-2.a/zephyr/share/zephyr-package/cmake/ZephyrConfig.cmake, version: 2.a.0\n  <projects>/zephyr-workspace-2.b/zephyr/share/zephyr-package/cmake/ZephyrConfig.cmake, version: 2.b.0\n')),(0,p.kt)("p",null,"\u7136\u540e\u5c06\u4f1a\u6253\u5370\u7c7b\u4f3c\u4ee5\u4e0b\u7684\u9519\u8bef\uff1a"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre"},'Could not find a configuration file for package "Zephyr" that is compatible\nwith requested version "2.z".\n\nThe following configuration files were considered but not accepted:\n\n  <projects>/zephyr-workspace-2.a/zephyr/share/zephyr-package/cmake/ZephyrConfig.cmake, version: 2.a.0\n  <projects>/zephyr-workspace-2.b/zephyr/share/zephyr-package/cmake/ZephyrConfig.cmake, version: 2.b.0\n')),(0,p.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,p.kt)("div",{parentName:"div",className:"admonition-heading"},(0,p.kt)("h5",{parentName:"div"},(0,p.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,p.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,p.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,p.kt)("div",{parentName:"div",className:"admonition-content"},(0,p.kt)("p",{parentName:"div"},"It can also be beneficial to specify a version number for Zephyr repository applications and Zephyr workspace applications. Specifying a version in those cases ensures the application will only build if the Zephyr repository or workspace is matching. This can be useful to avoid accidental builds when only part of a workspace has been updated."),(0,p.kt)("p",{parentName:"div"},"\u4e3a Zephyr \u96c6\u6210\u5f0f\u5e94\u7528\u6307\u5b9a\u7248\u672c\u53f7\u4e5f\u662f\u6709\u597d\u5904\u7684\uff0c\u6307\u5b9a\u7248\u672c\u53f7\u53ef\u786e\u4fdd\u5e94\u7528\u4ec5\u5728 Zephyr \u96c6\u6210\u5f0f\u5e94\u7528\u5339\u914d\u65f6\u624d\u4f1a\u6784\u5efa\u3002\u5f53\u66f4\u65b0\u4e86\u90e8\u5206 Zephyr SDK \u7684\u4ee3\u7801\u65f6\uff0c\u8fd9\u80fd\u6709\u6548\u7684\u907f\u514d\u51fa\u73b0\u610f\u5916\u7684\u6784\u5efa\u3002"))),(0,p.kt)("h2",{id:"multiple-zephyr-installations-zephyr-workspace"},"Multiple Zephyr Installations (Zephyr workspace)"),(0,p.kt)("h2",{id:"\u591a\u4e2a-zephyr"},"\u591a\u4e2a Zephyr"),(0,p.kt)("p",null,"Testing out a new Zephyr version, while at the same time keeping the existing Zephyr in the workspace untouched is sometimes beneficial."),(0,p.kt)("p",null,"Or having both an upstream Zephyr, Vendor specific, and a custom Zephyr in same workspace."),(0,p.kt)("p",null,"For example:"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre"},"<projects>/zephyr-workspace\n\u251c\u2500\u2500 zephyr\n\u251c\u2500\u2500 zephyr-vendor\n\u251c\u2500\u2500 zephyr-custom\n\u251c\u2500\u2500 ...\n\u2514\u2500\u2500 my_applications\n     \u2514\u2500\u2500 my_first_app\n")),(0,p.kt)("p",null,"\u6d4b\u8bd5\u65b0\u7684 Zephyr \u7248\u672c\uff0c\u540c\u65f6\u4fdd\u6301\u5df2\u7ecf\u73b0\u6709\u7684 Zephyr \u4e0d\u53d8\u662f\u6709\u597d\u5904\u7684\u3002"),(0,p.kt)("p",null,"\u6216\u8005\u5728\u7535\u8111\u4e0a\u540c\u65f6\u62e5\u6709\u6700\u65b0\u7684 Zephyr\uff0c\u4f9b\u5e94\u5546\u7279\u5b9a\u548c\u81ea\u5b9a\u4e49\u7684 Zephyr\u3002"),(0,p.kt)("p",null,"\u4f8b\u5982\uff1a"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre"},"<projects>/zephyr-workspace\n\u251c\u2500\u2500 zephyr\n\u251c\u2500\u2500 zephyr-vendor\n\u251c\u2500\u2500 zephyr-custom\n\u251c\u2500\u2500 ...\n\u2514\u2500\u2500 my_applications\n     \u2514\u2500\u2500 my_first_app\n")),(0,p.kt)("p",null,"in this setup, ",(0,p.kt)("inlineCode",{parentName:"p"},"find_package(Zephyr)")," has the following order of precedence for selecting which Zephyr to use:"),(0,p.kt)("ul",null,(0,p.kt)("li",{parentName:"ul"},"Project name: ",(0,p.kt)("inlineCode",{parentName:"li"},"zephyr")),(0,p.kt)("li",{parentName:"ul"},"First project, when Zephyr projects are ordered lexicographical, in this case.",(0,p.kt)("ul",{parentName:"li"},(0,p.kt)("li",{parentName:"ul"},(0,p.kt)("inlineCode",{parentName:"li"},"zephyr-custom")),(0,p.kt)("li",{parentName:"ul"},(0,p.kt)("inlineCode",{parentName:"li"},"zephyr-vendor"))))),(0,p.kt)("p",null,"This means that ",(0,p.kt)("inlineCode",{parentName:"p"},"my_first_app")," will use ",(0,p.kt)("inlineCode",{parentName:"p"},"<projects>/zephyr-workspace/zephyr"),"."),(0,p.kt)("p",null,"It is possible to specify a Zephyr preference list in the application."),(0,p.kt)("p",null,"\u5728\u6b64\u8bbe\u7f6e\u4e2d\uff0c",(0,p.kt)("inlineCode",{parentName:"p"},"find_package(Zephyr)")," \u9009\u62e9\u54ea\u4e2a Zephyr \u5177\u6709\u4e00\u4e0b\u4f18\u5148\u987a\u5e8f\uff1a"),(0,p.kt)("ul",null,(0,p.kt)("li",{parentName:"ul"},"\u9879\u76ee\u540d\u79f0\uff1a",(0,p.kt)("inlineCode",{parentName:"li"},"zephyr")),(0,p.kt)("li",{parentName:"ul"},"\u5f53 Zephyr \u9879\u76ee\u6309\u5b57\u6bcd\u987a\u5e8f\u6392\u5217\u65f6\uff1a",(0,p.kt)("ul",{parentName:"li"},(0,p.kt)("li",{parentName:"ul"},(0,p.kt)("inlineCode",{parentName:"li"},"zephyr-custom")),(0,p.kt)("li",{parentName:"ul"},(0,p.kt)("inlineCode",{parentName:"li"},"zephyr-vendor"))))),(0,p.kt)("p",null,"\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c ",(0,p.kt)("inlineCode",{parentName:"p"},"my_first_app")," \u5c06\u4f7f\u7528 ",(0,p.kt)("inlineCode",{parentName:"p"},"<projects>/zephyr-workspace/zephyr"),"\u3002"),(0,p.kt)("p",null,"\u53ef\u4ee5\u5728\u5e94\u7528\u4e2d\u6307\u5b9a Zephyr \u504f\u597d\u5217\u8868\u3002"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-cmake"},'set(ZEPHYR_PREFER "zephyr-custom" "zephyr-vendor")\nfind_package(Zephyr)\n\nproject(my_first_app)\n')),(0,p.kt)("p",null,"the ",(0,p.kt)("inlineCode",{parentName:"p"},"ZEPHYR_PREFER")," is a list, allowing for multiple Zephyrs. If a Zephyr is specified in the list, but not found in the system, it is simply ignored and ",(0,p.kt)("inlineCode",{parentName:"p"},"find_package(Zephyr)")," will continue to the next candidate."),(0,p.kt)("p",null,(0,p.kt)("inlineCode",{parentName:"p"},"ZEPHYR_PREFER")," \u662f\u4e00\u4e2a\u5217\u8868\uff0c\u5141\u8bb8\u6709\u591a\u4e2a Zephyr\u3002\u5982\u679c\u5217\u8868\u4e2d\u6307\u5b9a\u4e86 Zephyr\uff0c\u4f46\u5728\u7cfb\u7edf\u4e2d\u672a\u627e\u5230\uff0c\u5219\u5ffd\u7565\u8be5 Zephyr\uff0c\u5e76\u4e14 ",(0,p.kt)("inlineCode",{parentName:"p"},"find_package(Zephyr)")," \u4f1a\u7ee7\u7eed\u67e5\u627e\u4e0b\u4e00\u4e2a\u3002 "),(0,p.kt)("p",null,"This allows for temporary creation of a new Zephyr release to be tested, without touching current Zephyr. When testing is done, the ",(0,p.kt)("inlineCode",{parentName:"p"},"zephyr-test")," folder can simply be removed. Such a CMakeLists.txt could look as:"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-cmake"},'set(ZEPHYR_PREFER "zephyr-test")\nfind_package(Zephyr)\n\nproject(my_first_app)\n')),(0,p.kt)("p",null,"\u8fd9\u5141\u8bb8\u4e34\u65f6\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 Zephyr \u7248\u672c\u8fdb\u884c\u6d4b\u8bd5\uff0c\u800c\u4e0d\u9700\u8981\u4fee\u6539\u5f53\u524d Zephyr\u3002\u5f53\u6d4b\u8bd5\u5b8c\u6210\u540e\uff0c\u53ef\u4ee5\u7b80\u5355\u5730\u5220\u9664 ",(0,p.kt)("inlineCode",{parentName:"p"},"zephyr-test")," \u76ee\u5f55\uff0c\u90a3\u4e48 CMakeLists.txt \u5982\u4e0b\uff1a"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-cmake"},'set(ZEPHYR_PREFER "zephyr-test")\nfind_package(Zephyr)\n\nproject(my_first_app)\n')),(0,p.kt)("h2",{id:"zephyr-build-configuration-cmake-package-freestanding-application"},"Zephyr Build Configuration CMake package (Freestanding application)"),(0,p.kt)("h2",{id:"zephyr-\u6784\u5efa\u914d\u7f6e-cmake-\u5305\u72ec\u7acb\u5e94\u7528"},"Zephyr \u6784\u5efa\u914d\u7f6e CMake \u5305(\u72ec\u7acb\u5e94\u7528)"),(0,p.kt)("p",null,"The Zephyr Build Configuration CMake package can be located outside a Zephyr workspace, for example located with a ",(0,p.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/develop/application/index.html#zephyr-freestanding-app"},"Zephyr freestanding application"),"."),(0,p.kt)("p",null,"Zephyr \u6784\u5efa\u914d\u7f6e CMake \u5305\u53ef\u4ee5\u4f4d\u4e8e Zephyr SDK \u4e4b\u5916\uff0c\u4f8b\u5982\u4f4d\u4e8e Zephyr ",(0,p.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/develop/application/index.html#zephyr-freestanding-app"},"\u72ec\u7acb\u5e94\u7528"),"\u4e2d\u3002"),(0,p.kt)("p",null,"Create the build configuration as described in the previous section, and then refer to the location of your Zephyr Build Configuration CMake package using the CMake variable ",(0,p.kt)("inlineCode",{parentName:"p"},"ZephyrBuildConfiguration_ROOT"),"."),(0,p.kt)("p",null,"\u5982\u4e0a\u4e00\u8282\u6240\u8ff0\u7684\u521b\u5efa\u6784\u5efa\u914d\u7f6e\uff0c\u7136\u540e\u4f7f\u7528 CMake \u53d8\u91cf ",(0,p.kt)("inlineCode",{parentName:"p"},"ZephyrBuildConfiguration_ROOT")," \u5f15\u7528\u4f60\u7684 Zephyr \u6784\u5efa\u914d\u7f6e CMake \u5305\u7684\u4f4d\u7f6e\u3002"),(0,p.kt)("p",null,"1.At the CMake command line, like this:"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-bash"},"cmake -DZephyrBuildConfiguration_ROOT=<path-to-build-config> ...\n")),(0,p.kt)("p",null,"1.\u5728 CMake \u547d\u4ee4\u884c\u4e2d\uff0c\u5982\u4e0b\u6240\u793a\uff1a"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-bash"},"cmake -DZephyrBuildConfiguration_ROOT=<path-to-build-config> ...\n")),(0,p.kt)("p",null,"2.At the top of your application\u2019s top level ",(0,p.kt)("inlineCode",{parentName:"p"},"CMakeLists.txt"),", like this:"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-cmake"},"set(ZephyrBuildConfiguration_ROOT <path-to-build-config>)\nfind_package(Zephyr REQUIRED HINTS $ENV{ZEPHYR_BASE})\n")),(0,p.kt)("p",null,"If you choose this option, make sure to set the variable ",(0,p.kt)("strong",{parentName:"p"},"before")," calling ",(0,p.kt)("inlineCode",{parentName:"p"},"find_package(Zephyr ...)"),", as shown above."),(0,p.kt)("p",null,"2.\u5728\u4f60\u7684\u5e94\u7528\u9879\u76ee\u7684\u6839\u76ee\u5f55 ",(0,p.kt)("inlineCode",{parentName:"p"},"CMakeLists.txt")," \u4e2d\uff0c\u5982\u4e0b\u6240\u793a\uff1a"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-cmake"},"set(ZephyrBuildConfiguration_ROOT <path-to-build-config>)\nfind_package(Zephyr REQUIRED HINTS $ENV{ZEPHYR_BASE})\n")),(0,p.kt)("p",null,"\u5982\u679c\u9009\u62e9\u4e86\u6b64\u9009\u9879\uff0c\u8bf7\u786e\u4fdd\u5728\u8c03\u7528 ",(0,p.kt)("inlineCode",{parentName:"p"},"find_package(Zephyr ...)")," \u4e4b\u524d\u8bbe\u7f6e\u53d8\u91cf\uff0c\u5982\u4e0a\u6240\u793a\u3002"),(0,p.kt)("p",null,"3.In a separate CMake script which is pre-loaded to populate the CMake cache, like this:"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-cmake"},'# Put this in a file with a name like "zephyr-settings.cmake"\nset(ZephyrBuildConfiguration_ROOT <path-to-build-config>\n    CACHE STRING "pre-cached build config"\n)\n')),(0,p.kt)("p",null,"3.\u5728\u9884\u5148\u52a0\u8f7d\u4ee5\u586b\u5145 CMake \u7f13\u5b58\u7684\u5355\u72ec CMake \u811a\u672c\u4e2d\uff0c\u5982\u4e0b\u6240\u793a\uff1a"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-cmake"},'# \u5c06\u6b64\u6587\u4ef6\u653e\u5728\u4e00\u4e2a\u540d\u4e3a "zephyr-settings.cmake" \u7684\u6587\u4ef6\u4e2d\nset(ZephyrBuildConfiguration_ROOT <path-to-build-config>\n    CACHE STRING "pre-cached build config"\n)\n')),(0,p.kt)("p",null,"You can tell the build system to use this file by adding ",(0,p.kt)("inlineCode",{parentName:"p"},"-C zephyr-settings.cmake")," to your CMake command line. This principle is useful when not using west as both this setting and Zephyr modules can be specified using the same file. See ",(0,p.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/develop/modules.html#modules-without-west"},"Zephyr module Without West"),"."),(0,p.kt)("p",null,"\u4f60\u53ef\u4ee5\u901a\u8fc7\u6dfb\u52a0 ",(0,p.kt)("inlineCode",{parentName:"p"},"-C zephyr-settings.cmake")," \u5230 CMake \u547d\u4ee4\u6765\u544a\u8bc9\u6784\u5efa\u7cfb\u7edf\u4f7f\u7528\u6b64\u6587\u4ef6\u3002\n\u6b64\u539f\u5219\u5728\u4e0d\u4f7f\u7528 ",(0,p.kt)("inlineCode",{parentName:"p"},"Lisa Zephyr"),"\u63d2\u4ef6\u65f6\u5f88\u6709\u7528\uff0c\u56e0\u4e3a\u53ef\u4ee5\u4f7f\u7528\u540c\u4e00\u4e2a\u6587\u4ef6\u6307\u5b9a\u6b64\u8bbe\u7f6e\u548c Zephyr \u6a21\u5757\u3002\u8bf7\u53c2\u9605\u6ca1\u6709 ",(0,p.kt)("inlineCode",{parentName:"p"},"Lisa Zephyr")," \u63d2\u4ef6\u7684 ",(0,p.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/develop/modules.html#modules-without-west"},"Zephyr \u6a21\u5757"),"\u3002"),(0,p.kt)("h2",{id:"zephyr-cmake-package-source-code"},"Zephyr CMake package source code"),(0,p.kt)("h2",{id:"zephyr-cmake-\u5305\u6e90\u4ee3\u7801"},"Zephyr CMake \u5305\u6e90\u4ee3\u7801"),(0,p.kt)("p",null,"The Zephyr CMake package source code in ",(0,p.kt)("inlineCode",{parentName:"p"},"<PATH-TO-ZEPHYR>/share/zephyr-package/cmake")," contains the CMake config package which is used by CMake ",(0,p.kt)("inlineCode",{parentName:"p"},"find_package")," function."),(0,p.kt)("p",null,(0,p.kt)("inlineCode",{parentName:"p"},"<PATH-TO-ZEPHYR>/share/Zephyr-package/CMake")," \u4e2d\u7684 Zephyr CMake \u5305\u6e90\u4ee3\u7801\u5305\u542b CMake ",(0,p.kt)("inlineCode",{parentName:"p"},"find_package")," \u51fd\u6570\u4f7f\u7528\u7684 CMake \u914d\u7f6e\u5305\u3002"),(0,p.kt)("p",null,"It also contains code for exporting Zephyr as a CMake config package."),(0,p.kt)("p",null,"\u5b83\u8fd8\u5305\u542b\u5c06 Zephyr \u5bfc\u51fa\u4e3a CMake \u914d\u7f6e\u5305\u7684\u4ee3\u7801\u3002"),(0,p.kt)("p",null,"The following is an overview of those files"),(0,p.kt)("p",null,"\u4ee5\u4e0b\u662f\u8fd9\u4e9b\u6587\u4ef6\u7684\u63cf\u8ff0"),(0,p.kt)("p",null,(0,p.kt)("inlineCode",{parentName:"p"},"CMakeLists.txt")),(0,p.kt)("ul",null,(0,p.kt)("li",{parentName:"ul"},(0,p.kt)("p",{parentName:"li"},"The CMakeLists.txt file for the CMake build system which is responsible for exporting Zephyr as a package to the CMake user package registry. ")),(0,p.kt)("li",{parentName:"ul"},(0,p.kt)("p",{parentName:"li"},"CMake \u6784\u5efa\u7cfb\u7edf\u7684 CMakeLists.txt \u6587\u4ef6\uff0c\u8d1f\u8d23\u5c06 Zephyr \u4f5c\u4e3a\u5305\u5bfc\u51fa\u5230 CMake \u7528\u6237\u5305\u6ce8\u518c\u8868\u3002"))),(0,p.kt)("p",null,(0,p.kt)("inlineCode",{parentName:"p"},"ZephyrConfigVersion.cmake")),(0,p.kt)("ul",null,(0,p.kt)("li",{parentName:"ul"},(0,p.kt)("p",{parentName:"li"},"The Zephyr package version file. This file is called by CMake to determine if this installation fulfils the requirements specified by user when calling ",(0,p.kt)("inlineCode",{parentName:"p"},"find_package(Zephyr ...)"),". It is also responsible for detection of Zephyr repository or workspace only installations.")),(0,p.kt)("li",{parentName:"ul"},(0,p.kt)("p",{parentName:"li"},"Zephyr \u5305\u7248\u672c\u6587\u4ef6\u3002\u8fd9\u4e2a\u6587\u4ef6\u88ab CMake \u8c03\u7528\u6765\u786e\u5b9a\u8fd9\u4e2a\u5b89\u88c5\u662f\u5426\u6ee1\u8db3\u7528\u6237\u5728\u8c03\u7528 ",(0,p.kt)("inlineCode",{parentName:"p"},"find_package(Zephyr ...)")," \u65f6\u6307\u5b9a\u7684\u8981\u6c42\u3002\u5b83\u4e5f\u8d1f\u8d23\u68c0\u6d4b Zephyr \u5e93\u6216 Zephyr SDK \u53ea\u5b89\u88c5\u3002"))),(0,p.kt)("p",null,(0,p.kt)("inlineCode",{parentName:"p"},"ZephyrUnittestConfigVersion.cmake")),(0,p.kt)("ul",null,(0,p.kt)("li",{parentName:"ul"},(0,p.kt)("p",{parentName:"li"},"Same responsibility as ",(0,p.kt)("inlineCode",{parentName:"p"},"ZephyrConfigVersion.cmake"),", but for unit tests. Includes ",(0,p.kt)("inlineCode",{parentName:"p"},"ZephyrConfigVersion.cmake"),".")),(0,p.kt)("li",{parentName:"ul"},(0,p.kt)("p",{parentName:"li"},"\u4e0e ",(0,p.kt)("inlineCode",{parentName:"p"},"ZephyrConfigVersion.cmake")," \u76f8\u540c\uff0c\u4f46\u662f\u7528\u4e8e\u5355\u5143\u6d4b\u8bd5\u3002\u5305\u542b ",(0,p.kt)("inlineCode",{parentName:"p"},"ZephyrConfigVersion.cmake"),"\u3002"))),(0,p.kt)("p",null,(0,p.kt)("inlineCode",{parentName:"p"},"ZephyrConfig.cmake")),(0,p.kt)("ul",null,(0,p.kt)("li",{parentName:"ul"},(0,p.kt)("p",{parentName:"li"},"The Zephyr package file. This file is called by CMake to for the package meeting which fulfils the requirements specified by user when calling ",(0,p.kt)("inlineCode",{parentName:"p"},"find_package(Zephyr ...)"),". This file is responsible for sourcing of boilerplate code.")),(0,p.kt)("li",{parentName:"ul"},(0,p.kt)("p",{parentName:"li"},"Zephyr \u5305\u6587\u4ef6\u3002\u8fd9\u4e2a\u6587\u4ef6\u88ab CMake \u8c03\u7528\u6765\u786e\u5b9a\u8fd9\u4e2a\u5b89\u88c5\u662f\u5426\u6ee1\u8db3\u7528\u6237\u5728\u8c03\u7528 ",(0,p.kt)("inlineCode",{parentName:"p"},"find_package(Zephyr ...)")," \u65f6\u6307\u5b9a\u7684\u8981\u6c42\u3002\u8fd9\u4e2a\u6587\u4ef6\u8d1f\u8d23\u83b7\u53d6\u6837\u677f\u4ee3\u7801\u3002"))),(0,p.kt)("p",null,(0,p.kt)("inlineCode",{parentName:"p"},"ZephyrUnittestConfig.cmake")),(0,p.kt)("ul",null,(0,p.kt)("li",{parentName:"ul"},(0,p.kt)("p",{parentName:"li"},"Same responsibility as ",(0,p.kt)("inlineCode",{parentName:"p"},"ZephyrConfig.cmake"),", but for unit tests. Includes ",(0,p.kt)("inlineCode",{parentName:"p"},"ZephyrConfig.cmake"),".")),(0,p.kt)("li",{parentName:"ul"},(0,p.kt)("p",{parentName:"li"},"\u4e0e ",(0,p.kt)("inlineCode",{parentName:"p"},"ZephyrConfig.cmake")," \u76f8\u540c\uff0c\u4f46\u662f\u7528\u4e8e\u5355\u5143\u6d4b\u8bd5\u3002\u5305\u542b ",(0,p.kt)("inlineCode",{parentName:"p"},"ZephyrConfig.cmake"),"\u3002"))),(0,p.kt)("p",null,(0,p.kt)("inlineCode",{parentName:"p"},"zephyr_package_search.cmake")),(0,p.kt)("ul",null,(0,p.kt)("li",{parentName:"ul"},(0,p.kt)("p",{parentName:"li"},"Common file used for detection of Zephyr repository and workspace candidates. Used by ",(0,p.kt)("inlineCode",{parentName:"p"},"ZephyrConfigVersion.cmake")," and ",(0,p.kt)("inlineCode",{parentName:"p"},"ZephyrConfig.cmake")," for common code.")),(0,p.kt)("li",{parentName:"ul"},(0,p.kt)("p",{parentName:"li"},"\u7528\u4e8e\u68c0\u6d4b Zephyr SDK \u4e0b\u7b26\u5408\u8981\u6c42\u7684 CMake \u5305\u7684\u901a\u7528\u6587\u4ef6\u3002\u7531 ",(0,p.kt)("inlineCode",{parentName:"p"},"ZephyrConfigVersion.cmake")," \u548c ",(0,p.kt)("inlineCode",{parentName:"p"},"ZephyrConfig.cmake")," \u7528\u4e8e\u516c\u5171\u4ee3\u7801\u3002"))),(0,p.kt)("p",null,(0,p.kt)("inlineCode",{parentName:"p"},"pristine.cmake")),(0,p.kt)("ul",null,(0,p.kt)("li",{parentName:"ul"},(0,p.kt)("p",{parentName:"li"},"Pristine file for removing all files created by CMake during configure and generator time when exporting Zephyr CMake package. Running pristine keeps all package related files mentioned above.")),(0,p.kt)("li",{parentName:"ul"},(0,p.kt)("p",{parentName:"li"},"\u5bfc\u51fa Zephyr CMake \u5305\u65f6\uff0c\u7528\u4e8e\u5220\u9664 CMake \u5728\u914d\u7f6e\u548c\u751f\u6210\u671f\u95f4\u521b\u5efa\u7684\u6240\u6709\u6587\u4ef6\u7684\u539f\u59cb\u6587\u4ef6\u3002\u8fd0\u884c pristine \u4f1a\u4fdd\u7559\u4e0a\u9762\u63d0\u5230\u7684\u6240\u6709\u4e0e\u5305\u76f8\u5173\u7684\u6587\u4ef6\u3002"))))}h.isMDXComponent=!0},86010:(e,a,t)=>{function n(e){var a,t,p="";if("string"==typeof e||"number"==typeof e)p+=e;else if("object"==typeof e)if(Array.isArray(e))for(a=0;a<e.length;a++)e[a]&&(t=n(e[a]))&&(p&&(p+=" "),p+=t);else for(a in e)e[a]&&(p&&(p+=" "),p+=a);return p}t.d(a,{Z:()=>p});const p=function(){for(var e,a,t=0,p="";t<arguments.length;)(e=arguments[t++])&&(a=n(e))&&(p&&(p+=" "),p+=a);return p}}}]);