(self.webpackChunkls_docs_web=self.webpackChunkls_docs_web||[]).push([[864],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return u},kt:function(){return m}});var o=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=o.createContext({}),s=function(e){var t=o.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=s(e.components);return o.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,p=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=s(n),m=a,h=d["".concat(p,".").concat(m)]||d[m]||c[m]||r;return n?o.createElement(h,i(i({ref:t},u),{},{components:n})):o.createElement(h,i({ref:t},u))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=d;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var s=2;s<r;s++)i[s]=n[s];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},34245:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return p},metadata:function(){return s},toc:function(){return u},default:function(){return d}});var o=n(22122),a=n(19756),r=(n(67294),n(3905)),i=["components"],l={},p="\u5f15\u5bfc\u7a0b\u5e8f & OTA",s={unversionedId:"chips/600X/old_doc/\u5e94\u7528\u5f00\u53d1/\u57fa\u7840/mcuboot",id:"chips/600X/old_doc/\u5e94\u7528\u5f00\u53d1/\u57fa\u7840/mcuboot",isDocsHomePage:!1,title:"\u5f15\u5bfc\u7a0b\u5e8f & OTA",description:"bootloader",source:"@site/docs/chips/600X/old_doc/\u5e94\u7528\u5f00\u53d1/\u57fa\u7840/mcuboot.md",sourceDirName:"chips/600X/old_doc/\u5e94\u7528\u5f00\u53d1/\u57fa\u7840",slug:"/chips/600X/old_doc/\u5e94\u7528\u5f00\u53d1/\u57fa\u7840/mcuboot",permalink:"/chips/600X/old_doc/\u5e94\u7528\u5f00\u53d1/\u57fa\u7840/mcuboot",version:"current",frontMatter:{}},u=[{value:"bootloader",id:"bootloader",children:[]},{value:"mcuboot",id:"mcuboot",children:[{value:"flash map",id:"flash-map",children:[]},{value:"\u751f\u6210mcuboot",id:"\u751f\u6210mcuboot",children:[]},{value:"\u751f\u6210App\u56fa\u4ef6",id:"\u751f\u6210app\u56fa\u4ef6",children:[]}]},{value:"DFU(Device Firmware Upgrade)",id:"dfudevice-firmware-upgrade",children:[]},{value:"Device Management",id:"device-management",children:[]},{value:"USB DFU",id:"usb-dfu",children:[]},{value:"mcuboot\u7684usb dfu\u7684\u5347\u7ea7",id:"mcuboot\u7684usb-dfu\u7684\u5347\u7ea7",children:[{value:"\u751f\u6210mcuboot",id:"\u751f\u6210mcuboot-1",children:[]},{value:"\u751f\u6210\u5347\u7ea7\u56fa\u4ef6",id:"\u751f\u6210\u5347\u7ea7\u56fa\u4ef6",children:[]},{value:"\u6d4b\u8bd5",id:"\u6d4b\u8bd5",children:[]}]}],c={toc:u};function d(e){var t=e.components,n=(0,a.Z)(e,i);return(0,r.kt)("wrapper",(0,o.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"\u5f15\u5bfc\u7a0b\u5e8f--ota"},"\u5f15\u5bfc\u7a0b\u5e8f & OTA"),(0,r.kt)("h2",{id:"bootloader"},"bootloader"),(0,r.kt)("p",null,"bootloader\u662f\u82af\u7247\u4e0a\u7535\u540e\u6267\u884c\u7684\u7b2c\u4e00\u6bb5\u4ee3\u7801\uff0c\u4e3b\u8981\u7528\u4e8e\u5f15\u5bfc\u548c\u5347\u7ea7\u5e94\u7528\u7a0b\u5e8f\u3002"),(0,r.kt)("h2",{id:"mcuboot"},"mcuboot"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.mcuboot.com/"},"mcuboot"),"\u662f\u5f00\u6e9032bit Mcu\nbootloader\uff0c\u76f4\u63a5\u517c\u5bb9\u4e8ezephyr\uff0c\u53ef\u4ee5\u7528\u6765\u52a0\u8f7dzephyr\u4ee3\u7801\u3002"),(0,r.kt)("p",null,"\u4e3a\u4e86\u5728Zephyr\u4e0a\u4f7f\u7528mcuboot\uff0c\u9700\u8981\u4f9d\u8d56\u76f8\u5173\u7684\u6761\u4ef6\u3002\u5177\u4f53\u8bf7\u53c2\u8003",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/guides/device_mgmt/dfu.html?highlight=mcuboot#mcuboot"},"Mcuboot"),"\u548c",(0,r.kt)("a",{parentName:"p",href:"https://www.mcuboot.com/documentation/readme-zephyr/"},"Building\nand using MCUboot with\nZephyr")),(0,r.kt)("h3",{id:"flash-map"},"flash map"),(0,r.kt)("p",null,"mcuboot\u901a\u8fc7\u5bf9flash\u5206\u533a\u8fdb\u884c\u64cd\u4f5c\u6765\u52a0\u8f7d\u548c\u5347\u7ea7Zephyr\u56fa\u4ef6\u3002",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/2.6.0/reference/storage/flash_map/flash_map.html#flash-map"},"flash\nmap"),"\u63d0\u4f9b\u4e86\u83b7\u53d6flash\u5206\u533a\u4fe1\u606f\u7684API\u3002flash\u5206\u533a\u4e0ezephyr\u7684\u8bbe\u5907\u6811\u76f8\u5173\uff0c\u4e3e\u4f8b\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-default"},'&flash0 {\n        /*\n         * For more information, see:\n         * http: //docs.zephyrproject.org/latest/guides/dts/index.html#flash-partitions\n         */\n        partitions {\n                compatible = "fixed-partitions";\n                #address-cells = <1>;\n                #size-cells = <1>;\n\n                /* 256KB for bootloader */\n                boot_partition: partition@0 {\n                        label = "mcuboot";\n                        reg = <0x0 0x40000>;\n                        read-only;\n                };\n\n                /* application image slot: 512KB */\n                slot0_partition: partition@40000 {\n                        label = "image-0";\n                        reg = <0x40000 0x80000>;\n                };\n\n                /* backup slot: 512KB */\n                slot1_partition: partition@c0000 {\n                        label = "image-1";\n                        reg = <0xc0000 0x80000>;\n                };\n\n                /* swap slot: 128KB */\n                scratch_partition: partition@140000 {\n                        label = "image-scratch";\n                        reg = <0x140000 0x20000>;\n                };\n\n                /* storage: 6.625MB for storage */\n                storage_partition: partition@160000 {\n                        label = "storage";\n                        reg = <0x160000 0x6a0000>;\n                };\n\n        };\n};\n')),(0,r.kt)("p",null,"\u5176\u4e2d",(0,r.kt)("inlineCode",{parentName:"p"},"boot_partition"),"\u3001",(0,r.kt)("inlineCode",{parentName:"p"},"slot0_partition"),"\u3001",(0,r.kt)("inlineCode",{parentName:"p"},"slot1_partition"),"\u548c",(0,r.kt)("inlineCode",{parentName:"p"},"scratch_partition"),"\u662f\u4e3a\u4e86mcuboot\u5b9a\u4e49\u7684\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"storage_partition"),"\u5206\u533a\u53ef\u7528\u4e8e\u5b58\u653e\u6587\u4ef6\u7cfb\u7edf\u7b49\u5176\u4ed6\u975e\u6613\u5931\u5b58\u50a8\u3002"),(0,r.kt)("p",null,"flash\u5206\u533a\u793a\u4f8b\u56fe\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-default"},"+----------+----------+----------+----------+\n|              boot_partition               |                \u7528\u4e8e\u70e7\u5f55bootloader\n+----------+----------+----------+----------+\n|              slot0_partition              |                \u4e3b\u5206\u533aAPP0\n+---------------------+---------------------+\n|              slot1_partition              |                \u6b21\u5206\u533aAPP1\n+---------------------+---------------------+\n|              scratch_partition            |        \u7528\u6765\u4f5c\u4e3aslot0\u548cslot1\u7684\u4ea4\u6362\u533a\n+---------------------+---------------------+\n|              storage_partition            |                \u7528\u6765\u5176\u4ed6\u5b58\u50a8(\u5982\u6587\u4ef6\u7cfb\u7edf)\n+---------------------+---------------------+\n")),(0,r.kt)("p",null,"mcuboot\u88ab\u70e7\u5f55\u5230",(0,r.kt)("inlineCode",{parentName:"p"},"boot_partition"),"\u5206\u533a\uff0c\u5e76\u4e14\u8d1f\u8d23\u7ba1\u7406",(0,r.kt)("inlineCode",{parentName:"p"},"slot0_partition"),"\u3001",(0,r.kt)("inlineCode",{parentName:"p"},"slot1_partition"),"\u548c",(0,r.kt)("inlineCode",{parentName:"p"},"scratch_partition"),"\u3002\u82af\u7247\u4e0a\u7535\u540e\uff0c\u9996\u5148\u542f\u52a8mcuboot\uff0cmcuboot\u6821\u9a8c",(0,r.kt)("inlineCode",{parentName:"p"},"slot0_partition"),"\u548c",(0,r.kt)("inlineCode",{parentName:"p"},"slot1_partition"),"\u5206\u533a\uff0c\u5e76\u6839\u9009\u62e9\u5176\u4e2d\u4e00\u4e2a\u542f\u52a8\u3002",(0,r.kt)("inlineCode",{parentName:"p"},"slot0_partition"),"\u5206\u533a\u56fa\u5b9a\u7528\u4e8e\u542f\u52a8\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"slot1_partition"),"\u5206\u533a\u56fa\u5b9a\u7528\u4e8e\u5347\u7ea7\u3002mcuboot\u652f\u6301\u901a\u8fc7uart\u3001usb\ncdc\u3001usb dfu\u7684\u65b9\u5f0f\u8fdb\u884c\u5347\u7ea7\uff0c\u5347\u7ea7\u5b8c\u6210\u540e\uff0c\u5c31\u5f00\u59cb\u542f\u52a8APP\u56fa\u4ef6\u3002"),(0,r.kt)("h3",{id:"\u751f\u6210mcuboot"},"\u751f\u6210mcuboot"),(0,r.kt)("h4",{id:"\u7f16\u8bd1"},"\u7f16\u8bd1"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"west build -p=auto -b csk6001_pico -d build_mcuboot bootloader\\mcuboot\\boot\\zephyr\n")),(0,r.kt)("h4",{id:"\u70e7\u5f55\u5230boot\u5206\u533a"},"\u70e7\u5f55\u5230boot\u5206\u533a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"# \u70e7\u5f55mcuboot\u5230boot_partition\u5206\u533a(flash\u504f\u79fb\u4f4d\u7f6e0x0)\nwest flash -d build_mcuboot\n")),(0,r.kt)("h3",{id:"\u751f\u6210app\u56fa\u4ef6"},"\u751f\u6210App\u56fa\u4ef6"),(0,r.kt)("h4",{id:"\u7f16\u8bd1-1"},"\u7f16\u8bd1"),(0,r.kt)("p",null,"\u8fd9\u91cc\u4f7f\u7528hello_world\u5de5\u7a0b\u4e3a\u4f8b\u6765\u751f\u6210App\u56fa\u4ef6\u3002\u56e0\u4e3aApp\u56fa\u4ef6\u7531mcuboot\u542f\u52a8\uff0c\u9700\u8981\u5728\u7f16\u8bd1\u65f6\u9700\u8981\u914d\u7f6e",(0,r.kt)("inlineCode",{parentName:"p"},"CONFIG_BOOTLOADER_MCUBOOT=y"),"\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"# \u7f16\u8bd1\u751f\u6210App\u56fa\u4ef6\nwest build -p=auto -b csk6001_pico .\\zephyr\\samples\\hello_world -- -DCONFIG_BOOTLOADER_MCUBOOT=y\n")),(0,r.kt)("h4",{id:"\u7b7e\u540d"},"\u7b7e\u540d"),(0,r.kt)("p",null,"mcuboot\u5728\u542f\u52a8App\u524d\u4f1a\u5148\u5bf9App\u8fdb\u884c\u6821\u9a8c\uff0c\u56e0\u6b64\u9700\u8981\u7528\u5bc6\u94a5\u5bf9App\u8fdb\u884c\u7b7e\u540d\u3002\u6ce8\u610fApp\u7b7e\u540d\u65f6\u7528\u5230\u7684\u5bc6\u94a5\u8981\u548cmcuboot\u4e00\u81f4\uff0c\u5426\u5219mcuboot\u5bf9App\u6821\u9a8c\u5931\u8d25\u3002mcuboot\u7f16\u8bd1\u65f6\u901a\u8fc7",(0,r.kt)("inlineCode",{parentName:"p"},"CONFIG_BOOT_SIGNATURE_KEY_FILE"),"\u6765\u9009\u62e9\u5bc6\u94a5\uff0cApp\u7b7e\u540d\u4e5f\u5e94\u7528\u540c\u4e00\u4e2a\u5bc6\u94a5\u3002\u5bc6\u94a5\u53ef\u7531\u7528\u6237\u81ea\u5b9a\u4e49\u751f\u6210\uff0c\u53c2\u8003",(0,r.kt)("a",{parentName:"p",href:"https://docs.mcuboot.com/readme-zephyr.html"},"Building\nand using MCUboot with\nZephyr"),"\uff0c\u672c\u4f8b\u4f7f\u7528mcuboot\u9ed8\u8ba4\u81ea\u5e26\u7684",(0,r.kt)("inlineCode",{parentName:"p"},"root-rsa-2048.pem")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"# \u4f7f\u7528.\\bootloader\\mcuboot\\script\\imgtool.py\u5bf9.\\build\u76ee\u5f55\u7684App\u56fa\u4ef6\u8fdb\u884c\u7b7e\u540d\n# \u4e0b\u9762\u7684\u4e24\u79cd\u65b9\u6cd5\u4efb\u9009\u4e00\u4e2a\n\n# \u7b80\u5355\u4f7f\u7528\u65b9\u6cd5\nwest sign -t imgtool -- --key bootloader\\mcuboot\\root-rsa-2048.pem\n\n# \u5c55\u5f00\u4f7f\u7528\u65b9\u6cd5\n# \u6ce8\u610f\uff1a--slot-size\u4e3aAPP0\u6240\u5728\u7684slot0_partitoin\u5206\u533a\u5927\u5c0f\uff0c\u5bf9\u5e94\u4e0a\u9762flash map\u4e3a0x80000\n.\\bootloader\\mcuboot\\script\\imgtool.py sign \\\n        --key .\\bootloader\\mcuboot\\root-rsa-2048.pem \\\n        --header-size 0x200 \\\n        --align 8 \\\n        --version 1.2 \\\n        --slot-size 0x80000 \\\n        .\\build\\zephyr\\zephyr.bin \\\n        .\\build\\zephyr\\zephyr.signed.bin\n")),(0,r.kt)("h4",{id:"\u70e7\u5f55\u5230slot0\u5206\u533a"},"\u70e7\u5f55\u5230slot0\u5206\u533a"),(0,r.kt)("p",null,"App\u56fa\u4ef6\u9700\u8981\u70e7\u5f55\u5230",(0,r.kt)("inlineCode",{parentName:"p"},"slot0_partition"),"\u5206\u533a\uff0c\u6ce8\u610f\u70e7\u5f55\u65f6\u9700\u6307\u5b9a\u70e7\u5f55\u4f4d\u7f6e\u4e3a",(0,r.kt)("inlineCode",{parentName:"p"},"slot0_partition"),"\u5206\u533a\u7684\u8d77\u59cb\u4f4d\u7f6e"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"# \u70e7\u5f55App\u5230slot0_partition\u5206\u533a\uff08flash\u504f\u79fb\u4f4d\u7f6e0x40000\uff09\nwest flash --bin-file build\\zephyr\\zephyr.signed.bin\n")),(0,r.kt)("h4",{id:"csk6001\u542f\u52a8\u65e5\u5fd7"},"CSK6001\u542f\u52a8\u65e5\u5fd7"),(0,r.kt)("p",null,"csk6001\u542f\u52a8\u65e5\u5fd7\u5982\u4e0b\uff0c\u53ef\u4ee5\u770b\u5230mcuboot\u5df2\u7ecf\u542f\u52a8\u4e86App\u56fa\u4ef6"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-default"},"*** Booting Zephyr OS build 3c2037394676  ***\nI: Starting bootloader\nI: Primary image: magic=unset, swap_type=0x1, copy_done=0x3, image_ok=0x3\nI: Scratch: magic=unset, swap_type=0x1, copy_done=0x3, image_ok=0x3\nI: Boot source: primary slot\nI: Swap type: none\nI: Bootloader chainload address offset: 0x40000\nI: Jumping to the first image slot\n*** Booting Zephyr OS build 3c2037394676  ***\nHello World! csk6001\n")),(0,r.kt)("h2",{id:"dfudevice-firmware-upgrade"},"DFU(Device Firmware Upgrade)"),(0,r.kt)("p",null,"Zephyr\u4f7f\u7528",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/guides/device_mgmt/dfu.html?highlight=mcuboot#device-firmware-upgrade"},"Device Firmware\nUpgrade"),"\u6846\u67b6\u6765\u7ba1\u7406\u56fa\u4ef6\uff0c\u4f7f\u7528",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/guides/device_mgmt/index.html#device-management"},"Device\nManagement"),"\u6765\u7ba1\u7406\u5347\u7ea7\u56fa\u4ef6\u7684\u4f20\u8f93\u548c\u76f8\u5173\u4f20\u8f93\u534f\u8bae\u3002\u5373DFU\u5b50\u7cfb\u7edf\u4e0d\u8d1f\u8d23\u56fa\u4ef6\u7684\u4f20\u8f93\uff0c\u53ea\u8d1f\u8d23\u56fa\u4ef6\u7684\u7ba1\u7406\u3002DFU\u548cDevice\nManagement\u5171\u540c\u914d\u5408\u5b8c\u6210\u56fa\u4ef6\u7684\u5347\u7ea7\u548c\u7ba1\u7406\u3002"),(0,r.kt)("h2",{id:"device-management"},"Device Management"),(0,r.kt)("p",null,"Device\nManagement\u5305\u542b",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/guides/device_mgmt/mcumgr.html#mcumgr"},"MCUmgr"),"\u3001",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/samples/subsys/usb/dfu/README.html#usb-dfu-sample-application"},"usb\ndfu"),"\u3001",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/samples/subsys/mgmt/hawkbit/README.html#hawkbit-direct-device-integration-api-sample"},"Hawkbit"),"\u3001",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/samples/subsys/mgmt/updatehub/README.html#updatehub-embedded-firmware-over-the-air-fota-sample"},"Updatehub"),"\u3001",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/samples/subsys/mgmt/osdp/README.html"},"OSDP"),"\u7b49\u5347\u7ea7\u65b9\u5f0f\uff0c\u63a5\u53e3\u6db5\u76d6uart\u3001usb\u3001eth\u3001wifi\u3001ble\u7b49\u3002",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/samples/subsys/mgmt/mgmt.html"},"Management\nSamples"),"\u7ed9\u51fa\u4e86\u4e0a\u9762\u7684\u793a\u4f8b\u3002"),(0,r.kt)("h2",{id:"usb-dfu"},"USB DFU"),(0,r.kt)("p",null,"usb dfu\u662fzephyr Device\nManagement\u7684\u4e00\u79cd\uff0c\u6b64\u65b9\u6848\u53ef\u901a\u8fc7usb\u63a5\u53e3\u5b8c\u6210\u5bf9\u56fa\u4ef6\u5347\u7ea7\u548c\u5907\u4efd\u3002",(0,r.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/samples/subsys/usb/dfu/README.html#usb-dfu-sample-application"},"USB DFU\nSample\nApplication"),"\u6f14\u793a\u4e86\u901a\u8fc7APP\u8fdb\u884cUSB\nDFU\u5347\u7ea7\u7684\u6d41\u7a0b\u3002"),(0,r.kt)("p",null,"\u4e0b\u9762\u7ed9\u51fa\u4e00\u4e2a\u901a\u8fc7mcuboot\u8fdb\u884cUSB DFU\u5347\u7ea7\u56fa\u4ef6\u7684\u4f8b\u5b50\u3002"),(0,r.kt)("h2",{id:"mcuboot\u7684usb-dfu\u7684\u5347\u7ea7"},"mcuboot\u7684usb dfu\u7684\u5347\u7ea7"),(0,r.kt)("p",null,"\u56e0\u4e3amcuboot\u5177\u6709\u5347\u7ea7\u529f\u80fd\uff0c\u53ef\u901a\u8fc7uart\u3001uart cdc\u3001usb\ndfu\u8fdb\u884c\u5347\u7ea7\u3002\u8fd9\u91cc\u4f7f\u7528mcuboot\u7684usb dfu\u529f\u80fd\u8fdb\u884c\u5347\u7ea7\u3002mcuboot\u7684usb\ndfu\u5347\u7ea7\u53ef\u4ee5\u4f7f\u7528gpio\u5f15\u811a\u89e6\u53d1\uff1b\u4e5f\u53ef\u4ee5\u4e0a\u7535\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\uff0c\u5982\u679c\u4e0a\u4f4d\u673a\u6ca1\u5347\u7ea7\u64cd\u4f5c\uff0c\u5c31\u5f00\u59cb\u5f15\u5bfcapp\u3002\u672c\u4f8b\u4f7f\u7528\u4e0a\u7535\u7b49\u5f85\u7684\u65b9\u6cd5\u6765\u6f14\u793a\u3002"),(0,r.kt)("h3",{id:"\u751f\u6210mcuboot-1"},"\u751f\u6210mcuboot"),(0,r.kt)("h4",{id:"\u6dfb\u52a0csk6001_picoconf"},"\u6dfb\u52a0csk6001_pico.conf"),(0,r.kt)("p",null,"\u9700\u8981\u5728bootloadermcubootbootzephyrboards\u76ee\u5f55\u4e0b\u6dfb\u52a0csk6001_pico.conf\u6587\u4ef6\uff0c\u5185\u5bb9\u5982\u4e0b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-default"},"CONFIG_BOOT_USB_DFU_WAIT=y\nCONFIG_BOOT_USB_DFU_WAIT_DELAY_MS=10000                      #\u7b49\u5f8510s\nCONFIG_IMG_BLOCK_BUF_SIZE=4096\nCONFIG_USB_REQUEST_BUFFER_SIZE=4096                          #usb\u6bcf\u6b21\u4f20\u8f934096\nCONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=4096\nCONFIG_USB_DFU_DEFAULT_POLLTIMEOUT=1\n\nCONFIG_USB_DEVICE_LOG_LEVEL_ERR=y\n")),(0,r.kt)("h4",{id:"\u7f16\u8bd1\u548c\u70e7\u5f55"},"\u7f16\u8bd1\u548c\u70e7\u5f55"),(0,r.kt)("h5",{id:"\u7f16\u8bd1-2"},"\u7f16\u8bd1"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"west build -p=auto -b csk6001_pico -d build_mcuboot bootloader\\mcuboot\\boot\\zephyr\n")),(0,r.kt)("h5",{id:"\u70e7\u5f55\u5230boot\u5206\u533a-1"},"\u70e7\u5f55\u5230boot\u5206\u533a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"# \u70e7\u5f55mcuboot\u5230boot_partition\u5206\u533a(flash\u504f\u79fb\u4f4d\u7f6e0x0)\nwest flash -d build_mcuboot\n")),(0,r.kt)("h3",{id:"\u751f\u6210\u5347\u7ea7\u56fa\u4ef6"},"\u751f\u6210\u5347\u7ea7\u56fa\u4ef6"),(0,r.kt)("p",null,"\u5347\u7ea7\u56fa\u4ef6\u88ab\u4e0b\u8f7d\u5230\u8bbe\u5907\u540e\uff0c\u4e5f\u8981\u88abmcuboot\u5f15\u5bfc\u3002\u56e0\u6b64\u5347\u7ea7\u56fa\u4ef6\u540c\u6837\u9700\u8981\u914d\u7f6e",(0,r.kt)("inlineCode",{parentName:"p"},"CONFIG_BOOTLOADER_MCUBOOT=y"),"\uff0c\u5e76\u9700\u8981\u8fdb\u884c\u7b7e\u540d\u3002"),(0,r.kt)("h4",{id:"\u7f16\u8bd1-3"},"\u7f16\u8bd1"),(0,r.kt)("p",null,"\u8fd9\u91cc\u4ecd\u65e7\u4f7f\u7528hello_world\u4f5c\u4e3a\u5347\u7ea7\u56fa\u4ef6\uff0c\u6ce8\u610f\u9700\u8981\u6dfb\u52a0\u914d\u7f6e",(0,r.kt)("inlineCode",{parentName:"p"},"CONFIG_BOOTLOADER_MCUBOOT=y")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"# \u7f16\u8bd1\u751f\u6210\u5347\u7ea7\u56fa\u4ef6\nwest build -p=auto -b csk6001_pico .\\zephyr\\samples\\hello-world -- -DCONFIG_BOOTLOADER_MCUBOOT=y\n")),(0,r.kt)("h4",{id:"\u7b7e\u540d-1"},"\u7b7e\u540d"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"# \u5bf9\u5347\u7ea7\u56fa\u4ef6\u8fdb\u884c\u7b7e\u540d\nwest sign -t imgtool -- --key bootloader\\mcuboot\\root-rsa-2048.pem\n")),(0,r.kt)("p",null,"\u751f\u6210\u7684.buildzephyrzepyr.signed.bin\u91cd\u547d\u540d\u6210signed-hello.bin\uff0c\u7528\u4e8ePC\u7aef\u4e0b\u8f7d\u4f7f\u7528"),(0,r.kt)("h3",{id:"\u6d4b\u8bd5"},"\u6d4b\u8bd5"),(0,r.kt)("p",null,"PC\u7aef\u4f7f\u7528",(0,r.kt)("a",{parentName:"p",href:"http://dfu-util.sourceforge.net/"},"dfu-util"),"\u8f6f\u4ef6\u6765\u63a7\u5236dfu\u8bbe\u5907\u8fdb\u884c\u56fa\u4ef6\u5347\u7ea7\u548c\u5907\u4efd\u3002"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"linux\u4e0a\u4e00\u822c\u81ea\u5e26dfu-util\uff0c\u5982\u679c\u6ca1\u6709\u53ef\u901a\u8fc7\u5305\u7ba1\u7406\u8f6f\u4ef6\u8fdb\u884c\u5b89\u88c5\uff0c\u5982ubuntu\u3001debian\u53ef\u4ee5\u4f7f\u7528sudo\napt-get install dfu-util\u5b89\u88c5\u3002")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"windows\u7aef\u6d4b\u8bd5\u9700\u8981\u5148\u5b89\u88c5\u9a71\u52a8\uff0c\u9a71\u52a8\u5b89\u88c5\u89c1",(0,r.kt)("a",{parentName:"li",href:"https://lexiangla.com/docs/d9cc0f3c58f411ec9e9bc2d4bb7d7c8f?company_from=246da8589c0811ea9d995254002f1020"},"Windows\u8fdb\u884cDFU\u5347\u7ea7\u6b65\u9aa4"))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"mac\u7aef\u6682\u672a\u6d4b\u8bd5\u3002")),(0,r.kt)("p",null,"\u4e0b\u9762\u4f8b\u5b50\u662f\u5728linux\u7cfb\u7edf\u4e0b\u8fdb\u884c\u7684\u6d4b\u8bd5"),(0,r.kt)("h4",{id:"\u67e5\u770bdfu\u8bbe\u5907"},"\u67e5\u770bdfu\u8bbe\u5907"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'# \u67e5\u770b\u5f53\u524d\u8fde\u63a5\u7684PC\u7684dfu\u8bbe\u5907\n$> sudo dfu-util --list\ndfu-util 0.11\n\nCopyright 2005-2009 Weston Schmidt, Harald Welte and OpenMoko Inc.\nCopyright 2010-2021 Tormod Volden and Stefan Schmidt\nThis program is Free Software and has ABSOLUTELY NO WARRANTY\nPlease report bugs to http://sourceforge.net/p/dfu-util/tickets/\n\nFound Runtime: [2fe3:0005] ver=0207, devnum=36, cfg=1, intf=0, path="1-3.3.2", alt=0, name="UNKNOWN", serial="0123456789ABCDEF"\n')),(0,r.kt)("h4",{id:"\u4e0b\u8f7d\u5347\u7ea7\u56fa\u4ef6\u5230slot1\u5206\u533a"},"\u4e0b\u8f7d\u5347\u7ea7\u56fa\u4ef6\u5230slot1\u5206\u533a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"# \u4e0b\u8f7d\u5347\u7ea7\u56fa\u4ef6signed-hello.bin\u5230slot1_partition\u5206\u533a\n$> sudo dfu-util --alt 1 --download signed-hello.bin\ndfu-util 0.11\n\nCopyright 2005-2009 Weston Schmidt, Harald Welte and OpenMoko Inc.\nCopyright 2010-2021 Tormod Volden and Stefan Schmidt\nThis program is Free Software and has ABSOLUTELY NO WARRANTY\nPlease report bugs to http://sourceforge.net/p/dfu-util/tickets/\n\nWarning: Invalid DFU suffix signature\nA valid DFU suffix will be required in a future dfu-util release\nOpening DFU capable USB device...\nDevice ID 2fe3:0005\nDevice DFU version 0110\nClaiming USB DFU (Run-Time) Interface...\nSetting Alternate Interface zero...\nDetermining device status...\nDFU state(0) = appIDLE, status(0) = No error condition is present\nDevice really in Run-Time Mode, send DFU detach request...\nResetting USB...\nOpening DFU USB Device...\nClaiming USB DFU Interface...\nSetting Alternate Interface #1 ...\nDetermining device status...\nDFU state(2) = dfuIDLE, status(0) = No error condition is present\nDFU mode device DFU version 0110\nDevice returned transfer size 4096\nCopying data from PC to DFU device\nDownload        [=========================] 100%        51492 bytes\nDownload done.\nDFU state(4) = dfuDNBUSY, status(0) = No error condition is present\nDone!\n")),(0,r.kt)("p",null,"usb\ndfu\u4ec5\u8d1f\u8d23\u4e0a\u4f20flash\u6570\u636e\u5230PC\u7aef\u6216\u8005\u63a5\u6536PC\u7aef\u6570\u636e\u5e76\u70e7\u5f55\u5230flash\uff0c\u4e0d\u8d1f\u8d23\u590d\u4f4d\u82af\u7247\u3002\u56e0\u6b64\u8fd9\u91cc\u4e0b\u8f7d\u5b8c\u540e\u7528\u6237\u9700\u8981\u81ea\u5df1\u590d\u4f4d\u6216\u91cd\u65b0\u4e0a\u7535\u3002"),(0,r.kt)("p",null,"\u4e0b\u8f7d\u540e\u7b2c\u4e00\u6b21\u542f\u52a8\uff0cmcuboot\u5c31\u4f1a\u6821\u9a8c",(0,r.kt)("inlineCode",{parentName:"p"},"slot0_partition"),"\u548c",(0,r.kt)("inlineCode",{parentName:"p"},"slot1_partition"),"\u5206\u533a\uff0c\u7136\u540e\u628a",(0,r.kt)("inlineCode",{parentName:"p"},"slot0_partition"),"\u548c",(0,r.kt)("inlineCode",{parentName:"p"},"slot1_partition"),"\u5206\u533a\u8fdb\u884c\u4ea4\u6362\uff0c\u5e76\u542f\u52a8",(0,r.kt)("inlineCode",{parentName:"p"},"slot0_partition"),"\u5206\u533a\uff0c\u5373\u542f\u52a8\u4e0b\u8f7d\u7684\u56fa\u4ef6\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-default"},"*** Booting Zephyr OS build 3c2037394676  ***\nI: Starting bootloader\nI: Primary image: magic=unset, swap_type=0x1, copy_done=0x3, image_ok=0x3\nI: Scratch: magic=unset, swap_type=0x1, copy_done=0x3, image_ok=0x3\nI: Boot source: primary slot\nI: Swap type: test\nI: Bootloader chainload address offset: 0x40000\nI: Jumping to the first image slot\n*** Booting Zephyr OS build 3c2037394676  ***\nHello World! csk6001\n")),(0,r.kt)("p",null,"\u6b64\u5347\u7ea7\u56fa\u4ef6\u53ea\u8fd0\u884c\u4e00\u6b21\uff0c\u7b2c\u4e8c\u6b21\u91cd\u542f\u65f6\uff0c\u4f1a\u7ee7\u7eed\u4ea4\u6362",(0,r.kt)("inlineCode",{parentName:"p"},"slot0_partition"),"\u548c",(0,r.kt)("inlineCode",{parentName:"p"},"slot1_partition"),"\u5206\u533a\uff0c\u5e76\u542f\u52a8\u539f\u672c\u7684",(0,r.kt)("inlineCode",{parentName:"p"},"slot0_partition"),"\u5206\u533a\u56fa\u4ef6\u3002"),(0,r.kt)("p",null,"\u5982\u679c\u60f3\u8ba9\u5347\u7ea7\u56fa\u4ef6\u6c38\u4e45\u88ab\u6267\u884c\uff0c\u9700\u8981\u5728\u7b7e\u540d\u7684\u65f6\u5019\u589e\u52a0",(0,r.kt)("inlineCode",{parentName:"p"},"--confirm"),"\u914d\u7f6e\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"west sign -t imgtool -- --confirm --key bootloader\\mcuboot\\root-rsa-2048.pem\n")))}d.isMDXComponent=!0}}]);