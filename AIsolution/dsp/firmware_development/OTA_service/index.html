<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.2">
<title data-react-helmet="true">OTA开发 | 聆思文档中心</title><meta data-react-helmet="true" property="og:url" content="https://github.com/LISTENAI/docs-csk6/AIsolution/dsp/firmware_development/OTA_service"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="OTA开发 | 聆思文档中心"><meta data-react-helmet="true" name="description" content="本文主要介绍离在线方案的 OTA 服务，通过阅读本文，你将了解到："><meta data-react-helmet="true" property="og:description" content="本文主要介绍离在线方案的 OTA 服务，通过阅读本文，你将了解到："><link data-react-helmet="true" rel="shortcut icon" href="/docs-csk6/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://github.com/LISTENAI/docs-csk6/AIsolution/dsp/firmware_development/OTA_service"><link data-react-helmet="true" rel="alternate" href="https://github.com/LISTENAI/docs-csk6/AIsolution/dsp/firmware_development/OTA_service" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://github.com/LISTENAI/docs-csk6/AIsolution/dsp/firmware_development/OTA_service" hreflang="x-default"><link rel="stylesheet" href="/docs-csk6/assets/css/styles.e821b6b0.css">
<link rel="preload" href="/docs-csk6/assets/js/runtime~main.7fc13d81.js" as="script">
<link rel="preload" href="/docs-csk6/assets/js/main.1f54c7f3.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_vO2r">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" titleclassname="navbar__title" href="/docs-csk6/"><img src="/docs-csk6/img/logo_light.svg" alt="LSOpen Logo" class="themedImage_K3WP themedImage--light_Fy0T navbar__logo"><img src="/docs-csk6/img/logo_dark.svg" alt="LSOpen Logo" class="themedImage_K3WP themedImage--dark_V9oi navbar__logo"></a><a class="navbar__item navbar__link" href="/docs-csk6/chips/4002/Chip_information_4002">芯片</a><a class="navbar__item navbar__link" href="/docs-csk6/tools/LStudio">工具</a><a class="navbar__item navbar__link" href="/docs-csk6/AIsolution/ESR/Quick_start/Scheme_introduction">AI语音应用方案</a><a class="navbar__item navbar__link" href="/docs-csk6/Industrysolution/Scanning_pen/Scheme_introduction">行业Turnkey解决方案</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs-csk6/faq/faq">FAQ</a><a class="navbar__item navbar__link" href="/docs-csk6/school/school">视频课程</a><a class="navbar__item navbar__link" href="/docs-csk6/workorder/workorder">工单</a><div class="react-toggle displayOnlyInLargeViewport_a-w0 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_8pH0"><img src="/docs-csk6/img/light.svg" alt="" class="themedImage_K3WP themedImage--light_Fy0T"><img src="/docs-csk6/img/unlight.svg" alt="" class="themedImage_K3WP themedImage--dark_V9oi"></span></div><div class="react-toggle-track-x"><span class="toggle_8pH0"><img src="/docs-csk6/img/undark.svg" alt="" class="themedImage_K3WP themedImage--light_Fy0T"><img src="/docs-csk6/img/dark.svg" alt="" class="themedImage_K3WP themedImage--dark_V9oi"></span></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="navbar__search searchBarContainer_I7kZ"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_Zg7X searchBarLoadingRing_J5Ez"><div></div><div></div><div></div><div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" titleclassname="navbar__title" href="/docs-csk6/"><img src="/docs-csk6/img/logo_light.svg" alt="LSOpen Logo" class="themedImage_K3WP themedImage--light_Fy0T navbar__logo"><img src="/docs-csk6/img/logo_dark.svg" alt="LSOpen Logo" class="themedImage_K3WP themedImage--dark_V9oi navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/chips/4002/Chip_information_4002">芯片</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/tools/LStudio">工具</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/AIsolution/ESR/Quick_start/Scheme_introduction">AI语音应用方案</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/Industrysolution/Scanning_pen/Scheme_introduction">行业Turnkey解决方案</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/faq/faq">FAQ</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/school/school">视频课程</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/workorder/workorder">工单</a></li></ul></div></div></div></nav><nav class="navbar subnavbar--fixed-top sub-navbar"><div class="navbar__inner subnavbar__inner"><div class="navbar__items"><a class="subnavbar__item subnavbar__link" dirname="/AIsolution" href="/docs-csk6/AIsolution/ESR/Quick_start/Scheme_introduction">离线语音</a><a aria-current="page" class="subnavbar__item subnavbar__link subnavbar__link--active" dirname="/AIsolution" href="/docs-csk6/AIsolution/dsp/readme">离在线语音</a></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_Ol8-"><aside class="docSidebarContainer_UfDv"><div class="sidebar_OMtR"><nav class="menu menu--responsive thin-scrollbar menu_2y2e menuWithAnnouncementBar_Lwkw" aria-label="Sidebar navigation"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_IcOF" width="24" height="24" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/AIsolution/dsp/readme">概览</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--first menu__link--sublist" type="first" href="#!">快速入门</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/AIsolution/dsp/Quick_start/developer_guides">方案介绍</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/AIsolution/dsp/Quick_start/getting_start">快速体验</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--first menu__link--sublist" type="first" href="#!">硬件设计</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/AIsolution/dsp/Hardwaredevelopment/hardware_guide">硬件参考设计</a></li></ul></li><li class="menu__list-item menu__list-item--current"><a class="menu__link menu__link--first menu__link--sublist menu__link--active" type="first" href="#!">固件开发</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs-csk6/AIsolution/dsp/firmware_development/CSK_online_firmware">制作离在线项目的CSK固件</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs-csk6/AIsolution/dsp/firmware_development/Create_iFLYOS_equipment">创建你的 iFLYOS 设备</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs-csk6/AIsolution/dsp/firmware_development/xr872_evs">上位机固件二次开发</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs-csk6/AIsolution/dsp/firmware_development/OTA_service">OTA开发</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs-csk6/AIsolution/dsp/firmware_development/software_material">开发资料下载</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--first menu__link--sublist" type="first" href="#!">云端开发</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/AIsolution/dsp/cloud_development/Custom_skills">自定义技能实现</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/AIsolution/dsp/cloud_development/iot">智能家居服务</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--first menu__link--sublist" type="first" href="#!">FAQ</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/AIsolution/dsp/FAQ/faq">常见问题</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_dRYS"><div class="container padding-top--md padding-bottom--lg center-container"><div class="row"><div class="col docItemCol_+xOG"><div class="docItemContainer_c+5G"><article><div class="markdown"><header><h1 class="h1Heading_5RMM">OTA开发</h1></header><blockquote><p>本文主要介绍离在线方案的 OTA 服务，通过阅读本文，你将了解到：</p><p>1.OTA 文件说明</p><p>2.OTA 服务运行流程，</p><p>3.如何在 iFLYOS 上配置 OTA 文件</p><p>4.固件源码中 OTA SDK 的使用说明</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="1ota文件说明"></a>1.OTA文件说明<a class="hash-link" href="#1ota文件说明" title="Direct link to heading">#</a></h2><p>OTA 包由三部分组成，分别是 <strong>info.txt</strong>、<strong>WIFi SOC  固件</strong>、<strong>CSK 固件</strong>，本文以 CSK+XR872AT 方案的 OTA 为例：</p><p>WIFi SOC 固件包，如 XR872AT.img；</p><p>CSK 固件包，包括 flashboot、respak.bin、master.bin，burner.img；</p><p>info.txt 是一个配置文件，描述 OTA 的具体升级信息，示例如下：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token string" style="color:rgb(206, 145, 120)">&quot;version&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">10020</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token string" style="color:rgb(206, 145, 120)">&quot;xr872&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token string" style="color:rgb(206, 145, 120)">&quot;version&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">10020</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token string" style="color:rgb(206, 145, 120)">&quot;file_size&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">47920</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token string" style="color:rgb(206, 145, 120)">&quot;md5&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;0AC03421791CDFFB7B73E8AA7B0FD8B4&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token string" style="color:rgb(206, 145, 120)">&quot;file_path&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;files/xr872.img&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;castor&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;version&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">1001</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;file_size&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">47920</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;md5&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;0AC03421791CDFFB7B73E8AA7B0FD8B4&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;file_path&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;files/burner.img&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;version&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">1001</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;file_size&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">18280</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;md5&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;394474A9B07DCDA2233C676CC24EFD45&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;file_path&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;files/flashboot.bin&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;addr&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;0x0&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">       </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;version&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">1001</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">       </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;file_size&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">417164</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">       </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;md5&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;5DEBA6B85BEC67ED8A0C6438BBCAE1F9&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">       </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;file_path&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;files/master.bin&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">       </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;addr&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;0x10000&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;version&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">1001</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;file_size&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">3652226</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;md5&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;42EEFF98DD52E0189858C221330A1C85&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;file_path&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;files/respak.bin&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;addr&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;0x100000&quot;</span><span class="token plain">  </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><table><thead><tr><th><strong>字段名</strong></th><th><strong>字段说明</strong></th></tr></thead><tbody><tr><td>version</td><td>此次 OTA 的版本号，必须比前版本大，只要有 XR872AT 或者 CSK 中的一 个需要升级都需增加此版本号</td></tr><tr><td>xr872</td><td>此次 OTA 中 XR872AT 固件相关信息，如果 XR872AT 不升级，可不需要</td></tr><tr><td>xr872.version</td><td>XR872AT 固件版本号</td></tr><tr><td>xr872.file_size</td><td>XR872AT 固件大小</td></tr><tr><td>xr872.md5</td><td>XR872AT 固件MD5</td></tr><tr><td>xr872.file_path</td><td>XR872AT 固件文件路径（ files/xr872 文件名），需跟上传的 XR872AT 文件名 一致，会通过 url + file_path 进行 OTA</td></tr><tr><td>castor</td><td>此次 OTA 中 CSK 相关信息，如果 CSK 不升级，可不需要</td></tr><tr><td>castor[i].version</td><td>CSK 固件子包版本号，master.bin的版本号为主，<strong>默认为1000</strong></td></tr><tr><td>castor[i].file_size</td><td>CSK 固件子包文件大小</td></tr><tr><td>castor[i].md5</td><td>CSK 固件子包 md5</td></tr><tr><td>castor[i].file_path</td><td>CSK 固件子包路径（ files /子包文件名），需跟上传的文件名一致， 会通过 url + file_path 进行 OTA</td></tr><tr><td>castor[i].addr</td><td>CSK固件子包地址，烧录固件时会对子包地址进行校验，校验通过方可烧录成功</td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="2ota-业务流程"></a>2.OTA 业务流程<a class="hash-link" href="#2ota-业务流程" title="Direct link to heading">#</a></h2><p>整体流程见下图：</p><ul><li>触发检查更新条件时，设备端会请求 iFLYOS 自动更新API</li><li>云端返回固件 <strong>info.txt</strong> 和固件下载地址。</li><li>解析 info.txt 文件，将解析出的 <code>version</code> 与固件本地的 <code>version</code>，若云端 <code>version</code> 大于固件 <code>version</code>，则说明有可用更新，进入下一步流程；</li><li>根据 info.txt 的内容，解析出云端固件包的内容，通常来说，固件包有三种情况：仅 CSK 固件、仅 XR872AT 固件、CSK 固件和  XR872AT 固件均更新。</li><li>若仅 CSK 更新，则 XR872AT 将固件下载下来后，通过串口传输至 CSK 中，由 CSK 实现固件更新；</li><li>若仅 XR872AT 更新，则通过 A/B update 的形式实现固件更新；</li><li>若 CSK 和 XR872AT 均更新，则先完成 XR872AT固件更新，之后 XR872AT再将可用更新传至 CSK 中；</li></ul><p><img src="/docs-csk6/assets/images/OTA_PROCESS-1211428f4b00cdf48f77829e5893ff0b.jpg"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="3如何在-iflyos-上配置ota文件"></a>3.如何在 iFLYOS 上配置OTA文件<a class="hash-link" href="#3如何在-iflyos-上配置ota文件" title="Direct link to heading">#</a></h2><p>你需要在 iFLYOS 平台的【自动更新】菜单栏上传固件包，操作说明如下：</p><p><img src="/docs-csk6/assets/images/iFLYOS_OTA-f5388e3f2fb41ef56418bbe37ef5652e.png"></p><ul><li><p>配置 OTA 固件时，索引配置文件必须命名为 <strong>info.txt</strong>。</p></li><li><p>平台配置 OTA，info.txt 中 file_path 必须为 <strong>files/文件名</strong> 的形式。</p></li><li><p>CSK 固件升级主要是检查 file_path 为 master.bin 的 <code>version</code>，其余子包 <code>version</code> 均为预留字段，建议 CSK 固件升级将 CSK 字段下的子包 <code>version</code> 均统一增加，如果不需要升级 CSK 固件不用添加 CSK 信息。</p></li><li><p>OS平台配置后，可通过重启设备或【小飞在线】APP 检查更新来进行 OTA 升级。</p></li></ul><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>1.OTA 服务是可选项，如果你有自己的 OTA 服务，也可自行实现 OTA 功能。</p><p>2.请确保固件中的 <code>OTA_SECRET</code> 字段与 iFLYOS 中保持一致，否则即使云端有可用更新，也会因校验不通过而 OTA 失败。</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="4ota-sdk-使用说明"></a>4.OTA SDK 使用说明<a class="hash-link" href="#4ota-sdk-使用说明" title="Direct link to heading">#</a></h2><p>接下来为你介绍 OTA 相关接口，有助于你实现 OTA 模块的二次开发。</p><ul><li><strong>EVS OTA接口</strong></li></ul><p>固件源码中，与 iFLYOS 平台 OTA 服务交互的相关逻辑在 <code>listenai_sdk/modules/listenai_evs/evs_ota.c</code> 中，主要包括以下功能接口。</p><table><thead><tr><th><strong>函数名</strong></th><th><strong>功能说明</strong></th><th><strong>参数与备注</strong></th></tr></thead><tbody><tr><td>evs_ota_init</td><td>初始化</td><td>参数为一些 OTA 事件回调</td></tr><tr><td>evs_ota_check_version</td><td>检查版本，可获取具体检查结 果</td><td></td></tr><tr><td>evs_ota_update_new_version</td><td>检查版本，通过回调的形式通 知是否需要升级</td><td></td></tr><tr><td>evs_ota_start_update</td><td>开始升级， evs_ota_update_new_version 后可通过此接口升级</td><td>与 evs_ota_update_new_version 搭配使用，分开是为了在检查和升级中  有一些自定义动作，可控流程</td></tr><tr><td>evs_ota_get_state</td><td>获取当前 OTA 状态</td><td></td></tr><tr><td>evs_ota_destroy</td><td>销毁</td><td></td></tr></tbody></table><p>以下为OTA接口调用的过程中，一些回调通知事件。</p><table><thead><tr><th><strong>事件名</strong></th><th><strong>功能说明</strong></th><th><strong>备注</strong></th></tr></thead><tbody><tr><td>OTA_EVENT_NEW_VERSION</td><td>检查到新版本</td><td>evs_ota_update_new_version 接口调用后通知的事件</td></tr><tr><td>OTA_EVENT_START</td><td>开始升级</td><td>evs_ota_start_update 接口调用后通知的事件</td></tr><tr><td>OTA_EVENT_START_FAILED</td><td>开始升级失败</td><td>evs_ota_start_update 接口调用后通知的事件</td></tr><tr><td>OTA_EVENT_SUCCESS</td><td>升级流程成功</td><td>evs_ota_start_update 接口调用后通知的事件</td></tr><tr><td>OTA_EVENT_FAILED</td><td>升级失败</td><td>evs_ota_start_update 接口调用后通知的事件</td></tr><tr><td>OTA_EVENT_UPGRADE_OK</td><td>重启后检查确认 升级成功</td><td>重启后检查升级成功通知的事件</td></tr><tr><td>OTA_EVENT_NONE</td><td>无新版本</td><td>evs_ota_update_new_version 接口调 用后通知的事件</td></tr></tbody></table><p><strong>Castor_EVB</strong> <strong>OTA接口</strong></p><p>Castor_EVB 整套通用 OTA 方案，包括 XR872AT 和 CSK 升级，代码在 <code>listenai_sdk/drivers/listenai_ota/evs_castor_ota.c</code> 中，主要包含以下接口。</p><table><thead><tr><th><strong>函数名</strong></th><th><strong>功能说明</strong></th><th><strong>参数与备注</strong></th></tr></thead><tbody><tr><td>evs_ota_process</td><td>OTA 升级接口</td><td>参数为OTA配置文件的 url 地址，调用此接口便可通过配置信息进行 OTA 升级。返回 -1 表示检查配置失败，返回 -2 表示不需要更新</td></tr><tr><td>evs_xr872_get_info</td><td>通过配置文件获取XR872AT 固件信息</td><td></td></tr><tr><td>evs_castor_get_info</td><td>通过配文件获取 CSK 固件信息</td><td></td></tr><tr><td>evs_castor_flashboot_get_info</td><td>通过配置文件获取 CSK 固件信息</td><td></td></tr><tr><td>evs_castor_uart_get_info</td><td>通过配置文件获取 CSK 固件信息</td><td></td></tr><tr><td>evs_castor_respak_get_info</td><td>通过配置文件获取 CSK 固件信息</td><td></td></tr><tr><td>evs_get_version</td><td>获取当前默认 OTA 版本</td><td>需 flash 存储 OTA 版本号，否则此为默认版 本</td></tr></tbody></table><p>以下为 OTA 接口调用的过程中，一些回调通知事件。</p><table><thead><tr><th><strong>事件名</strong></th><th><strong>功能说明</strong></th><th><strong>备注</strong></th></tr></thead><tbody><tr><td>e_ota_start</td><td>开始 OTA 升级</td><td>evs_ota_process 调用后检查需要更新后通知的事件</td></tr><tr><td>e_ota_success</td><td>OTA 升级成功</td><td>evs_ota_process 调用后升级成功通知的事件</td></tr><tr><td>e_ota_failed</td><td>OTA 升级失败</td><td>evs_ota_process 调用后升级失败通知的事件</td></tr></tbody></table><p><strong>XR872AT OTA 接口</strong></p><p>XR872AT 固件升级接口，代码在 listenai_sdk/drivers/listenai_ota/evs_xr872_ota.c 中，主要包含以下接口。</p><table><thead><tr><th><strong>函数名</strong></th><th><strong>功能说明</strong></th><th>参数与备注**</th></tr></thead><tbody><tr><td>evs_xr872_ota_http</td><td>XR872AT http升级接口</td><td>参数为 XR872AT 固件包 url，返回-1表示升 级失败</td></tr><tr><td>evs_xr872_get_version</td><td>XR872AT 当前固件版本号</td><td></td></tr></tbody></table><p><strong>Castor_EVB 版本号信息</strong></p><p>Castor_EVB 版本号和版本名信息在 listenai_sdk/listenai_version.h 中。</p><table><thead><tr><th><strong>字段名</strong></th><th><strong>功能说明</strong></th><th><strong>备注</strong></th></tr></thead><tbody><tr><td>CASTOR_VERSION_DEFAULT</td><td>CSK 默认版本号</td><td></td></tr><tr><td>XR872_VERSION</td><td>XR872AT 版本号</td><td>主版本号+次版本号+修订号形式</td></tr><tr><td>OTA_VERSION_DEFAULT</td><td>OTA 方案默认版本号</td><td>需 flash 存储在线 OTA 版本号，否则此为默认版本</td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="5-ota协议"></a>5. OTA协议<a class="hash-link" href="#5-ota协议" title="Direct link to heading">#</a></h2><p>本文档描述了CSK4002的串口下载方法，通过串口的方式，将用户代码拷贝到RAM或者FLASH区域，可用于用户方案开发，并开放上位机和下位机代码以及协议解析。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="数据格式解析"></a>数据格式解析<a class="hash-link" href="#数据格式解析" title="Direct link to heading">#</a></h3><p>数据格式较为简单，主机发送由SLIP转化的数据请求到CSK4002芯片，再由CSK4002数据芯片回应刚才的请求给上位机（SLIP协议转化），本章主要描述了请求格式、回应格式、错误码以及指令码四个方面的内容。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="底层传输协议"></a>底层传输协议<a class="hash-link" href="#底层传输协议" title="Direct link to heading">#</a></h4><p>底层传输协议采用SLIP传输协议，包头和包尾均由0xC0包裹，中间数据区域的0xC0和0xDB将会替换为0xDB 0xDC 和 0xDB 0xDD。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="请求数据格式"></a>请求数据格式<a class="hash-link" href="#请求数据格式" title="Direct link to heading">#</a></h4><table><thead><tr><th>Byte</th><th>Name</th><th>Comment</th></tr></thead><tbody><tr><td>0</td><td>Direction</td><td>总是0x00</td></tr><tr><td>1</td><td>Command</td><td>参考<a href="#26%E6%8C%87%E4%BB%A4%E5%88%97%E8%A1%A8">指令列表</a></td></tr><tr><td>2-3</td><td>Size</td><td>Data数据区域的长度</td></tr><tr><td>4-7</td><td>Checksum</td><td>只有在FLASH_DATA 和 MEM_DATA两个指令有效，其他指令时都为0</td></tr><tr><td>8..n</td><td>Data</td><td>数据传输区域，当在Command为FLASH_DATA 和 MEM_DATA时，该区域遵守Data协议，其他指令则都直接将数据按位放在该区域</td></tr></tbody></table><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="回应数据格式"></a>回应数据格式<a class="hash-link" href="#回应数据格式" title="Direct link to heading">#</a></h4><table><thead><tr><th>Byte</th><th>Name</th><th>Comment</th></tr></thead><tbody><tr><td>0</td><td>Direction</td><td>总是0x01</td></tr><tr><td>1</td><td>Command</td><td>参考<a href="#26%E6%8C%87%E4%BB%A4%E5%88%97%E8%A1%A8">指令列表</a></td></tr><tr><td>2-3</td><td>Size</td><td>Data数据区域的长度</td></tr><tr><td>4-7</td><td>Value</td><td>0x00</td></tr><tr><td>8</td><td>Error</td><td>0x00表示成功，0x01表示失败</td></tr><tr><td>9</td><td>Status</td><td>如果传输失败时候的失败原因，否则为0x00</td></tr><tr><td>10-17</td><td>MD5</td><td>只有当发送过来的Command为SPI_FLASH_MD5时该区域才有效</td></tr></tbody></table><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="错误状态码"></a>错误状态码<a class="hash-link" href="#错误状态码" title="Direct link to heading">#</a></h4><table><thead><tr><th>Name</th><th>Data</th><th>Comment</th></tr></thead><tbody><tr><td>TRANSMIT_PASS</td><td>0x0</td><td>传输成功</td></tr><tr><td>DATA_STREAM_OVERFLOW</td><td>0x1</td><td>数据缓冲区溢出错误</td></tr><tr><td>TRANSFORM_FORMAT_ERROR</td><td>0x2</td><td>格式转化错误</td></tr><tr><td>ILLEGAL_DATA_PACKET</td><td>0x3</td><td>非法数据</td></tr><tr><td>CHECKSUM_FAILED</td><td>0x4</td><td>数据校验错误</td></tr><tr><td>COMMAND_SEQUENCE_ERROR</td><td>0x5</td><td>指令顺序错误</td></tr><tr><td>DATA_ID_SEQUENCE_ERROR</td><td>0x6</td><td>数据指令ID顺序错误</td></tr><tr><td>FLASH_ERROR</td><td>0x8</td><td>FLASH写入错误</td></tr><tr><td>UNSUPPORT_COMMAND</td><td>0x9</td><td>未支持指令</td></tr></tbody></table><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="data区域数据格式"></a>Data区域数据格式<a class="hash-link" href="#data区域数据格式" title="Direct link to heading">#</a></h4><table><thead><tr><th>Byte</th><th>Name</th><th>Comment</th></tr></thead><tbody><tr><td>0-3</td><td>Data Length</td><td>Data To Write区域的数据长度</td></tr><tr><td>4-7</td><td>Number</td><td>从0开始的数据编号</td></tr><tr><td>8-15</td><td>0</td><td></td></tr><tr><td>16..n</td><td>Data To Write</td><td>数据负载，最大负载为PROXY_UART_RX_MAX ROM通讯时则为 ROM_UART_RX_MAX</td></tr></tbody></table><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="指令列表"></a>指令列表<a class="hash-link" href="#指令列表" title="Direct link to heading">#</a></h4><table><thead><tr><th>Command</th><th>Data</th><th>Description</th><th>Input Data</th></tr></thead><tbody><tr><td>FLASH_BEGIN</td><td>0x02</td><td>开始FLASH下载</td><td>总共4个WORD数据，分别为：总传输大小；传输PACKET数量；每个PACKET大小；起始地址（绝对地址）</td></tr><tr><td>FLASH_DATA</td><td>0x03</td><td>FLASH下载数据</td><td>参考<a href="#25data%E5%8C%BA%E5%9F%9F%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F">Data区域</a></td></tr><tr><td>FLASH_END</td><td>0x04</td><td>FLASH下载结束</td><td>只有1个WORD数据<br>0x00：表示下载完成后下位机自动重启<br>0x02：表示下载完成后下位机仍然运行</td></tr><tr><td>MEM_BEGIN</td><td>0x05</td><td>开始Memory下载</td><td>总共4个WORD数据，分别为：总传输大小；传输PACKET数量；每个PACKET大小；起始地址（绝对地址）</td></tr><tr><td>MEM_END</td><td>0x06</td><td>Memory下载结束</td><td>总共2个WORD数据，第一个WORD<br>0x00：表示下载完成后下位机自动重启<br>0x01：表示下载完成后跳转到第二个WORD数据的地址<br>第二个WORD只有在第一个WORD为0x01时有效<br>0x02：表示下载完成后下位机仍然运行</td></tr><tr><td>MEM_DATA</td><td>0x07</td><td>Memory下载数据</td><td>参考<a href="#25data%E5%8C%BA%E5%9F%9F%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F">Data区域</a></td></tr><tr><td>SYNC</td><td>0x08</td><td>同步</td><td>同步信号，总共36 WORD数据：0x07 0x07 0x12 0x20 在跟32个 0x55</td></tr><tr><td>CHANGE_BAUDRATE</td><td>0x0f</td><td>改变波特率</td><td>总共有2个WORD 参数，分别为改变的波特率；当前的波特率</td></tr><tr><td>SPI_FLASH_MD5</td><td>0x13</td><td>MD5校验</td><td>总共有4个WORD参数，分别是：校验起始位置（绝对地址）；校验大小；0；0；</td></tr><tr><td>ERASE_FLASH</td><td>0xd0</td><td>擦除整个FLASH</td><td>无</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="传输过程"></a>传输过程<a class="hash-link" href="#传输过程" title="Direct link to heading">#</a></h3><p>串口下载的整个过程，分为ROM通讯、建立代理、数据下载三个部分，每个部分都会涉及上一章提及的传输格式。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="rom通讯"></a>ROM通讯<a class="hash-link" href="#rom通讯" title="Direct link to heading">#</a></h4><p>CSK4002芯片上电，会直接进入ROM程序，在ROM程序未检出FLASH上面有image文件时，会自动进入UART接收等待，</p><p>在ROM阶段发送SYNC指令，可以检查ROM是否进入UART等待接收阶段，这样便于后续的代理建立。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="建立代理"></a>建立代理<a class="hash-link" href="#建立代理" title="Direct link to heading">#</a></h4><p>代理文件源码，见本文目录下的fireware文件夹，下载代理的目的在于将程序运行控制权，从ROM区域转移到代理区域，并支持FLASH下载，波特率切换，MD5校验等功能。</p><p>上位机可以通过发送MEM_BEGIN、MEM_DATA将代理文件发送至ROM侧，ROM UART接收代码会将该文件加载到SRAM区域，最后通过MEM_END，在发送结束的时候将程序的控制权完全交给代理。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="数据下载"></a>数据下载<a class="hash-link" href="#数据下载" title="Direct link to heading">#</a></h4><p>当控制权完全由下载代理掌控后，指令列表里的所有指令都可以使用，用户可以在这个阶段进行FLASH下载，RAM下载，切换波特率，MD5校验等。</p><p>下面几节都会介绍各个指令的数据格式内容，但是都未进行SLIP处理，在实际数据发送的时候都需要进行SLIP处理，相关SLIP处理代码详见pc_tool文档内protocol目录下的slip文件夹。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="flash下载"></a>FLASH下载<a class="hash-link" href="#flash下载" title="Direct link to heading">#</a></h4><p>FLASH下载过程中，可以使用 FLASH_BEGIN、FLASH_DATA、FLASH_END三个指令。每发送一包数据，都需要上位机等待接收回应。</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="flash_begin"></a>FLASH_BEGIN<a class="hash-link" href="#flash_begin" title="Direct link to heading">#</a></h5><table><thead><tr><th>Byte</th><th>Name</th><th>Data</th></tr></thead><tbody><tr><td>0</td><td>Direction</td><td>0x00</td></tr><tr><td>1</td><td>Command</td><td>0x02</td></tr><tr><td>2-3</td><td>Size</td><td>0x00 0x18</td></tr><tr><td>4-7</td><td>Checksum</td><td>0xXX 0xXX 0xXX 0xXX</td></tr><tr><td>8-11</td><td>Total</td><td>0xXX 0xXX 0xXX 0xXX（根据需要传输的数据量来定，无对齐要求）</td></tr><tr><td>12-15</td><td>Packet Number</td><td>0xXX 0xXX 0xXX 0xXX（需要传输的Packet数据量）</td></tr><tr><td>16-19</td><td>Packet Size</td><td>0xXX 0xXX 0xXX 0xXX（每一个Packet的负载大小）</td></tr><tr><td>20-23</td><td>Address</td><td>0xXX 0xXX 0xXX 0xXX（FLASH下载数据的起始地址，使用CSK4002芯片，该起始地址大于0x8000 0000 小于 0x8080 0000）</td></tr></tbody></table><p>该数据包只需要传输一次，将接下来需要传输的信息通知代理</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="flash_data"></a>FLASH_DATA<a class="hash-link" href="#flash_data" title="Direct link to heading">#</a></h5><table><thead><tr><th>Byte</th><th>Name</th><th>Data</th></tr></thead><tbody><tr><td>0</td><td>Direction</td><td>0x00</td></tr><tr><td>1</td><td>Command</td><td>0x03</td></tr><tr><td>2-3</td><td>Size</td><td>0xXX 0xXX</td></tr><tr><td>4-7</td><td>Checksum</td><td>0xXX 0xXX 0xXX 0xXX</td></tr><tr><td>8-11</td><td>Data Length</td><td>0xXX 0xXX 0xXX 0xXX（根据需要传输的数据量来定，无对齐要求）</td></tr><tr><td>12-15</td><td>Number</td><td>0xXX 0xXX 0xXX 0xXX（默认从0开始，每发送一个FLASH_DATA则加一，直到发送FLASH_END才清空）</td></tr><tr><td>16-23</td><td>NULL</td><td>0x0</td></tr><tr><td>24..n</td><td>Data To Write</td><td>需要发送的数据</td></tr></tbody></table><p>该指令会根据数据大小发送多次，每次该数据包的负载都是固定且不会特别巨大，避免因为数据错误导致重传浪费时间</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="flash_end"></a>FLASH_END<a class="hash-link" href="#flash_end" title="Direct link to heading">#</a></h5><table><thead><tr><th>Byte</th><th>Name</th><th>Data</th></tr></thead><tbody><tr><td>0</td><td>Direction</td><td>0x00</td></tr><tr><td>1</td><td>Command</td><td>0x04</td></tr><tr><td>2-3</td><td>Size</td><td>0xXX 0xXX</td></tr><tr><td>4-7</td><td>Checksum</td><td>0xXX 0xXX 0xXX 0xXX</td></tr><tr><td>8-11</td><td>Flag</td><td>根据需求发送，详见 指令列表</td></tr></tbody></table><p>该指令只需要发送一次，发送完成及表示数据发送完成</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="ram-下载"></a>RAM 下载<a class="hash-link" href="#ram-下载" title="Direct link to heading">#</a></h4><p>类似于FLASH下载，只是将FLASH_BEGIN、 FLASH_DATA、 FLASH_END换成MEM_BEGIN 、MEM_DATA、 MEM_END。</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="波特率切换"></a>波特率切换<a class="hash-link" href="#波特率切换" title="Direct link to heading">#</a></h5><table><thead><tr><th>Byte</th><th>Name</th><th>Data</th></tr></thead><tbody><tr><td>0</td><td>Direction</td><td>0x00</td></tr><tr><td>1</td><td>Command</td><td>0x0f</td></tr><tr><td>2-3</td><td>Size</td><td>0x00 0x10</td></tr><tr><td>4-7</td><td>Checksum</td><td>0xXX 0xXX 0xXX 0xXX</td></tr><tr><td>8-11</td><td>New</td><td>0xXX 0xXX 0xXX 0xXX（需要更改的波特率）</td></tr><tr><td>12-15</td><td>Old</td><td>0xXX 0xXX 0xXX 0xXX（当前波特率）</td></tr></tbody></table><p>切换波特率需要注意的地方在于，该指令的数据发送和接收都依旧采用老的波特率，所以上位机需要在下位机回应完成后再切换当前波特率。默认的通讯波特率是115200，最高可以切换到3Mb的波特率。</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="md5校验"></a>MD5校验<a class="hash-link" href="#md5校验" title="Direct link to heading">#</a></h5><table><thead><tr><th>Byte</th><th>Name</th><th>Data</th></tr></thead><tbody><tr><td>0</td><td>Direction</td><td>0x00</td></tr><tr><td>1</td><td>Command</td><td>0x13</td></tr><tr><td>2-3</td><td>Size</td><td>0x00 0x18</td></tr><tr><td>4-7</td><td>Checksum</td><td>0xXX 0xXX 0xXX 0xXX</td></tr><tr><td>8-11</td><td>Address</td><td>0xXX 0xXX 0xXX 0xXX（校验起始地址）</td></tr><tr><td>12-15</td><td>Size</td><td>0xXX 0xXX 0xXX 0xXX（需要校验的大小）</td></tr><tr><td>16-19</td><td>0</td><td>NULL</td></tr><tr><td>20-23</td><td>0</td><td>NULL</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="代理性能评估"></a>代理性能评估<a class="hash-link" href="#代理性能评估" title="Direct link to heading">#</a></h3><table><tr><th rowspan="3" align="center">含下载代理、无MD5校验</th><th align="center">波特率</th><th align="center">1M</th><th align="center">2M</th><th align="center">3M</th><th align="center">速度</th></tr><tr><th align="center">1536000</th><th align="center">24s</th><th align="center">42s</th><th align="center">60s</th><th align="center">21s/M</th></tr><tr><th align="center">3000000</th><th align="center">21s</th><th align="center">37s</th><th align="center">52s</th><th align="center">18.3s/M</th></tr><tr><th rowspan="2" align="center">测试同上，传输大小为8K一包</th><th align="center">1536000</th><th align="center">20s</th><th align="center">33s</th><th align="center">46s</th><th align="center">16.5s/M</th></tr><tr><th align="center">3000000</th><th align="center">20s</th><th align="center">34s</th><th align="center">46-47s</th><th align="center">16.6s/M</th></tr><tr><th rowspan="3" align="center">含下载代理、MD5校验</th><th align="center">波特率</th><th align="center">1M</th><th align="center">2M</th><th align="center">3M</th><th align="center">速度</th></tr><tr><th align="center">1536000</th><th align="center">25s</th><th align="center">43s</th><th align="center">61s</th><th align="center">21.5s/M</th></tr><tr><th align="center">3000000</th><th align="center">22s</th><th align="center">37s</th><th align="center">53s</th><th align="center">18.67s/M</th></tr><tr><th rowspan="2" align="center">测试同上，传输大小为8K一包</th><th align="center">1536000</th><th align="center"></th><th align="center"></th><th align="center">48s</th><th align="center"></th></tr><tr><th align="center">3000000</th><th align="center"></th><th align="center"></th><th align="center"></th><th align="center"></th></tr><tr><th rowspan="3" align="center">不含代理、无MD5校验</th><th align="center">波特率</th><th align="center">1M</th><th align="center">2M</th><th align="center">3M</th><th align="center">速度</th></tr><tr><th align="center">1536000</th><th align="center">19s</th><th align="center">36s</th><th align="center">54s</th><th align="center">18.17s/M</th></tr><tr><th align="center">3000000</th><th align="center">17s</th><th align="center">32s</th><th align="center">47s</th><th align="center">16s/M</th></tr><tr><th rowspan="2" align="center">测试同上，传输大小为8K一包</th><th align="center">1536000</th><th align="center"></th><th align="center"></th><th align="center">45s</th><th align="center">15s/M</th></tr><tr><th align="center">3000000</th><th align="center">16s</th><th align="center">29s</th><th align="center">42s</th><th align="center">14.5s/M</th></tr><tr><th rowspan="3" align="center">不含代理、有MD5校验</th><th align="center">波特率</th><th align="center">1M</th><th align="center">2M</th><th align="center">3M</th><th align="center">速度</th></tr><tr><th align="center">1536000</th><th align="center">20s</th><th align="center">37s</th><th align="center">55s</th><th align="center">18.67s/M</th></tr><tr><th align="center">3000000</th><th align="center">17s</th><th align="center">33s</th><th align="center">48s</th><th align="center">16.3s/M</th></tr><tr><th colspan="6" align="left">Note:3M波特率传输存在一定的不稳定性，会有重传现象，所以测量时间会有一定的波动</th></tr><tr><th colspan="6" align="left">当采用8K数据包的时候，明显下位机的烧录远远慢于传输，在传输flash end会有很长的时间去等待下位机去烧写数据</th></tr></table><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="参数"></a>参数<a class="hash-link" href="#参数" title="Direct link to heading">#</a></h3><p>代理程序内的数据通讯BUFFER大小参数，通讯数据包不能大于这个值</p><p>PROXY_UART_RX_MAX 16384 Bytes</p><p>ROM程序内的数据通讯BUFFER大小参数，通讯数据包不能大于这个值</p><p>ROM_UART_RX_MAX 2048 Bytes</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs-csk6/AIsolution/dsp/firmware_development/xr872_evs"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« 上位机固件二次开发</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs-csk6/AIsolution/dsp/firmware_development/software_material"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">开发资料下载 »</div></a></div></nav><div class="gitalk-wrapper"><ul class="gitalk-option"><li class="like"><i class="icon like-icon"></i> <span id="like_num">有帮助  0</span></li><li class="unlike"><i class="icon unlike-icon"></i> <span id="unlike_num">没帮助 0</span></li><li>文档反馈</li></ul></div></div></div><div class="col col--3" style="padding-left:0px"><div class="tableOfContents_k96L thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1ota文件说明" class="table-of-contents__link">1.OTA文件说明</a></li><li><a href="#2ota-业务流程" class="table-of-contents__link">2.OTA 业务流程</a></li><li><a href="#3如何在-iflyos-上配置ota文件" class="table-of-contents__link">3.如何在 iFLYOS 上配置OTA文件</a></li><li><a href="#4ota-sdk-使用说明" class="table-of-contents__link">4.OTA SDK 使用说明</a></li><li><a href="#5-ota协议" class="table-of-contents__link">5. OTA协议</a><ul><li><a href="#数据格式解析" class="table-of-contents__link">数据格式解析</a></li><li><a href="#传输过程" class="table-of-contents__link">传输过程</a></li><li><a href="#代理性能评估" class="table-of-contents__link">代理性能评估</a></li><li><a href="#参数" class="table-of-contents__link">参数</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 安徽聆思智能科技有限公司皖ICP备05001217号</div></div></div></footer></div>
<script src="/docs-csk6/assets/js/runtime~main.7fc13d81.js"></script>
<script src="/docs-csk6/assets/js/main.1f54c7f3.js"></script>
<script>!function(e,n,s,t,d){e[s]=e[s]||function(){(e[s].a=e[s].a||[]).push(arguments)},(d=n.createElement("script")).async=!0,d.src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js",n.body.appendChild(d)}(window,document,"simplemde")</script></body>
</html>