<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.2">
<title data-react-helmet="true">上位机固件二次开发 | 聆思文档中心</title><meta data-react-helmet="true" property="og:url" content="https://github.com/LISTENAI/docs-csk6/AIsolution/dsp/firmware_development/xr872_evs"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="上位机固件二次开发 | 聆思文档中心"><meta data-react-helmet="true" name="description" content="本文主要介绍离在线方案运行逻辑，帮助开发者快速理解方案架构。阅读本文后，你将了解到："><meta data-react-helmet="true" property="og:description" content="本文主要介绍离在线方案运行逻辑，帮助开发者快速理解方案架构。阅读本文后，你将了解到："><link data-react-helmet="true" rel="shortcut icon" href="/docs-csk6/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://github.com/LISTENAI/docs-csk6/AIsolution/dsp/firmware_development/xr872_evs"><link data-react-helmet="true" rel="alternate" href="https://github.com/LISTENAI/docs-csk6/AIsolution/dsp/firmware_development/xr872_evs" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://github.com/LISTENAI/docs-csk6/AIsolution/dsp/firmware_development/xr872_evs" hreflang="x-default"><link rel="stylesheet" href="/docs-csk6/assets/css/styles.888b750d.css">
<link rel="preload" href="/docs-csk6/assets/js/runtime~main.a2cc998b.js" as="script">
<link rel="preload" href="/docs-csk6/assets/js/main.d62623a6.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_vO2r">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" titleclassname="navbar__title" href="/docs-csk6/"><img src="/docs-csk6/img/logo_light.svg" alt="LSOpen Logo" class="themedImage_K3WP themedImage--light_Fy0T navbar__logo"><img src="/docs-csk6/img/logo_dark.svg" alt="LSOpen Logo" class="themedImage_K3WP themedImage--dark_V9oi navbar__logo"></a><a class="navbar__item navbar__link" href="/docs-csk6/chips/4002/Chip_information_4002">芯片</a><a class="navbar__item navbar__link" href="/docs-csk6/tools/LStudio">工具</a><a class="navbar__item navbar__link" href="/docs-csk6/AIsolution/ESR/Quick_start/Scheme_introduction">AI语音应用方案</a><a class="navbar__item navbar__link" href="/docs-csk6/Industrysolution/Scanning_pen/Scheme_introduction">行业Turnkey解决方案</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs-csk6/FAQ/faq">FAQ</a><a class="navbar__item navbar__link" href="/docs-csk6/school/school">视频课程</a><a class="navbar__item navbar__link" href="/docs-csk6/workorder/workorder">工单</a><div class="react-toggle displayOnlyInLargeViewport_a-w0 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_8pH0"><img src="/docs-csk6/img/light.svg" alt="" class="themedImage_K3WP themedImage--light_Fy0T"><img src="/docs-csk6/img/unlight.svg" alt="" class="themedImage_K3WP themedImage--dark_V9oi"></span></div><div class="react-toggle-track-x"><span class="toggle_8pH0"><img src="/docs-csk6/img/undark.svg" alt="" class="themedImage_K3WP themedImage--light_Fy0T"><img src="/docs-csk6/img/dark.svg" alt="" class="themedImage_K3WP themedImage--dark_V9oi"></span></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="navbar__search searchBarContainer_I7kZ"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_Zg7X searchBarLoadingRing_J5Ez"><div></div><div></div><div></div><div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" titleclassname="navbar__title" href="/docs-csk6/"><img src="/docs-csk6/img/logo_light.svg" alt="LSOpen Logo" class="themedImage_K3WP themedImage--light_Fy0T navbar__logo"><img src="/docs-csk6/img/logo_dark.svg" alt="LSOpen Logo" class="themedImage_K3WP themedImage--dark_V9oi navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/chips/4002/Chip_information_4002">芯片</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/tools/LStudio">工具</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/AIsolution/ESR/Quick_start/Scheme_introduction">AI语音应用方案</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/Industrysolution/Scanning_pen/Scheme_introduction">行业Turnkey解决方案</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/FAQ/faq">FAQ</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/school/school">视频课程</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/workorder/workorder">工单</a></li></ul></div></div></div></nav><nav class="navbar subnavbar--fixed-top sub-navbar"><div class="navbar__inner subnavbar__inner"><div class="navbar__items"><a class="subnavbar__item subnavbar__link" dirname="/AIsolution" href="/docs-csk6/AIsolution/ESR/Quick_start/Scheme_introduction">离线语音</a><a aria-current="page" class="subnavbar__item subnavbar__link subnavbar__link--active" dirname="/AIsolution" href="/docs-csk6/AIsolution/dsp/readme">离在线语音</a></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_Ol8-"><aside class="docSidebarContainer_UfDv"><div class="sidebar_OMtR"><nav class="menu menu--responsive thin-scrollbar menu_2y2e menuWithAnnouncementBar_Lwkw" aria-label="Sidebar navigation"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_IcOF" width="24" height="24" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/AIsolution/dsp/readme">概览</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--first menu__link--sublist" type="first" href="#!">快速入门</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/AIsolution/dsp/Quick_start/developer_guides">方案介绍</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/AIsolution/dsp/Quick_start/getting_start">快速体验</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--first menu__link--sublist" type="first" href="#!">硬件设计</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/AIsolution/dsp/Hardwaredevelopment/hardware_guide">硬件参考设计</a></li></ul></li><li class="menu__list-item menu__list-item--current"><a class="menu__link menu__link--first menu__link--sublist menu__link--active" type="first" href="#!">固件开发</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs-csk6/AIsolution/dsp/firmware_development/CSK_online_firmware">制作离在线项目的CSK固件</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs-csk6/AIsolution/dsp/firmware_development/Create_iFLYOS_equipment">创建你的 iFLYOS 设备</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs-csk6/AIsolution/dsp/firmware_development/xr872_evs">上位机固件二次开发</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs-csk6/AIsolution/dsp/firmware_development/OTA_service">OTA开发</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs-csk6/AIsolution/dsp/firmware_development/software_material">开发资料下载</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--first menu__link--sublist" type="first" href="#!">云端开发</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/AIsolution/dsp/cloud_development/Custom_skills">自定义技能实现</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/AIsolution/dsp/cloud_development/iot">智能家居服务</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--first menu__link--sublist" type="first" href="#!">FAQ</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/AIsolution/dsp/FAQ/faq">常见问题</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_dRYS"><div class="container padding-top--md padding-bottom--lg center-container"><div class="row"><div class="col docItemCol_+xOG"><div class="docItemContainer_c+5G"><article><div class="markdown"><header><h1 class="h1Heading_5RMM">上位机固件二次开发</h1></header><blockquote><p>本文主要介绍离在线方案运行逻辑，帮助开发者快速理解方案架构。阅读本文后，你将了解到：</p><p>1.了解 XR872AT 的开发环境编译与配置；</p><p>2.了解上位机固件的业务源码结构；</p><p>3.如何自定义 Client_id、OTA_SECRET、AP热点前缀、按键、灯光、本地TTS；</p><p>4.如何在完成二次开发后进行验证；</p></blockquote><div class="admonition admonition-important alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</h5></div><div class="admonition-content"><p>需要注意的是，本文档只针对云端接入 iFLYOS 的产品，若开发者对接其他的云端操作系统，该文档并不适用。</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="1xr872at-开发环境配置"></a>1.XR872AT 开发环境配置<a class="hash-link" href="#1xr872at-开发环境配置" title="Direct link to heading">#</a></h2><p>在进入二次开发之前，可先了解 XR872AT 的固件开发环境与编译方法，方便你在进行二次开发后，编译自己的固件产物。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="开发环境搭建"></a>开发环境搭建<a class="hash-link" href="#开发环境搭建" title="Direct link to heading">#</a></h3><ul><li>详细内容见<a href="https://docs.xradiotech.com/zh/latest/download/4.SDK/document/XRADIO_Quick_Start_Guide-CN.pdf" target="_blank" rel="noopener noreferrer">XRADIO_Quick_Start_Guide-CN.pdf</a> 1.1、1.2、1.3章节</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="编译工具链地址"></a>编译工具链地址<a class="hash-link" href="#编译工具链地址" title="Direct link to heading">#</a></h3><ul><li>Windows版本<ul><li>链接： <a href="https://pan.baidu.com/s/1Ugs8lRApyA3ONs91yXOWbg" target="_blank" rel="noopener noreferrer">https://pan.baidu.com/s/1Ugs8lRApyA3ONs91yXOWbg</a></li><li>提取码：w4gr</li></ul></li><li>Linux版本<ul><li>链接： <a href="https://pan.baidu.com/s/1BsnmhgXx2zZjIVtJ49ICYQ" target="_blank" rel="noopener noreferrer">https://pan.baidu.com/s/1BsnmhgXx2zZjIVtJ49ICYQ</a></li><li>提取码：z45o</li></ul></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="快速编译"></a>快速编译<a class="hash-link" href="#快速编译" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="编译"></a>编译<a class="hash-link" href="#编译" title="Direct link to heading">#</a></h4><ul><li>详细内容见<a href="https://docs.xradiotech.com/zh/latest/download/4.SDK/document/XRADIO_Quick_Start_Guide-CN.pdf" target="_blank" rel="noopener noreferrer">XRADIO_Quick_Start_Guide-CN.pdf</a> 2章节sdk编译</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="编译示例"></a>编译示例<a class="hash-link" href="#编译示例" title="Direct link to heading">#</a></h4><ul><li><p>对 &quot;listenai_castor_xr872&quot; 工程进行代码编译和镜像创建的常规过程，举例如下：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 切换到工程编译目录</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ cd project</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">listenai_castor_xr872</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">gcc</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 执行 SDK 基础配置， 选择芯片型号为“XR872”， 高频晶振为“</span><span class="token number" style="color:rgb(181, 206, 168)">40</span><span class="token plain">M”</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ make config</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">XRADIO SDK Configuration</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">C</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">hip</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">1.</span><span class="token plain"> XR872</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">2.</span><span class="token plain"> XR808</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">choice</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">External high speed crystal oscillator</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">1.</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">24</span><span class="token plain">M</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">2.</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">26</span><span class="token plain">M</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">3.</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">40</span><span class="token plain">M</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">choice</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 删除所有 SDK 编译中间文件</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 该命令为可选命令。 如果没有修改编译选项， 也没有切换工程目录， 可不执行该命令。</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ make build_clean</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 编译代码并生成镜像文件</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 生成的镜像文件为“project</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">listenai_castor_xr872</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">image</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">xr872</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">xr_system</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">img”</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ make build</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="编译路径和固件路径"></a>编译路径和固件路径<a class="hash-link" href="#编译路径和固件路径" title="Direct link to heading">#</a></h4><ul><li><p>编译目录和生成img文件目录如下所示</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token plain">├── bin</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">├── chip</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">mk</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">├── gcc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">mk</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">├── include</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">├── lib</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">├── project</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── listenai_castor_xr872</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   │   ├── gcc                     # 编译目录</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   │   ├── image</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   │   │   ├── xr872</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   │   │   │   ├── xr_system</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">img   # 编译后生成img文件</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   │   │   │   ├── </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   │   │   ├── </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   │   ├── </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">├── src</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">├── </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">├── tools</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="2业务源码说明"></a>2.业务源码说明<a class="hash-link" href="#2业务源码说明" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="evs源码路径"></a>evs源码路径<a class="hash-link" href="#evs源码路径" title="Direct link to heading">#</a></h3><ul><li><code>/project/listenai_castor_xr872/listenai_sdk/modules/listenai_evs</code></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="目录结构"></a>目录结构<a class="hash-link" href="#目录结构" title="Direct link to heading">#</a></h3><ul><li>代码目录结构及说明</li></ul><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token plain">├── listenai_evs</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_alertplayer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">c       </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_alertplayer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h       </span><span class="token comment" style="color:rgb(106, 153, 85)">// 云端闹钟播放管理，解析和播放下发的RING类型的audio_out指令</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_aplinker</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">c</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_aplinker</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h          </span><span class="token comment" style="color:rgb(106, 153, 85)">// AP配网模块</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_audiomgr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">c</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_audiomgr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h          </span><span class="token comment" style="color:rgb(106, 153, 85)">// 焦点管理模块，负责维护音乐、tts、本地提示音、闹钟、识别焦点</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_audioplayer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">c</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_audioplayer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h       </span><span class="token comment" style="color:rgb(106, 153, 85)">// 音乐播放管理，解析和播放云端下发的PLAYBACK类型audio_out指令</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_audiorecorder</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">c</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_audiorecorder</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h     </span><span class="token comment" style="color:rgb(106, 153, 85)">// 录音模块以及唤醒结果回调</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_auth</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">c</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_auth</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h              </span><span class="token comment" style="color:rgb(106, 153, 85)">// evs认证模块</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_capaudioplayer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">c</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_capaudioplayer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h    </span><span class="token comment" style="color:rgb(106, 153, 85)">// 解析分发云端下发的audio_out指令</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">c</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h            </span><span class="token comment" style="color:rgb(106, 153, 85)">// 负责唤醒事件处理，各个模块初始化，websocket链接维护</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_event</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">c             </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_event</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h             </span><span class="token comment" style="color:rgb(106, 153, 85)">// 消息队列，负责消息分发管理</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_flash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">c</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_flash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h             </span><span class="token comment" style="color:rgb(106, 153, 85)">// 持久化接口</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h               </span><span class="token comment" style="color:rgb(106, 153, 85)">// 日志工具</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_interceptor</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">c</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_interceptor</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h       </span><span class="token comment" style="color:rgb(106, 153, 85)">// 负责处理按键事件，网络连接管理，evs最外层入口</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_mediaplayer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">c   </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_mediaplayer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h       </span><span class="token comment" style="color:rgb(106, 153, 85)">// 负责适配底层播放器，供evs_audioplayer使用</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_netmonitor</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">c</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_netmonitor</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h        </span><span class="token comment" style="color:rgb(106, 153, 85)">// 网络检测模块</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_opts</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h              </span><span class="token comment" style="color:rgb(106, 153, 85)">// client_id配置项</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_ota</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">c</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_ota</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h               </span><span class="token comment" style="color:rgb(106, 153, 85)">// ota模块</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_pref</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">c</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_pref</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h              </span><span class="token comment" style="color:rgb(106, 153, 85)">// 持久化工具，</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_recognizer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">c</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_recognizer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h        </span><span class="token comment" style="color:rgb(106, 153, 85)">// 识别模块，负责处理语音和文本请求</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_response</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">c           </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_response</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h          </span><span class="token comment" style="color:rgb(106, 153, 85)">// 解析云端下发消息</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_shortplayer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">c       </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_shortplayer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h       </span><span class="token comment" style="color:rgb(106, 153, 85)">// 短提示音播放管理，只用来播放唤醒提示音</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_soundplayer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">c</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_soundplayer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h       </span><span class="token comment" style="color:rgb(106, 153, 85)">// 本地提示音播放管理</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_speaker</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">c</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_speaker</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h           </span><span class="token comment" style="color:rgb(106, 153, 85)">// 音量调节模块，处理本地和云端音量调节</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_system</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">c</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_system</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h            </span><span class="token comment" style="color:rgb(106, 153, 85)">// 系统相关，负责云端链接心跳维护、状态同步、时间同步</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_time</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">c</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_time</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h              </span><span class="token comment" style="color:rgb(106, 153, 85)">// 时间同步模块</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_timer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">c</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_timer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h             </span><span class="token comment" style="color:rgb(106, 153, 85)">// 计时器工具</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_tone</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">c</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_tone</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h              </span><span class="token comment" style="color:rgb(106, 153, 85)">// 获取本地提示音工具</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_ttsplayer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">c</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_ttsplayer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h         </span><span class="token comment" style="color:rgb(106, 153, 85)">// tts播放管理，解析和播放下发的TTS类型的audio_out指令</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_utils</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">c</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_utils</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h             </span><span class="token comment" style="color:rgb(106, 153, 85)">// 内存池和消息队列工具</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_uuid</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">c</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_uuid</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h              </span><span class="token comment" style="color:rgb(106, 153, 85)">// UUID生成工具</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_websocket</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">c</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_websocket</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h         </span><span class="token comment" style="color:rgb(106, 153, 85)">// 云端websocket链接</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_wifimgr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">c</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── evs_wifimgr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h           </span><span class="token comment" style="color:rgb(106, 153, 85)">// wifi管理工具</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="evs协议地址"></a>evs协议地址<a class="hash-link" href="#evs协议地址" title="Direct link to heading">#</a></h3><ul><li><a href="https://doc.iflyos.cn/device/evs/reference/recognizer.html#context" target="_blank" rel="noopener noreferrer">https://doc.iflyos.cn/device/evs/reference/recognizer.html#context</a></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="3更换-client_id-ota_secret"></a>3.更换 Client_id 、OTA_SECRET<a class="hash-link" href="#3更换-client_id-ota_secret" title="Direct link to heading">#</a></h2><p>当你在 iFLYOS 设备接入平台创建自己的设备后，会获取属于该设备的 <code>Client_id</code>。<code>Client_id</code> 将会被 iFLYOS 用于判定设备型号，一个型号的设备都会使用相同的 <code>Client_id</code>。在二次开发前，你需要替换掉上位机固件中的默认 <code>Client_id</code> 。替换后，你在 iFLYOS 平台中的个性化配置将会在固件端生效。修改方式如下：</p><ul><li>更改 <code>project/listenai_castor_xr872/listenai_sdk/modules/listenai_evs/evs_opts.h</code> 中 <code>Client_id</code> 宏定义。</li><li>更换 <code>Client_id</code> 后，还需要更换对应的 <code>OTA_SECRET</code>，该字段主要用于固件OTA时的校验，可在【设备能力】-【自动更新】-【加密密钥】中获取。与 <code>Client_id</code> 在同一文件中，对应宏定义为  <code>OTA_SECRET</code>。</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="4修改热点前缀"></a>4.修改热点前缀<a class="hash-link" href="#4修改热点前缀" title="Direct link to heading">#</a></h2><p>在修改热点前缀之前，请先了解<a href="https://doc.iflyos.cn/device/network/ap.html#ap-%E9%85%8D%E7%BD%91" target="_blank" rel="noopener noreferrer"> AP 配网流程</a>。</p><p>若你希望自定义热点前缀名，可按照如下步骤操作：</p><p>第一步，在 iFLYOS 平台的【设备能力】-【热点配网】-【 Wi-Fi 】热点前缀处修改，在此处修改并保存后，小飞在线 APP 端将实时生效。配网时，APP 端将根据你在 iFLYOS 平台设置的前缀寻找热点并连接。</p><p><img src="/docs-csk6/assets/images/AP_CONECCT-08943fb14ab9cd223a7faf2c0d753e8c.png"></p><p>第二步，在固件代码中修改前缀 ，位于 <code>evs_netconfig.c</code>，如下。修改完成并烧录固件后，设备进入配网模式，广播时的热点前缀将变为自定义前缀。</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">evs_net_config_begin</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name" style="color:rgb(78, 201, 176)">evs_net_config_t</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">handle</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_is_config </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_wifi_connect </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> false</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_client</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_is_configing </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_link_ssid</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token char" style="color:rgb(209, 105, 105)">&#x27;\0&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_link_pwd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token char" style="color:rgb(209, 105, 105)">&#x27;\0&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_link_usr_code</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token char" style="color:rgb(209, 105, 105)">&#x27;\0&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_refresh_token</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token char" style="color:rgb(209, 105, 105)">&#x27;\0&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// 前缀修改</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">char</span><span class="token plain"> ap_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">7</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;LA_&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">char</span><span class="token plain"> device_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">65</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">strcpy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">device_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">evs_client_get_deviceid</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> pos </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">strlen</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">device_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">strncpy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">ap_name </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> device_id </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> pos</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ap_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">6</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token char" style="color:rgb(209, 105, 105)">&#x27;\0&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// 修改前缀示例</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// char ap_name[9] = &quot;LISA_&quot;;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// char device_id[65];</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// strcpy(device_id, evs_client_get_deviceid());</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// int pos = strlen(device_id) - 3;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// strncpy(ap_name + 5, device_id + pos, 3);</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// ap_name[8] = &#x27;\0&#x27;;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">evs_aplinker_stop_link</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_ap_linker</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">evs_timer_stop</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_accept_timer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">evs_timer_stop</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_data_timer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">evs_timer_stop</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_reconnect_timer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">evs_timer_set_timeout</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_accept_timer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> _on_accept_time_out</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> AP_LINKER_ACCEPT_TIMEOUT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">evs_soundplayer_play</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_sound_player</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">get_tone_url</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">TONE_ID_8</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">evs_client_stop</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_wifi_mgr</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">wifi_disconnect</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">evs_aplinker_start_link</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_ap_linker</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> ap_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="5自定义按键"></a>5.自定义按键<a class="hash-link" href="#5自定义按键" title="Direct link to heading">#</a></h2><p>CSK 离在线开发套件中已配备四个功能按键和一个硬件控制复位按键，四个功能按键分别是禁麦|开麦、音量+、音量-、播放|暂停。开发者可根据自身产品需求，自定义按键功能。支持单按键与组合键触发，触发方式包括单击与长按。</p><p>1、按键事件注册入口 <code>evs_interceptor.c</code></p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token class-name" style="color:rgb(78, 201, 176)">evs_interceptor_t</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">evs_interceptor_create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token class-name" style="color:rgb(78, 201, 176)">evs_interceptor_t</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">handle </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name" style="color:rgb(78, 201, 176)">evs_interceptor_t</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token function" style="color:rgb(220, 220, 170)">evs_calloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">sizeof</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name" style="color:rgb(78, 201, 176)">evs_interceptor_t</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">evs_time_init</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_led_mgr </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">  </span><span class="token function" style="color:rgb(220, 220, 170)">evs_led_mgr_create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_client </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">evs_client_create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">evs_handler_set_handler</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">_handle_msg</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">evs_set_key_callback</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">_on_key_down</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> _on_key_long_press</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token comment" style="color:rgb(106, 153, 85)">// 按键事件注册入口</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_sound_player </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">evs_client_get_soundplayer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_speaker </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">evs_client_get_speaker</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_audio_player </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">evs_client_get_audioplayer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_tts_player </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">evs_client_get_ttsplayer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_alert_player </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">evs_client_get_alertplayer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_recognizer </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">evs_client_get_recognizer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_net_config </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">evs_net_config_create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_sound_player</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    s_interceptor </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> handle</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> handle</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><p>2、按键事件定义 <code>evs_key_event.h</code></p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">typedef</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">enum</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">_KEY_EVENT</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    KEY_VOL_DOWN </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">//音量减事件</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    KEY_VOL_UP</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">//音量加事件</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    KEY_PLAY</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">//播放按键事件</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    KEY_MUTE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">//MUTE键事件</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    KEY_MUTE_VOL_UP</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token comment" style="color:rgb(106, 153, 85)">// 目前定义的组合按键，同时按下MUTE和音量加</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    KEY_MUTE_VOL_DOWN </span><span class="token comment" style="color:rgb(106, 153, 85)">// 目前定义的组合按键，同时按下MUTE和音量减</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> KEY_EVENT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// 短按事件回调接口</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">typedef</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">key_press_callback</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">KEY_EVENT event</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// 事件回调接口</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">typedef</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">key_longpress_callback</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">KEY_EVENT event</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><p>3、驱动层实现 <strong>evs_key_event.c</strong></p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">extern</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">listenai_key_callback</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">key_press_callback pressCb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> key_longpress_callback longPressCb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token comment" style="color:rgb(106, 153, 85)">//驱动层需要实现此函数，通过pressCb回调对应的短按事件，通过longPressCb回调对应的长按事件</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="6自定义灯光"></a>6.自定义灯光<a class="hash-link" href="#6自定义灯光" title="Direct link to heading">#</a></h2><p>在产品实际使用过程中，上电、配网、语音交互等业务逻辑都会以灯光的形式提示用户，合适的灯光提示对于智能语音设备来说不可或缺。</p><p>1、灯光焦点管理模块</p><p>固件端根据用户使用产检，设计并维护了一套灯光焦点管理模块，该模块主要负责维护所有灯光的开关，创建、销毁、灯光优先级管理、灯光的打断恢复。</p><p>具体代码说明如下：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// 灯光焦点管理模块初始化，如果要屏蔽灯光模块，请在此方法第一行return NULL;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name" style="color:rgb(78, 201, 176)">evs_led_mgr_t</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">evs_led_mgr_create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> ret </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">disp_i2c_init</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token comment" style="color:rgb(106, 153, 85)">//灯光驱动初始化</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">ret </span><span class="token operator" style="color:rgb(212, 212, 212)">!=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">NULL</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">led_init</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token comment" style="color:rgb(106, 153, 85)">//灯光具体效果初始化</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token class-name" style="color:rgb(78, 201, 176)">evs_led_mgr_t</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> handle </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">evs_calloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">sizeof</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name" style="color:rgb(78, 201, 176)">evs_led_mgr_t</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// led_ctrl(LED3_MASK, LED_ON, 0xff0000);</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_lights</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">LED_ALARM</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name" style="color:rgb(78, 201, 176)">base_light_t</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token function" style="color:rgb(220, 220, 170)">alarm_light_create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">_on_light_close</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_lights</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">LED_BOOT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name" style="color:rgb(78, 201, 176)">base_light_t</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token function" style="color:rgb(220, 220, 170)">boot_light_create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">_on_light_close</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_lights</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">LED_BOOTED</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name" style="color:rgb(78, 201, 176)">base_light_t</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token function" style="color:rgb(220, 220, 170)">booted_light_create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">_on_light_close</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_lights</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">LED_NET_WAIT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name" style="color:rgb(78, 201, 176)">base_light_t</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token function" style="color:rgb(220, 220, 170)">net_wait_light_create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">_on_light_close</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_lights</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">LED_NET_SUCCESS</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name" style="color:rgb(78, 201, 176)">base_light_t</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token function" style="color:rgb(220, 220, 170)">net_success_light_create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">_on_light_close</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_lights</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">LED_UPDATING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name" style="color:rgb(78, 201, 176)">base_light_t</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token function" style="color:rgb(220, 220, 170)">updating_light_create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">_on_light_close</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_lights</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">LDE_UPDATE_SUCCESS</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name" style="color:rgb(78, 201, 176)">base_light_t</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token function" style="color:rgb(220, 220, 170)">update_success_light_create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">_on_light_close</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_lights</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">LED_UPDATE_FAILED</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name" style="color:rgb(78, 201, 176)">base_light_t</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token function" style="color:rgb(220, 220, 170)">update_failed_light_create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">_on_light_close</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_lights</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">LED_NET_DISCONNECT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name" style="color:rgb(78, 201, 176)">base_light_t</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token function" style="color:rgb(220, 220, 170)">net_disconn_light_create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">_on_light_close</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_lights</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">LED_SYSTEM_ERROR</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name" style="color:rgb(78, 201, 176)">base_light_t</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token function" style="color:rgb(220, 220, 170)">error_light_create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">_on_light_close</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_lights</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">LED_MIC</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name" style="color:rgb(78, 201, 176)">base_light_t</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token function" style="color:rgb(220, 220, 170)">mic_light_create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">_on_light_close</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_lights</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">LED_VOL</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name" style="color:rgb(78, 201, 176)">base_light_t</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token function" style="color:rgb(220, 220, 170)">vol_light_create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">_on_light_close</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_lights</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">LED_LISTENING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name" style="color:rgb(78, 201, 176)">base_light_t</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token function" style="color:rgb(220, 220, 170)">listening_light_create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">_on_light_close</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_lights</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">LED_THINKING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name" style="color:rgb(78, 201, 176)">base_light_t</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token function" style="color:rgb(220, 220, 170)">thinking_light_create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">_on_light_close</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    handle</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">m_lights</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">LED_SPEAKING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name" style="color:rgb(78, 201, 176)">base_light_t</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token function" style="color:rgb(220, 220, 170)">speaking_light_create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">_on_light_close</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    s_led_mgr </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> handle</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> handle</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><ul><li><p>灯光开启关闭</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// 在evs_event线程中使用</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">evs_led_open_light</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">led_type_e type</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token comment" style="color:rgb(106, 153, 85)">//灯光开启方法</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">evs_led_close_light</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">led_type_e type</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token comment" style="color:rgb(106, 153, 85)">//灯光关闭方法</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">evs_led_close_all_light</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token comment" style="color:rgb(106, 153, 85)">//关闭全部灯光</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div></li><li><p>灯光类型定义，位于 evs_ledtype.h</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">typedef</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">enum</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      LED_ALARM </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">// 闹钟灯光</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      LED_BOOT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">             </span><span class="token comment" style="color:rgb(106, 153, 85)">// 开机灯光</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      LED_BOOTED</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">           </span><span class="token comment" style="color:rgb(106, 153, 85)">// 开机完成灯光</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      LED_NET_WAIT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">         </span><span class="token comment" style="color:rgb(106, 153, 85)">// 开始配网</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      LED_NET_SUCCESS</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">      </span><span class="token comment" style="color:rgb(106, 153, 85)">// 联网成功</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      LED_UPDATING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">         </span><span class="token comment" style="color:rgb(106, 153, 85)">// 升级灯光</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      LDE_UPDATE_SUCCESS</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">   </span><span class="token comment" style="color:rgb(106, 153, 85)">// 升级成功灯光</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      LED_UPDATE_FAILED</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// 升级失败</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      LED_NET_DISCONNECT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">   </span><span class="token comment" style="color:rgb(106, 153, 85)">// 网络断开</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      LED_SYSTEM_ERROR</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">     </span><span class="token comment" style="color:rgb(106, 153, 85)">// 系统错误</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      LED_MIC</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">              </span><span class="token comment" style="color:rgb(106, 153, 85)">// MUTE灯光</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      LED_VOL</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">              </span><span class="token comment" style="color:rgb(106, 153, 85)">// 音量调整灯光</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      LED_LISTENING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">// listening灯光</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      LED_THINKING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">         </span><span class="token comment" style="color:rgb(106, 153, 85)">// thinking灯光</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      LED_SPEAKING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">         </span><span class="token comment" style="color:rgb(106, 153, 85)">// speaking灯光</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      LED_COUNT             </span><span class="token comment" style="color:rgb(106, 153, 85)">//灯光总数，保证在此枚举最后一个位置</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> led_type_e</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div></li></ul><p>2、具体灯光实现</p><ul><li><p>灯光基类 <code>base_light.h</code></p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">typedef</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">base_light_s</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">open</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">             </span><span class="token comment" style="color:rgb(106, 153, 85)">// 开灯</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">close</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">            </span><span class="token comment" style="color:rgb(106, 153, 85)">// 关灯</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">led_type_e</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">get_type</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">   </span><span class="token comment" style="color:rgb(106, 153, 85)">// 获取灯光类型</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">get_priority</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">      </span><span class="token comment" style="color:rgb(106, 153, 85)">// 获取灯光优先级</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">pause</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">            </span><span class="token comment" style="color:rgb(106, 153, 85)">// 暂停，根据需求实现，部分灯光需要暂停</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">resume</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">           </span><span class="token comment" style="color:rgb(106, 153, 85)">// 恢复</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">restart</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">          </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">bool</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">need_pause</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">led_type_e type</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 是否支持暂停</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    light_close_callback m_close_cb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// 灯光关闭回调</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    light_state_e m_state</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">      </span><span class="token comment" style="color:rgb(106, 153, 85)">// 灯光状态</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">base_light_t</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div></li><li><p>具体灯效实现，具体的灯光效果在以下文件里 <code>open close</code> 方法实现</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token plain">├── listenai_led</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── alarm_light</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── base_light</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── boot_light</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">h</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="7自定义本地tts"></a>7.自定义本地TTS<a class="hash-link" href="#7自定义本地tts" title="Direct link to heading">#</a></h2><p>固件中预置了表示设备状态的TTS，包括联网成功|失败、断网、开|禁麦等状态的的提示音，开发者可根据自己的产品自行定义 TTS 内容。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="生成tts文件"></a>生成TTS文件<a class="hash-link" href="#生成tts文件" title="Direct link to heading">#</a></h3><p>在 iFLYOS 的【设备能力】页面找到【语音输出】，可在此处试听并生成对应的TTS，如下图：</p><p><img src="/docs-csk6/assets/images/iFLYOS_tts-aa7a6eb101817c2f332f01585e5c7fce.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="tts文件说明"></a>TTS文件说明<a class="hash-link" href="#tts文件说明" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="提示音打包工具"></a>提示音打包工具<a class="hash-link" href="#提示音打包工具" title="Direct link to heading">#</a></h4><ul><li>Windows版本 <strong>tone_tool.exe</strong></li><li>Linux版本 <strong>tone_tool</strong></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="提示音打包工具源码"></a>提示音打包工具源码<a class="hash-link" href="#提示音打包工具源码" title="Direct link to heading">#</a></h4><p>Windows版本和Linux版本提示音打包工具源码均为<strong>main.c</strong>。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="打包工具说明"></a>打包工具说明<a class="hash-link" href="#打包工具说明" title="Direct link to heading">#</a></h4><ul><li>Windows版本<ul><li><strong>.\tone_tool.exe  XXXX</strong>(提示音文件夹路径)</li><li>示例： <strong>.\tone_tool.exe .\ring\</strong></li><li>如编译失败请将<strong>dirent.h</strong>替换，<strong>dirent.h</strong>下载链接和替换说明见<a href="https://github.com/tronkko/dirent" target="_blank" rel="noopener noreferrer">https://github.com/tronkko/dirent</a></li></ul></li><li>Linux版本<ul><li><strong>./tone_tool XXXX</strong>(提示音文件夹路径)</li><li>示例：<strong>./tone_tool ring/</strong></li></ul></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="打包生成bin文件和h文件说明"></a>打包生成bin文件和.h文件说明<a class="hash-link" href="#打包生成bin文件和h文件说明" title="Direct link to heading">#</a></h4><p>生成bin文件和.h文件在提示音文件夹目录下</p><ul><li><p>生成bin文件 <strong>XXXX/tone.bin</strong> </p></li><li><p>生成.h文件 <strong>XXXX/tone.h</strong></p><p>头文件中枚举值和提示音文件一一对应，例如<strong>TONE_ID_0 = 0,// 000_sound_effect_ui_volume.mp3</strong>，</p><p><strong>TONE_ID_0 = 0</strong>为枚举值，注释内容为对应的音频文件</p></li><li><p>固件默认音频文件说明：</p></li></ul><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv c"><pre tabindex="0" class="prism-code language-c codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token plain">TONE_ID_0 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 000_sound_effect_ui_volume.mp3 音量调节提示音</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">TONE_ID_1 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 001_sound_effect_ui_wakesound_1.wav 唤醒提示tts：”嗯“</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">TONE_ID_2 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 002_sound_effect_ui_wakesound_2.wav 唤醒提示tts：”嗯哼“</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">TONE_ID_3 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 003_sound_effect_ui_wakesound_3.wav 唤醒提示tts：”我在“</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">TONE_ID_4 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">4</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 004_sound_effect_ui_wakesound_4.wav 唤醒提示tts：”在呢“</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">TONE_ID_5 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 005_tts_state_is_ready.mp3 开机欢迎语：”嗨，欢迎使用iFLYOS设备，请按照说明书的提示，为我连接互联网，和我一起前往未来世界吧“ </span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">TONE_ID_6 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">6</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 006_tts_state_microphone_off.mp3 禁用麦克风：”麦克风已禁用“</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">TONE_ID_7 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">7</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 007_tts_state_microphone_on.mp3 启用麦克风：”麦克风已打开“</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">TONE_ID_8 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">8</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 008_tts_state_network_mode_on.mp3 进入配网模式：”进入网络配置模式，请打开APP按照流程指引设置网络“</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">TONE_ID_9 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">9</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 009_tts_state_upgrade_ready.mp3 检测到可用更新：”检测到可用更新，“</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">TONE_ID_10 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 010_tts_state_upgrade_retry.mp3 设备升级失败：“设备升级失败，请重试”</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">TONE_ID_11 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">11</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 011_tts_state_upgraded.mp3 设备升级成功：“升级成功，久等啦”</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">TONE_ID_12 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">12</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 012_tts_state_upgrading.mp3 OTA时唤醒设备，目前未使用，可忽略</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">TONE_ID_13 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">13</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 013_tts_system_boot_in_preparation.mp3 未配网时唤醒设备：“请打开APP按照流程指引设置网络”</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">TONE_ID_14 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">14</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 014_tts_system_network_connected.mp3 联网成功：”联网成功，你可以对小辛巴说：来点音乐“</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">TONE_ID_15 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 015_tts_system_network_connecting.mp3 正在联网：”收到密码，我正在努力联网“</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">TONE_ID_16 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">16</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 016_tts_system_network_disconnected.mp3 设备断开WiF连接：”哎呀，我断网了，请打开APP重新帮我配网“ </span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">TONE_ID_17 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 017_tts_system_network_fail_1.mp3 配网失败：”网络配置失败，请重试“</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">TONE_ID_18 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">18</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 018_tts_system_network_fail_2.mp3 已连WiFi，但无法访问互联网：”网络好像有点问题，检测一下网络吧“</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">TONE_ID_19 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">19</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 019_tts_system_network_fail_3.mp3 弱网、请求云端超时：”网络好像有点问题，检测一下网络吧“</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">TONE_ID_20 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">20</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 020_tts_system_network_wrong_password.mp3 配网时WiFi密码错误：”WiFi密码好像不对，修改后再来尝试吧“</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">TONE_ID_21 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">21</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 021_tts_system_token_fail.mp3 设备token失效：“登录状态失效，请打开APP重新登录”</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">TONE_ID_22 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">22</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 022_sound_effect_ui_boot.mp3 开机音效</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">TONE_ID_23 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">23</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 023_record_test.mp3 产测相关</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">TONE_ID_24 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">24</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 024_off_line_mode.mp3 “切换至离线模式”</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">TONE_ID_25 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">25</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 025_online_mode.mp3 “切换至在线模式”</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">TONE_ID_26 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">26</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 026_tts_state_wakeword_ready.mp3 唤醒词更换：”正在更换唤醒词“</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">TONE_ID_27 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">27</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 027_tts_state_wakeword_retry.mp3 更换唤醒词失败：”唤醒词更换失败，请重试“</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">TONE_ID_28 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">28</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 028_tts_state_wakeword_upgrade.mp3 更换唤醒词成功：”唤醒词更换成功“   </span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">TONE_ID_29 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">29</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 029_music_not_found.mp3 咪咕音乐兜底tts：该歌曲暂时无法播放，换一个试试吧（若设备未使用咪咕音乐，可忽略该TTS）</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">TONE_ID_30 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">30</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 030_db0.mp3 产测相关</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">TONE_ID_31 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">31</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 031_db-3.mp3 产测相关</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">TONE_ID_32 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">32</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 032_tingyin.mp3 产测相关</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="bin文件替换"></a>bin文件替换<a class="hash-link" href="#bin文件替换" title="Direct link to heading">#</a></h4><p>将生成的<strong>tone.bin</strong>文件放到 <code>project\listenai_castor_xr872\image\xr872</code> 文件夹下，替换原本的<strong>tone.bin</strong></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="头文件替换"></a>头文件替换<a class="hash-link" href="#头文件替换" title="Direct link to heading">#</a></h4><p>头文件有两处需要替换</p><ul><li>将生成的<strong>tone.h</strong>文件放到 <code>project\listenai_castor_xr872\image\xr872</code> 文件夹下，替换原本的<strong>tone.h</strong>。</li><li>将生成的<strong>tone.h</strong>文件放到 <code>project\listenai_castor_xr872\listenai_sdk\modules\listenai_evs</code>，替换原本的<strong>tone.h</strong></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="通过头文件获取提示音链接"></a>通过头文件获取提示音链接<a class="hash-link" href="#通过头文件获取提示音链接" title="Direct link to heading">#</a></h4><p>通过 <code>project\listenai_castor_xr872\listenai_sdk\modules\listenai_evs\evs_tone.h</code> 中 <code>char *get_tone_url(uint16_t tone_id)</code>；函数获取提示音链接，参数为<strong>tone.h</strong>中的枚举值。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="建议"></a>建议<a class="hash-link" href="#建议" title="Direct link to heading">#</a></h4><p>建议提示音打包前，使用工具清除 ID3v1/v2 等 tag 信息，以减小文件大小。例如 Mp3tag，<a href="https://www.mp3tag.de/en/%E3%80%82" target="_blank" rel="noopener noreferrer">https://www.mp3tag.de/en/。</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="8自行验证"></a>8.自行验证<a class="hash-link" href="#8自行验证" title="Direct link to heading">#</a></h2><p>完成二次开发并编译固件后，你可在 iFLYOS 设备接入平台——【产品认证】中选择【下载模板】，下载平台测试用例，对设备进行功能自测。</p><p><img src="/docs-csk6/assets/images/test_case-a8b5b74e753d00b6d276141db4be8388.png"></p><div class="admonition admonition-warning alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>warning</h5></div><div class="admonition-content"><p>XR872AT 出厂时未写入 mac 地址，为确保产品能够正常配网，在量产前需要批量购买 mac 地址，并在量产时通过命令行写入 872固件中。</p></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs-csk6/AIsolution/dsp/firmware_development/Create_iFLYOS_equipment"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« 创建你的 iFLYOS 设备</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs-csk6/AIsolution/dsp/firmware_development/OTA_service"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">OTA开发 »</div></a></div></nav><div class="gitalk-wrapper"><ul class="gitalk-option"><li class="like"><i class="icon like-icon"></i> <span id="like_num">有帮助  0</span></li><li class="unlike"><i class="icon unlike-icon"></i> <span id="unlike_num">没帮助 0</span></li><li>文档反馈</li></ul></div></div></div><div class="col col--3" style="padding-left:0px"><div class="tableOfContents_k96L thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1xr872at-开发环境配置" class="table-of-contents__link">1.XR872AT 开发环境配置</a><ul><li><a href="#开发环境搭建" class="table-of-contents__link">开发环境搭建</a></li><li><a href="#编译工具链地址" class="table-of-contents__link">编译工具链地址</a></li><li><a href="#快速编译" class="table-of-contents__link">快速编译</a></li></ul></li><li><a href="#2业务源码说明" class="table-of-contents__link">2.业务源码说明</a><ul><li><a href="#evs源码路径" class="table-of-contents__link">evs源码路径</a></li><li><a href="#目录结构" class="table-of-contents__link">目录结构</a></li><li><a href="#evs协议地址" class="table-of-contents__link">evs协议地址</a></li></ul></li><li><a href="#3更换-client_id-ota_secret" class="table-of-contents__link">3.更换 Client_id 、OTA_SECRET</a></li><li><a href="#4修改热点前缀" class="table-of-contents__link">4.修改热点前缀</a></li><li><a href="#5自定义按键" class="table-of-contents__link">5.自定义按键</a></li><li><a href="#6自定义灯光" class="table-of-contents__link">6.自定义灯光</a></li><li><a href="#7自定义本地tts" class="table-of-contents__link">7.自定义本地TTS</a><ul><li><a href="#生成tts文件" class="table-of-contents__link">生成TTS文件</a></li><li><a href="#tts文件说明" class="table-of-contents__link">TTS文件说明</a></li></ul></li><li><a href="#8自行验证" class="table-of-contents__link">8.自行验证</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 安徽聆思智能科技有限公司皖ICP备05001217号</div></div></div></footer></div>
<script src="/docs-csk6/assets/js/runtime~main.a2cc998b.js"></script>
<script src="/docs-csk6/assets/js/main.d62623a6.js"></script>
<script>!function(e,n,s,t,d){e[s]=e[s]||function(){(e[s].a=e[s].a||[]).push(arguments)},(d=n.createElement("script")).async=!0,d.src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js",n.body.appendChild(d)}(window,document,"simplemde")</script></body>
</html>