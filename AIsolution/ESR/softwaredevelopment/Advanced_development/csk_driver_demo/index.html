<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.2">
<title data-react-helmet="true">CSK硬件驱动开发示例 | 聆思文档中心</title><meta data-react-helmet="true" property="og:url" content="https://github.com/LISTENAI/docs-csk6/AIsolution/ESR/softwaredevelopment/Advanced_development/csk_driver_demo"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="CSK硬件驱动开发示例 | 聆思文档中心"><meta data-react-helmet="true" name="description" content="本篇介绍CSK的硬件驱动使用示例，包含UART、PWM、GPIO、I2C等通信接口。"><meta data-react-helmet="true" property="og:description" content="本篇介绍CSK的硬件驱动使用示例，包含UART、PWM、GPIO、I2C等通信接口。"><link data-react-helmet="true" rel="shortcut icon" href="/docs-csk6/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://github.com/LISTENAI/docs-csk6/AIsolution/ESR/softwaredevelopment/Advanced_development/csk_driver_demo"><link data-react-helmet="true" rel="alternate" href="https://github.com/LISTENAI/docs-csk6/AIsolution/ESR/softwaredevelopment/Advanced_development/csk_driver_demo" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://github.com/LISTENAI/docs-csk6/AIsolution/ESR/softwaredevelopment/Advanced_development/csk_driver_demo" hreflang="x-default"><link rel="stylesheet" href="/docs-csk6/assets/css/styles.e821b6b0.css">
<link rel="preload" href="/docs-csk6/assets/js/runtime~main.362b928a.js" as="script">
<link rel="preload" href="/docs-csk6/assets/js/main.f76feebe.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_vO2r">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" titleclassname="navbar__title" href="/docs-csk6/"><img src="/docs-csk6/img/logo_light.svg" alt="LSOpen Logo" class="themedImage_K3WP themedImage--light_Fy0T navbar__logo"><img src="/docs-csk6/img/logo_dark.svg" alt="LSOpen Logo" class="themedImage_K3WP themedImage--dark_V9oi navbar__logo"></a><a class="navbar__item navbar__link" href="/docs-csk6/chips/4002/Chip_information_4002">芯片</a><a class="navbar__item navbar__link" href="/docs-csk6/tools/LStudio">工具</a><a class="navbar__item navbar__link" href="/docs-csk6/AIsolution/ESR/Quick_start/Scheme_introduction">AI语音应用方案</a><a class="navbar__item navbar__link" href="/docs-csk6/Industrysolution/Scanning_pen/Scheme_introduction">行业Turnkey解决方案</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs-csk6/faq/faq">FAQ</a><a class="navbar__item navbar__link" href="/docs-csk6/school/school">视频课程</a><a class="navbar__item navbar__link" href="/docs-csk6/workorder/workorder">工单</a><div class="react-toggle displayOnlyInLargeViewport_a-w0 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_8pH0"><img src="/docs-csk6/img/light.svg" alt="" class="themedImage_K3WP themedImage--light_Fy0T"><img src="/docs-csk6/img/unlight.svg" alt="" class="themedImage_K3WP themedImage--dark_V9oi"></span></div><div class="react-toggle-track-x"><span class="toggle_8pH0"><img src="/docs-csk6/img/undark.svg" alt="" class="themedImage_K3WP themedImage--light_Fy0T"><img src="/docs-csk6/img/dark.svg" alt="" class="themedImage_K3WP themedImage--dark_V9oi"></span></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="navbar__search searchBarContainer_I7kZ"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_Zg7X searchBarLoadingRing_J5Ez"><div></div><div></div><div></div><div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" titleclassname="navbar__title" href="/docs-csk6/"><img src="/docs-csk6/img/logo_light.svg" alt="LSOpen Logo" class="themedImage_K3WP themedImage--light_Fy0T navbar__logo"><img src="/docs-csk6/img/logo_dark.svg" alt="LSOpen Logo" class="themedImage_K3WP themedImage--dark_V9oi navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/chips/4002/Chip_information_4002">芯片</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/tools/LStudio">工具</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/AIsolution/ESR/Quick_start/Scheme_introduction">AI语音应用方案</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/Industrysolution/Scanning_pen/Scheme_introduction">行业Turnkey解决方案</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/faq/faq">FAQ</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/school/school">视频课程</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-csk6/workorder/workorder">工单</a></li></ul></div></div></div></nav><nav class="navbar subnavbar--fixed-top sub-navbar"><div class="navbar__inner subnavbar__inner"><div class="navbar__items"><a aria-current="page" class="subnavbar__item subnavbar__link subnavbar__link--active" dirname="/AIsolution" href="/docs-csk6/AIsolution/ESR/Quick_start/Scheme_introduction">离线语音</a><a class="subnavbar__item subnavbar__link" dirname="/AIsolution" href="/docs-csk6/AIsolution/dsp/readme">离在线语音</a></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_Ol8-"><aside class="docSidebarContainer_UfDv"><div class="sidebar_OMtR"><nav class="menu menu--responsive thin-scrollbar menu_2y2e menuWithAnnouncementBar_Lwkw" aria-label="Sidebar navigation"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_IcOF" width="24" height="24" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--first menu__link--sublist" type="first" href="#!">快速入门</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/AIsolution/ESR/Quick_start/Scheme_introduction">方案介绍</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/AIsolution/ESR/Quick_start/Quick_start">快速开始</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/AIsolution/ESR/Quick_start/download_firmware">体验固件下载</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--first menu__link--sublist" type="first" href="#!">产品设计</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/AIsolution/ESR/design/vui">离线语音交互设计指南</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/AIsolution/ESR/design/vui2">配置唤醒词、命令词、提示语</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--first menu__link--sublist" type="first" href="#!">硬件设计</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/AIsolution/ESR/Hardwaredevelopment/hardware_guide">硬件参考设计</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--first menu__link--sublist" type="first" href="#!">算法开发</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/AIsolution/ESR/algorithm/algorithm">CSK 外语资源集成说明</a></li></ul></li><li class="menu__list-item menu__list-item--current"><a class="menu__link menu__link--first menu__link--sublist menu__link--active" type="first" href="#!">软件开发</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" type="" href="#!" tabindex="0">基础开发</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/AIsolution/ESR/softwaredevelopment/Basic_development/config_application">源码应用配置</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/AIsolution/ESR/softwaredevelopment/Basic_development/config_hardware">芯片引脚功能配置</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/AIsolution/ESR/softwaredevelopment/Basic_development/peripheral_config">外围引脚配置</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/AIsolution/ESR/softwaredevelopment/Basic_development/public_uart_protocol">CSK UART标准串口通信协议</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/AIsolution/ESR/softwaredevelopment/Basic_development/audio_transmission">音频传输</a></li></ul></li><li class="menu__list-item menu__list-item--current"><a class="menu__link menu__link--sublist menu__link--active" type="" href="#!" tabindex="0">进阶开发</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs-csk6/AIsolution/ESR/softwaredevelopment/Advanced_development/csk_sdk_demo">CSK SDK开发示例</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs-csk6/AIsolution/ESR/softwaredevelopment/Advanced_development/csk_driver_demo">CSK硬件驱动开发示例</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs-csk6/AIsolution/ESR/softwaredevelopment/Advanced_development/factory_config">产测开发</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs-csk6/AIsolution/ESR/softwaredevelopment/software_material">开发资料下载</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--first menu__link--sublist" type="first" href="#!">调优测试</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/AIsolution/ESR/Optimization_and_testing/optimize_skills">命令词阈值调节技巧</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/AIsolution/ESR/Optimization_and_testing/test">实验室语音效果测试指南</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/AIsolution/ESR/Optimization_and_testing/auto_optimize">入门调优与自动调优</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/AIsolution/ESR/Optimization_and_testing/abnormalcheck">效果测试异常排查</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/AIsolution/ESR/Optimization_and_testing/test_material">效果测试相关资料下载</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--first menu__link--sublist" type="first" href="#!">FAQ</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs-csk6/AIsolution/ESR/FAQ/faq">常见问题</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_dRYS"><div class="container padding-top--md padding-bottom--lg center-container"><div class="row"><div class="col docItemCol_+xOG"><div class="docItemContainer_c+5G"><article><div class="markdown"><header><h1 class="h1Heading_5RMM">CSK硬件驱动开发示例</h1></header><blockquote><p>本篇介绍CSK的硬件驱动使用示例，包含UART、PWM、GPIO、I2C等通信接口。
看完本篇你将了解到：</p><ul><li>uart串口通信实现指令的接收和发送。</li></ul></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="1-uart"></a>1. UART<a class="hash-link" href="#1-uart" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="11-基本介绍"></a>1.1 基本介绍<a class="hash-link" href="#11-基本介绍" title="Direct link to heading">#</a></h3><p>USART 驱动功能特性如下：</p><ul><li><p>支持 UART（Asynchronous）模式，不支持 Synchronous 模式。</p></li><li><p>使用硬件 FIFO。</p></li><li><p>非阻塞数据传输接口，硬件事件通过用户事件回调上报。</p></li><li><p>支持 DMA 传送（参数可配置）。</p></li><li><p>支持 Modem 控制模式，支持 RTS/CTS 流控。（可选）</p></li></ul><p>USART 驱动提供的静态接口实例为：Driver_USART0，Driver_USART1。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="12-使用场景"></a>1.2 使用场景<a class="hash-link" href="#12-使用场景" title="Direct link to heading">#</a></h3><p>目标机器需要使用通讯串口与上位机进行通讯。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="13-接口说明"></a>1.3 接口说明<a class="hash-link" href="#13-接口说明" title="Direct link to heading">#</a></h3><blockquote><p>串口初始化接口：用于初始化通讯串口，同时会初始化一个串口ringbuffer来存储接收的数据</p></blockquote><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv js"><pre tabindex="0" class="prism-code language-js codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// csk uart</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">/**</span></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * @brief 串口的初始化，同时会初始化一个串口ringbuffer来存储接收的数据</span></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * @return</span></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">csk_uart_init</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><p>串口接收接口：用于接收串口数据</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv js"><pre tabindex="0" class="prism-code language-js codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">/**</span></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * @brief 从串口ringbuffer里面读取数据</span></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * @param  dat              接收数据的指针</span></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * @param  len              要接收的数据长度（单位：byte）</span></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * @param  ms               超时时间（单位：ms）</span></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * @return              实际收到的数据长度</span></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">int </span><span class="token function" style="color:rgb(220, 220, 170)">csk_uart_recv</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">dat</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> int len</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> int ms</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><p> 串口发送接口：用于发送串口数据</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv js"><pre tabindex="0" class="prism-code language-js codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">/**</span></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * @brief 通过串口发送数据</span></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * @param  dat              要发送的数据指针</span></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * @param  len              要发送的数据长度（单位：byte）</span></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * @param  ms               超时时间（单位：ms）</span></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * @return              实际发送的数据长度</span></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> */</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">int </span><span class="token function" style="color:rgb(220, 220, 170)">csk_uart_send</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">dat</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> int len</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> int ms</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="14-硬件配置"></a>1.4 硬件配置<a class="hash-link" href="#14-硬件配置" title="Direct link to heading">#</a></h3><p><strong>引脚配置</strong></p><p>在硬件配置资源<code>hardware.lini</code>中配置通讯串口（uart2）的Pin脚以及功能。</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv js"><pre tabindex="0" class="prism-code language-js codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">peripheral</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">peripheral</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">uart</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">peripheral</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">uart</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">peripheral</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">uart</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">peripheral</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">uart</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">txd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pin </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">4</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    mux </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">peripheral</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">uart</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">rxd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pin </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    mux </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><p><strong>软件配置</strong></p><p>在应用配置资源<code>application.lini</code>中配置通讯串口(uart2)的驱动接口配置。</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv js"><pre tabindex="0" class="prism-code language-js codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">driver</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">driver</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">uart_ctrl</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  uart </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  baudrate </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">115200</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="15-应用实现"></a>1.5 应用实现<a class="hash-link" href="#15-应用实现" title="Direct link to heading">#</a></h3><p><strong>实现通讯串口的初始化和数据接收</strong></p><p>代码清单：</p><ul><li>app_main.c</li></ul><p>构建一个通讯串口的数据接收任务初始化接口：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv js"><pre tabindex="0" class="prism-code language-js codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">uart_init</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token parameter keyword" style="color:rgb(86, 156, 214)">void</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">csk_uart_init</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token function" style="color:rgb(220, 220, 170)">xTaskCreate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">uart_task_proc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;uart_task_proc&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1024</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">NULL</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">13</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">NULL</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">!=</span><span class="token plain"> pdPASS</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token constant" style="color:rgb(100, 102, 149)">CLOGW</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;[APP]Failed creating UART task&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><p>完成通讯串口数据接收任务的实现：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv js"><pre tabindex="0" class="prism-code language-js codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">uart_task_proc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token parameter keyword" style="color:rgb(86, 156, 214)">void</span><span class="token parameter"> </span><span class="token parameter operator" style="color:rgb(212, 212, 212)">*</span><span class="token parameter">arg</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    uint8_t data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token constant" style="color:rgb(100, 102, 149)">MAX_CUSTOM_UART_BUF_CNT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    uint16_t size </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(86, 156, 214)">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">// 从 UART 读取数据</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">memset</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">sizeof</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        size </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">read_data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">sizeof</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">// size = read_data(&amp;data, sizeof(data), portMAX_DELAY);</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">// 将数据交给 ScriptEngine 处理</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword control-flow" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">size </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token function" style="color:rgb(220, 220, 170)">script_handle_uart</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> size</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">vTaskDelete</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token constant" style="color:rgb(100, 102, 149)">NULL</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><p>在用户的应用入口<em>app_main</em>中调用<strong>uart_init</strong>进行通讯串口的初始化：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv js"><pre tabindex="0" class="prism-code language-js codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">app_main</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token parameter keyword" style="color:rgb(86, 156, 214)">void</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">CLOGD</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;[APP]Hello world&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">csk_handler_register</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token constant" style="color:rgb(100, 102, 149)">CSK_EVENT_WAKE_UP</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> cb_wake_up</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">csk_handler_register</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token constant" style="color:rgb(100, 102, 149)">CSK_EVENT_ESR_RECOGNITION</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> cb_esr_recognition</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">csk_handler_register</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token constant" style="color:rgb(100, 102, 149)">CSK_EVENT_ESR_TIMEOUT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> cb_esr_timeout</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">csk_handler_register</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token constant" style="color:rgb(100, 102, 149)">CSK_EVENT_PLAYER_START</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> cb_player_start</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">csk_handler_register</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token constant" style="color:rgb(100, 102, 149)">CSK_EVENT_PLAYER_FINISH</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> cb_player_finish</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// 如使用 UART，解除下面这一行的注释</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">uart_init</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><p>在识别回调接口中，将回调的数据通过ScriptEngine注册的mruby接口透传用户回调数据：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv js"><pre tabindex="0" class="prism-code language-js codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">cb_esr_recognition</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token parameter">keyword_attrs_t </span><span class="token parameter operator" style="color:rgb(212, 212, 212)">*</span><span class="token parameter">key_attrs</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">CLOGD</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;[APP]ESR Recognition: kid=%d&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> key_attrs</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain">kid</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// 如需在 ScriptEngine 中处理指令，解除下面这一行的注释</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">script_handle_intent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">key_attrs</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain">txt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><p><strong>实现mruby业务</strong></p><p>代码清单：</p><ul><li>intents.rb <br></li></ul><p>在ruby代码中进行业务的部署，根据关键字的的意图进行业务实现：</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv js"><pre tabindex="0" class="prism-code language-js codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token plain">on_intent </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;打开空调&quot;</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(86, 156, 214)">do</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token maybe-class-name">EngineCore</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">logger</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">info</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;打开空调&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  num </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token maybe-class-name">EngineCore</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">storage</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">get</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain">open</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">||</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token maybe-class-name">EngineCore</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">logger</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">info</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;count: #{num}&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token maybe-class-name">EngineCore</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">storage</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">set</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain">open</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> num </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token constant" style="color:rgb(100, 102, 149)">UART</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">transmit</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;PWR ON&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">end</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">on_intent </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;关闭空调&quot;</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(86, 156, 214)">do</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token maybe-class-name">EngineCore</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">logger</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">info</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;关闭空调&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token constant" style="color:rgb(100, 102, 149)">UART</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">transmit</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;PWR OFF&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">end</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">default_intent </span><span class="token keyword control-flow" style="color:rgb(86, 156, 214)">do</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">intent</span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token maybe-class-name">EngineCore</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">logger</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">info</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;default_intent: #{intent}&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">end</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">on_uart_parsed </span><span class="token keyword control-flow" style="color:rgb(86, 156, 214)">do</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">data</span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token maybe-class-name">EngineCore</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">logger</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">info</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;UART: #{data}&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">end</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_k6ZT" id="16-测试"></a>1.6 测试<a class="hash-link" href="#16-测试" title="Direct link to heading">#</a></h3><p>通过&quot;<strong>小美小美</strong>&quot;进行语音唤醒，然后呼唤命令词&quot;<strong>打开空调</strong>&quot;。</p><p>从通讯串口的接收中可以看到，已经正确接收到了发送的数据&quot;<strong>PWR ON</strong>&quot;。</p><div class="codeBlockContainer_9aag"><div class="codeBlockContent_0VPv js"><pre tabindex="0" class="prism-code language-js codeBlock_pSDi thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><div class="codeBlockLines_sq2l"><span class="token-line" style="color:#9CDCFE"><span class="token number" style="color:rgb(181, 206, 168)">2021</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">01</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">21</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">21</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">27</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">09.379</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">PWR</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">ON</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">2021</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">01</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">21</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">21</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">28</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">34.295</span><span class="token plain"> </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">2021</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">01</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">21</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">21</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">28</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">34.296</span><span class="token plain"> </span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">2021</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">01</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">21</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">21</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">28</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">35.647</span><span class="token plain"> </span></span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Q0gn clean-btn">Copy</button></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs-csk6/AIsolution/ESR/softwaredevelopment/Advanced_development/csk_sdk_demo"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« CSK SDK开发示例</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs-csk6/AIsolution/ESR/softwaredevelopment/Advanced_development/factory_config"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">产测开发 »</div></a></div></nav><div class="gitalk-wrapper"><ul class="gitalk-option"><li class="like"><i class="icon like-icon"></i> <span id="like_num">有帮助  0</span></li><li class="unlike"><i class="icon unlike-icon"></i> <span id="unlike_num">没帮助 0</span></li><li>文档反馈</li></ul></div></div></div><div class="col col--3" style="padding-left:0px"><div class="tableOfContents_k96L thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-uart" class="table-of-contents__link">1. UART</a><ul><li><a href="#11-基本介绍" class="table-of-contents__link">1.1 基本介绍</a></li><li><a href="#12-使用场景" class="table-of-contents__link">1.2 使用场景</a></li><li><a href="#13-接口说明" class="table-of-contents__link">1.3 接口说明</a></li><li><a href="#14-硬件配置" class="table-of-contents__link">1.4 硬件配置</a></li><li><a href="#15-应用实现" class="table-of-contents__link">1.5 应用实现</a></li><li><a href="#16-测试" class="table-of-contents__link">1.6 测试</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 安徽聆思智能科技有限公司皖ICP备05001217号</div></div></div></footer></div>
<script src="/docs-csk6/assets/js/runtime~main.362b928a.js"></script>
<script src="/docs-csk6/assets/js/main.f76feebe.js"></script>
<script>!function(e,n,s,t,d){e[s]=e[s]||function(){(e[s].a=e[s].a||[]).push(arguments)},(d=n.createElement("script")).async=!0,d.src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js",n.body.appendChild(d)}(window,document,"simplemde")</script></body>
</html>